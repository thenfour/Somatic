<!doctype html>
<html>

<head>
    <title>
        <%= htmlWebpackPlugin.options.title %>
    </title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="utf-8">

    <script>
        (function installWasmUnwindSuppressor() {
            const isUnwind = (x) => {
                const msg =
                    typeof x === "string" ? x :
                        x?.message ? String(x.message) :
                            String(x ?? "");
                return msg.includes("unwind");
            };

            // error events
            window.addEventListener(
                "error",
                (e) => {
                    if (isUnwind(e.error) || isUnwind(e.message)) {
                        console.warn("Suppressed wasm unwind (error):", e.error || e.message);
                        e.preventDefault();
                        e.stopImmediatePropagation();
                    }
                },
                true
            );

            // unhandled promise rejections
            window.addEventListener(
                "unhandledrejection",
                (e) => {
                    if (isUnwind(e.reason)) {
                        console.warn("Suppressed wasm unwind (rejection):", e.reason);
                        e.preventDefault();
                        e.stopImmediatePropagation();
                    }
                },
                true
            );

            // Some overlays hook window.onerror; returning true suppresses default handling
            const prevOnError = window.onerror;
            window.onerror = function (msg, src, line, col, err) {
                if (isUnwind(err) || isUnwind(msg)) {
                    console.warn("Suppressed wasm unwind (onerror):", err || msg);
                    return true;
                }
                return prevOnError ? prevOnError(msg, src, line, col, err) : false;
            };
        })();

    </script>
</head>

<body>
    <div id="root"></div>
</body>

</html>
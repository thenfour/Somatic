/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={16:(e,t,n)=>{"use strict";var r=n(59),o=n(991);function a(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer}e.exports=function(e){if("string"!=typeof e)throw Error("Argument should be a string");return/^data\:/i.test(e)?function(e){var t=(e=e.replace(/\r?\n/g,"")).indexOf(",");if(-1===t||t<=4)throw new TypeError("malformed data-URI");for(var n=e.substring(5,t).split(";"),o=!1,i="US-ASCII",l=0;l<n.length;l++)"base64"==n[l]?o=!0:0==n[l].indexOf("charset=")&&(i=n[l].substring(8));var u=unescape(e.substring(t+1));o&&(u=r(u));var c=a(u);return c.type=n[0]||"text/plain",c.charset=i,c}(e):(o(e)&&(e=r(e)),a(e))}},20:(e,t,n)=>{"use strict";var r=n(540),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,s=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(s=t.ref),t)i.call(t,r)&&!u.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:s,props:a,_owner:l.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},59:e=>{e.exports=function(e){return atob(e)}},159:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){return e instanceof Blob||"[object Blob]"===t.call(e)}},213:function(e,t,n){var r,o;void 0===(o="function"==typeof(r=function(){"use strict";function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){l(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function r(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,i=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,n,i){var l=a.URL||a.webkitURL,u=document.createElement("a");n=n||e.name||"download",u.download=n,u.rel="noopener","string"==typeof e?(u.href=e,u.origin===location.origin?o(u):r(u.href)?t(e,n,i):o(u,u.target="_blank")):(u.href=l.createObjectURL(e),setTimeout(function(){l.revokeObjectURL(u.href)},4e4),setTimeout(function(){o(u)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,a){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),n);else if(r(e))t(e,n,a);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout(function(){o(i)})}}:function(e,n,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var l="application/octet-stream"===e.type,u=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||l&&u||i)&&"undefined"!=typeof FileReader){var s=new FileReader;s.onloadend=function(){var e=s.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},s.readAsDataURL(e)}else{var f=a.URL||a.webkitURL,d=f.createObjectURL(e);o?o.location=d:location.href=d,o=null,setTimeout(function(){f.revokeObjectURL(d)},4e4)}});a.saveAs=l.saveAs=l,e.exports=l})?r.apply(t,[]):r)||(e.exports=o)},287:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),s=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator,m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,v={};function y(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||m}function g(){}function b(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=y.prototype;var w=b.prototype=new g;w.constructor=b,h(w,y.prototype),w.isPureReactComponent=!0;var x=Array.isArray,S=Object.prototype.hasOwnProperty,k={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var o,a={},i=null,l=null;if(null!=t)for(o in void 0!==t.ref&&(l=t.ref),void 0!==t.key&&(i=""+t.key),t)S.call(t,o)&&!j.hasOwnProperty(o)&&(a[o]=t[o]);var u=arguments.length-2;if(1===u)a.children=r;else if(1<u){for(var c=Array(u),s=0;s<u;s++)c[s]=arguments[s+2];a.children=c}if(e&&e.defaultProps)for(o in u=e.defaultProps)void 0===a[o]&&(a[o]=u[o]);return{$$typeof:n,type:e,key:i,ref:l,props:a,_owner:k.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var O=/\/+/g;function _(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function P(e,t,o,a,i){var l=typeof e;"undefined"!==l&&"boolean"!==l||(e=null);var u=!1;if(null===e)u=!0;else switch(l){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return i=i(u=e),e=""===a?"."+_(u,0):a,x(i)?(o="",null!=e&&(o=e.replace(O,"$&/")+"/"),P(i,t,o,"",function(e){return e})):null!=i&&(E(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(O,"$&/")+"/")+e)),t.push(i)),1;if(u=0,a=""===a?".":a+":",x(e))for(var c=0;c<e.length;c++){var s=a+_(l=e[c],c);u+=P(l,t,o,s,i)}else if(s=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof s)for(e=s.call(e),c=0;!(l=e.next()).done;)u+=P(l=l.value,t,o,s=a+_(l,c++),i);else if("object"===l)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function N(e,t,n){if(null==e)return e;var r=[],o=0;return P(e,r,"","",function(e){return t.call(n,e,o++)}),r}function I(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A={current:null},T={transition:null},M={ReactCurrentDispatcher:A,ReactCurrentBatchConfig:T,ReactCurrentOwner:k};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:N,forEach:function(e,t,n){N(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return N(e,function(){t++}),t},toArray:function(e){return N(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=o,t.Profiler=i,t.PureComponent=b,t.StrictMode=a,t.Suspense=s,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.act=L,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=h({},e.props),a=e.key,i=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,l=k.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)S.call(t,c)&&!j.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){u=Array(c);for(var s=0;s<c;s++)u[s]=arguments[s+2];o.children=u}return{$$typeof:n,type:e.type,key:a,ref:i,props:o,_owner:l}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=T.transition;T.transition={};try{e()}finally{T.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return A.current.useCallback(e,t)},t.useContext=function(e){return A.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return A.current.useDeferredValue(e)},t.useEffect=function(e,t){return A.current.useEffect(e,t)},t.useId=function(){return A.current.useId()},t.useImperativeHandle=function(e,t,n){return A.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return A.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return A.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return A.current.useMemo(e,t)},t.useReducer=function(e,t,n){return A.current.useReducer(e,t,n)},t.useRef=function(e){return A.current.useRef(e)},t.useState=function(e){return A.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return A.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return A.current.useTransition()},t.version="18.3.1"},338:(e,t,n)=>{"use strict";var r=n(961);t.H=r.createRoot,r.hydrateRoot},373:(e,t,n)=>{"use strict";var r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};o=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=document.createElement("input");return"object"===a(t[0])&&(!0===t[0].multiple&&r.setAttribute("multiple",""),void 0!==t[0].accept&&r.setAttribute("accept",t[0].accept)),r.setAttribute("type","file"),r.style.display="none",r.setAttribute("id","hidden-file"),document.body.appendChild(r),new Promise(function(e){r.addEventListener("change",function(){e(r.files);var n=t[t.length-1];"function"==typeof n&&n(r.files),document.body.removeChild(r)});var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n)})},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)},463:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var l=2*(r+1)-1,u=e[l],c=l+1,s=e[c];if(0>a(u,n))c<o&&0>a(s,u)?(e[r]=s,e[c]=n,r=c):(e[r]=u,e[l]=n,r=l);else{if(!(c<o&&0>a(s,n)))break e;e[r]=s,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var c=[],s=[],f=1,d=null,p=3,m=!1,h=!1,v=!1,y="function"==typeof setTimeout?setTimeout:null,g="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function w(e){for(var t=r(s);null!==t;){if(null===t.callback)o(s);else{if(!(t.startTime<=e))break;o(s),t.sortIndex=t.expirationTime,n(c,t)}t=r(s)}}function x(e){if(v=!1,w(e),!h)if(null!==r(c))h=!0,T(S);else{var t=r(s);null!==t&&M(x,t.startTime-e)}}function S(e,n){h=!1,v&&(v=!1,g(E),E=-1),m=!0;var a=p;try{for(w(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!P());){var i=d.callback;if("function"==typeof i){d.callback=null,p=d.priorityLevel;var l=i(d.expirationTime<=n);n=t.unstable_now(),"function"==typeof l?d.callback=l:d===r(c)&&o(c),w(n)}else o(c);d=r(c)}if(null!==d)var u=!0;else{var f=r(s);null!==f&&M(x,f.startTime-n),u=!1}return u}finally{d=null,p=a,m=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,j=!1,C=null,E=-1,O=5,_=-1;function P(){return!(t.unstable_now()-_<O)}function N(){if(null!==C){var e=t.unstable_now();_=e;var n=!0;try{n=C(!0,e)}finally{n?k():(j=!1,C=null)}}else j=!1}if("function"==typeof b)k=function(){b(N)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,A=I.port2;I.port1.onmessage=N,k=function(){A.postMessage(null)}}else k=function(){y(N,0)};function T(e){C=e,j||(j=!0,k())}function M(e,n){E=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){h||m||(h=!0,T(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?i+a:i,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:f++,callback:o,priorityLevel:e,startTime:a,expirationTime:l=a+l,sortIndex:-1},a>i?(e.sortIndex=a,n(s,e),null===r(c)&&e===r(s)&&(v?(g(E),E=-1):v=!0,M(x,a-i))):(e.sortIndex=l,n(c,e),h||m||(h=!0,T(S))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},503:e=>{e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},540:(e,t,n)=>{"use strict";e.exports=n(287)},547:(e,t,n)=>{"use strict";var r=n(621),o=n(587)("application/octect-stream"),a=n(159);e.exports=function(e,t){if(!(a(e)||e instanceof File)){e=r(e);var n=o(t||"");e=new Blob([e],{type:n})}return e}},551:(e,t,n)=>{"use strict";var r=n(540),o=n(982);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,l={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(l[e]=t,e=0;e<t.length;e++)i.add(t[e])}var s=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),f=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function h(e,t,n,r,o,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){v[e]=new h(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];v[t]=new h(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){v[e]=new h(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){v[e]=new h(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){v[e]=new h(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){v[e]=new h(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){v[e]=new h(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){v[e]=new h(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){v[e]=new h(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function g(e){return e[1].toUpperCase()}function b(e,t,n,r){var o=v.hasOwnProperty(t)?v[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!f.call(m,e)||!f.call(p,e)&&(d.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,g);v[t]=new h(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,g);v[t]=new h(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,g);v[t]=new h(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){v[e]=new h(e,1,!1,e.toLowerCase(),null,!1,!1)}),v.xlinkHref=new h("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){v[e]=new h(e,1,!1,e.toLowerCase(),null,!0,!0)});var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),S=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),O=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var T=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var M=Symbol.iterator;function L(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=M&&e[M]||e["@@iterator"])?e:null}var D,R=Object.assign;function F(e){if(void 0===D)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);D=t&&t[1]||""}return"\n"+D+e}var z=!1;function U(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var o=t.stack.split("\n"),a=r.stack.split("\n"),i=o.length-1,l=a.length-1;1<=i&&0<=l&&o[i]!==a[l];)l--;for(;1<=i&&0<=l;i--,l--)if(o[i]!==a[l]){if(1!==i||1!==l)do{if(i--,0>--l||o[i]!==a[l]){var u="\n"+o[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=l);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function B(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return U(e.type,!1);case 11:return U(e.type.render,!1);case 1:return U(e.type,!0);default:return""}}function K(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case k:return"Fragment";case S:return"Portal";case C:return"Profiler";case j:return"StrictMode";case P:return"Suspense";case N:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case O:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case _:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:K(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return K(e(t))}catch(e){}}return null}function $(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return K(t);case 8:return t===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function H(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return R({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function X(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){X(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return R({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?le(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,se,fe=(se=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return se(e,t)})}:se);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function he(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=he(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ye=R({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ge(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,ke=null,je=null;function Ce(e){if(e=wo(e)){if("function"!=typeof Se)throw Error(a(280));var t=e.stateNode;t&&(t=So(t),Se(e.stateNode,e.type,t))}}function Ee(e){ke?je?je.push(e):je=[e]:ke=e}function Oe(){if(ke){var e=ke,t=je;if(je=ke=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function _e(e,t){return e(t)}function Pe(){}var Ne=!1;function Ie(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return _e(e,t,n)}finally{Ne=!1,(null!==ke||null!==je)&&(Pe(),Oe())}}function Ae(e,t){var n=e.stateNode;if(null===n)return null;var r=So(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var Te=!1;if(s)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){Te=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(se){Te=!1}function Le(e,t,n,r,o,a,i,l,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var De=!1,Re=null,Fe=!1,ze=null,Ue={onError:function(e){De=!0,Re=e}};function Be(e,t,n,r,o,a,i,l,u){De=!1,Re=null,Le.apply(Ue,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function $e(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Ve(e){if(Ke(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(r=o.return)){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Ve(o),e;if(i===r)return Ve(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==r.return)n=o,r=i;else{for(var l=!1,u=o.child;u;){if(u===n){l=!0,n=o,r=i;break}if(u===r){l=!0,r=o,n=i;break}u=u.sibling}if(!l){for(u=i.child;u;){if(u===n){l=!0,n=i,r=o;break}if(u===r){l=!0,r=i,n=o;break}u=u.sibling}if(!l)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var He=o.unstable_scheduleCallback,qe=o.unstable_cancelCallback,Qe=o.unstable_shouldYield,Ye=o.unstable_requestPaint,Xe=o.unstable_now,Je=o.unstable_getCurrentPriorityLevel,Ze=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,at=null,it=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(lt(e)/ut|0)|0},lt=Math.log,ut=Math.LN2,ct=64,st=4194304;function ft(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,i=268435455&n;if(0!==i){var l=i&~o;0!==l?r=ft(l):0!==(a&=i)&&(r=ft(a))}else 0!==(i=n&~o)?r=ft(i):0!==a&&(r=ft(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(a=t&-t)||16===o&&4194240&a))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-it(t)),r|=e[n],t&=~o;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ht(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function gt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var bt=0;function wt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var xt,St,kt,jt,Ct,Et=!1,Ot=[],_t=null,Pt=null,Nt=null,It=new Map,At=new Map,Tt=[],Mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":_t=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":It.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":At.delete(t.pointerId)}}function Dt(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&null!==(t=wo(t))&&St(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Rt(e){var t=bo(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=$e(n)))return e.blockedOn=t,void Ct(e.priority,function(){kt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=wo(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);we=r,n.target.dispatchEvent(r),we=null,t.shift()}return!0}function zt(e,t,n){Ft(e)&&n.delete(t)}function Ut(){Et=!1,null!==_t&&Ft(_t)&&(_t=null),null!==Pt&&Ft(Pt)&&(Pt=null),null!==Nt&&Ft(Nt)&&(Nt=null),It.forEach(zt),At.forEach(zt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Ut)))}function Kt(e){function t(t){return Bt(t,e)}if(0<Ot.length){Bt(Ot[0],e);for(var n=1;n<Ot.length;n++){var r=Ot[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==_t&&Bt(_t,e),null!==Pt&&Bt(Pt,e),null!==Nt&&Bt(Nt,e),It.forEach(t),At.forEach(t),n=0;n<Tt.length;n++)(r=Tt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Tt.length&&null===(n=Tt[0]).blockedOn;)Rt(n),null===n.blockedOn&&Tt.shift()}var $t=w.ReactCurrentBatchConfig,Vt=!0;function Wt(e,t,n,r){var o=bt,a=$t.transition;$t.transition=null;try{bt=1,Ht(e,t,n,r)}finally{bt=o,$t.transition=a}}function Gt(e,t,n,r){var o=bt,a=$t.transition;$t.transition=null;try{bt=4,Ht(e,t,n,r)}finally{bt=o,$t.transition=a}}function Ht(e,t,n,r){if(Vt){var o=Qt(e,t,n,r);if(null===o)Vr(e,t,r,qt,n),Lt(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return _t=Dt(_t,e,t,n,r,o),!0;case"dragenter":return Pt=Dt(Pt,e,t,n,r,o),!0;case"mouseover":return Nt=Dt(Nt,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return It.set(a,Dt(It.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,At.set(a,Dt(At.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Mt.indexOf(e)){for(;null!==o;){var a=wo(o);if(null!==a&&xt(a),null===(a=Qt(e,t,n,r))&&Vr(e,t,r,qt,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var qt=null;function Qt(e,t,n,r){if(qt=null,null!==(e=bo(e=xe(r))))if(null===(t=Ke(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=$e(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Xt=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,r=n.length,o="value"in Xt?Xt.value:Xt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return Zt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return R(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,ln,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sn=on(cn),fn=R({},cn,{view:0,detail:0}),dn=on(fn),pn=R({},fn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(an=e.screenX-un.screenX,ln=e.screenY-un.screenY):ln=an=0,un=e),an)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),mn=on(pn),hn=on(R({},pn,{dataTransfer:0})),vn=on(R({},fn,{relatedTarget:0})),yn=on(R({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),gn=R({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(gn),wn=on(R({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function Cn(){return jn}var En=R({},fn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),On=on(En),_n=on(R({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=on(R({},fn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Nn=on(R({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=R({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),An=on(In),Tn=[9,13,27,32],Mn=s&&"CompositionEvent"in window,Ln=null;s&&"documentMode"in document&&(Ln=document.documentMode);var Dn=s&&"TextEvent"in window&&!Ln,Rn=s&&(!Mn||Ln&&8<Ln&&11>=Ln),Fn=String.fromCharCode(32),zn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Tn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Kn=!1,$n={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!$n[e.type]:"textarea"===t}function Wn(e,t,n,r){Ee(r),0<(t=Gr(t,"onChange")).length&&(n=new sn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Hn=null;function qn(e){Fr(e,0)}function Qn(e){if(H(xo(e)))return e}function Yn(e,t){if("change"===e)return t}var Xn=!1;if(s){var Jn;if(s){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"==typeof er.oninput}Jn=Zn}else Jn=!1;Xn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Hn=Gn=null)}function nr(e){if("value"===e.propertyName&&Qn(Hn)){var t=[];Wn(t,Hn,e,xe(e)),Ie(qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Hn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Hn)}function ar(e,t){if("click"===e)return Qn(t)}function ir(e,t){if("input"===e||"change"===e)return Qn(t)}var lr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ur(e,t){if(lr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!f.call(t,o)||!lr(e[o],t[o]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function sr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&fr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=void 0===r.end?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=sr(n,a);var i=sr(n,r);o&&i&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hr=s&&"documentMode"in document&&11>=document.documentMode,vr=null,yr=null,gr=null,br=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==q(r)||(r="selectionStart"in(r=vr)&&pr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},gr&&ur(gr,r)||(gr=r,0<(r=Gr(yr,"onSelect")).length&&(t=new sn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},kr={},jr={};function Cr(e){if(kr[e])return kr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in jr)return kr[e]=n[t];return e}s&&(jr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Er=Cr("animationend"),Or=Cr("animationiteration"),_r=Cr("animationstart"),Pr=Cr("transitionend"),Nr=new Map,Ir="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ar(e,t){Nr.set(e,t),u(t,[e])}for(var Tr=0;Tr<Ir.length;Tr++){var Mr=Ir[Tr];Ar(Mr.toLowerCase(),"on"+(Mr[0].toUpperCase()+Mr.slice(1)))}Ar(Er,"onAnimationEnd"),Ar(Or,"onAnimationIteration"),Ar(_r,"onAnimationStart"),Ar("dblclick","onDoubleClick"),Ar("focusin","onFocus"),Ar("focusout","onBlur"),Ar(Pr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Rr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,i,l,u,c){if(Be.apply(this,arguments),De){if(!De)throw Error(a(198));var s=Re;De=!1,Re=null,Fe||(Fe=!0,ze=s)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var l=r[i],u=l.instance,c=l.currentTarget;if(l=l.listener,u!==a&&o.isPropagationStopped())break e;Rr(o,l,c),a=u}else for(i=0;i<r.length;i++){if(u=(l=r[i]).instance,c=l.currentTarget,l=l.listener,u!==a&&o.isPropagationStopped())break e;Rr(o,l,c),a=u}}}if(Fe)throw e=ze,Fe=!1,ze=null,e}function zr(e,t){var n=t[vo];void 0===n&&(n=t[vo]=new Set);var r=e+"__bubble";n.has(r)||($r(t,e,2,!1),n.add(r))}function Ur(e,t,n){var r=0;t&&(r|=4),$r(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Kr(e){if(!e[Br]){e[Br]=!0,i.forEach(function(t){"selectionchange"!==t&&(Dr.has(t)||Ur(t,!1,e),Ur(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,Ur("selectionchange",!1,t))}}function $r(e,t,n,r){switch(Yt(t)){case 1:var o=Wt;break;case 4:o=Gt;break;default:o=Ht}n=o.bind(null,t,n,e),o=void 0,!Te||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,o){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var l=r.stateNode.containerInfo;if(l===o||8===l.nodeType&&l.parentNode===o)break;if(4===i)for(i=r.return;null!==i;){var u=i.tag;if((3===u||4===u)&&((u=i.stateNode.containerInfo)===o||8===u.nodeType&&u.parentNode===o))return;i=i.return}for(;null!==l;){if(null===(i=bo(l)))return;if(5===(u=i.tag)||6===u){r=a=i;continue e}l=l.parentNode}}r=r.return}Ie(function(){var r=a,o=xe(n),i=[];e:{var l=Nr.get(e);if(void 0!==l){var u=sn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=On;break;case"focusin":c="focus",u=vn;break;case"focusout":c="blur",u=vn;break;case"beforeblur":case"afterblur":u=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=hn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Pn;break;case Er:case Or:case _r:u=yn;break;case Pr:u=Nn;break;case"scroll":u=dn;break;case"wheel":u=An;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=_n}var s=!!(4&t),f=!s&&"scroll"===e,d=s?null!==l?l+"Capture":null:l;s=[];for(var p,m=r;null!==m;){var h=(p=m).stateNode;if(5===p.tag&&null!==h&&(p=h,null!==d&&null!=(h=Ae(m,d))&&s.push(Wr(m,h,p))),f)break;m=m.return}0<s.length&&(l=new u(l,c,null,n,o),i.push({event:l,listeners:s}))}}if(!(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!bo(c)&&!c[ho])&&(u||l)&&(l=o.window===o?o:(l=o.ownerDocument)?l.defaultView||l.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?bo(c):null)&&(c!==(f=Ke(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(s=mn,h="onMouseLeave",d="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(s=_n,h="onPointerLeave",d="onPointerEnter",m="pointer"),f=null==u?l:xo(u),p=null==c?l:xo(c),(l=new s(h,m+"leave",u,n,o)).target=f,l.relatedTarget=p,h=null,bo(o)===r&&((s=new s(d,m+"enter",c,n,o)).target=p,s.relatedTarget=f,h=s),f=h,u&&c)e:{for(d=c,m=0,p=s=u;p;p=Hr(p))m++;for(p=0,h=d;h;h=Hr(h))p++;for(;0<m-p;)s=Hr(s),m--;for(;0<p-m;)d=Hr(d),p--;for(;m--;){if(s===d||null!==d&&s===d.alternate)break e;s=Hr(s),d=Hr(d)}s=null}else s=null;null!==u&&qr(i,l,u,s,!1),null!==c&&null!==f&&qr(i,f,c,s,!0)}if("select"===(u=(l=r?xo(r):window).nodeName&&l.nodeName.toLowerCase())||"input"===u&&"file"===l.type)var v=Yn;else if(Vn(l))if(Xn)v=ir;else{v=or;var y=rr}else(u=l.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===l.type||"radio"===l.type)&&(v=ar);switch(v&&(v=v(e,r))?Wn(i,v,n,o):(y&&y(e,l,r),"focusout"===e&&(y=l._wrapperState)&&y.controlled&&"number"===l.type&&ee(l,"number",l.value)),y=r?xo(r):window,e){case"focusin":(Vn(y)||"true"===y.contentEditable)&&(vr=y,yr=r,gr=null);break;case"focusout":gr=yr=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(i,n,o);break;case"selectionchange":if(hr)break;case"keydown":case"keyup":wr(i,n,o)}var g;if(Mn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Kn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Rn&&"ko"!==n.locale&&(Kn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Kn&&(g=en()):(Jt="value"in(Xt=o)?Xt.value:Xt.textContent,Kn=!0)),0<(y=Gr(r,b)).length&&(b=new wn(b,e,null,n,o),i.push({event:b,listeners:y}),(g||null!==(g=Bn(n)))&&(b.data=g))),(g=Dn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(zn=!0,Fn);case"textInput":return(e=t.data)===Fn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Kn)return"compositionend"===e||!Mn&&Un(e,t)?(e=en(),Zt=Jt=Xt=null,Kn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Rn&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=Gr(r,"onBeforeInput")).length&&(o=new wn("onBeforeInput","beforeinput",null,n,o),i.push({event:o,listeners:r}),o.data=g)}Fr(i,t)})}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;5===o.tag&&null!==a&&(o=a,null!=(a=Ae(e,n))&&r.unshift(Wr(e,a,o)),null!=(a=Ae(e,t))&&r.push(Wr(e,a,o))),e=e.return}return r}function Hr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var l=n,u=l.alternate,c=l.stateNode;if(null!==u&&u===r)break;5===l.tag&&null!==c&&(l=c,o?null!=(u=Ae(n,a))&&i.unshift(Wr(n,u,l)):o||null!=(u=Ae(n,a))&&i.push(Wr(n,u,l))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Qr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Xr(e){return("string"==typeof e?e:""+e).replace(Qr,"\n").replace(Yr,"")}function Jr(e,t,n){if(t=Xr(t),Xr(e)!==t&&n)throw Error(a(425))}function Zr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"==typeof setTimeout?setTimeout:void 0,oo="function"==typeof clearTimeout?clearTimeout:void 0,ao="function"==typeof Promise?Promise:void 0,io="function"==typeof queueMicrotask?queueMicrotask:void 0!==ao?function(e){return ao.resolve(null).then(e).catch(lo)}:ro;function lo(e){setTimeout(function(){throw e})}function uo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void Kt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);Kt(t)}function co(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function so(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var fo=Math.random().toString(36).slice(2),po="__reactFiber$"+fo,mo="__reactProps$"+fo,ho="__reactContainer$"+fo,vo="__reactEvents$"+fo,yo="__reactListeners$"+fo,go="__reactHandles$"+fo;function bo(e){var t=e[po];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ho]||n[po]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=so(e);null!==e;){if(n=e[po])return n;e=so(e)}return t}n=(e=n).parentNode}return null}function wo(e){return!(e=e[po]||e[ho])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function So(e){return e[mo]||null}var ko=[],jo=-1;function Co(e){return{current:e}}function Eo(e){0>jo||(e.current=ko[jo],ko[jo]=null,jo--)}function Oo(e,t){jo++,ko[jo]=e.current,e.current=t}var _o={},Po=Co(_o),No=Co(!1),Io=_o;function Ao(e,t){var n=e.type.contextTypes;if(!n)return _o;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,a={};for(o in n)a[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function To(e){return null!=e.childContextTypes}function Mo(){Eo(No),Eo(Po)}function Lo(e,t,n){if(Po.current!==_o)throw Error(a(168));Oo(Po,t),Oo(No,n)}function Do(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,$(e)||"Unknown",o));return R({},n,r)}function Ro(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||_o,Io=Po.current,Oo(Po,e),Oo(No,No.current),!0}function Fo(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Do(e,t,Io),r.__reactInternalMemoizedMergedChildContext=e,Eo(No),Eo(Po),Oo(Po,e)):Eo(No),Oo(No,n)}var zo=null,Uo=!1,Bo=!1;function Ko(e){null===zo?zo=[e]:zo.push(e)}function $o(){if(!Bo&&null!==zo){Bo=!0;var e=0,t=bt;try{var n=zo;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}zo=null,Uo=!1}catch(t){throw null!==zo&&(zo=zo.slice(e+1)),He(Ze,$o),t}finally{bt=t,Bo=!1}}return null}var Vo=[],Wo=0,Go=null,Ho=0,qo=[],Qo=0,Yo=null,Xo=1,Jo="";function Zo(e,t){Vo[Wo++]=Ho,Vo[Wo++]=Go,Go=e,Ho=t}function ea(e,t,n){qo[Qo++]=Xo,qo[Qo++]=Jo,qo[Qo++]=Yo,Yo=e;var r=Xo;e=Jo;var o=32-it(r)-1;r&=~(1<<o),n+=1;var a=32-it(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,Xo=1<<32-it(t)+o|n<<o|r,Jo=a+e}else Xo=1<<a|n<<o|r,Jo=e}function ta(e){null!==e.return&&(Zo(e,1),ea(e,1,0))}function na(e){for(;e===Go;)Go=Vo[--Wo],Vo[Wo]=null,Ho=Vo[--Wo],Vo[Wo]=null;for(;e===Yo;)Yo=qo[--Qo],qo[Qo]=null,Jo=qo[--Qo],qo[Qo]=null,Xo=qo[--Qo],qo[Qo]=null}var ra=null,oa=null,aa=!1,ia=null;function la(e,t){var n=Ic(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ua(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,oa=co(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,oa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yo?{id:Xo,overflow:Jo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ic(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,oa=null,!0);default:return!1}}function ca(e){return!(!(1&e.mode)||128&e.flags)}function sa(e){if(aa){var t=oa;if(t){var n=t;if(!ua(e,t)){if(ca(e))throw Error(a(418));t=co(n.nextSibling);var r=ra;t&&ua(e,t)?la(r,n):(e.flags=-4097&e.flags|2,aa=!1,ra=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,aa=!1,ra=e}}}function fa(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function da(e){if(e!==ra)return!1;if(!aa)return fa(e),aa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oa)){if(ca(e))throw pa(),Error(a(418));for(;t;)la(e,t),t=co(t.nextSibling)}if(fa(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oa=co(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oa=null}}else oa=ra?co(e.stateNode.nextSibling):null;return!0}function pa(){for(var e=oa;e;)e=co(e.nextSibling)}function ma(){oa=ra=null,aa=!1}function ha(e){null===ia?ia=[e]:ia.push(e)}var va=w.ReactCurrentBatchConfig;function ya(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var o=r,i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=o.refs;null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ga(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ba(e){return(0,e._init)(e._payload)}function wa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Tc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function l(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Rc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===k?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===A&&ba(a)===t.type)?((r=o(t,n.props)).ref=ya(e,t,n),r.return=e,r):((r=Mc(n.type,n.key,n.props,null,e.mode,r)).ref=ya(e,t,n),r.return=e,r)}function s(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function f(e,t,n,r,a){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Rc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Mc(t.type,t.key,t.props,null,e.mode,n)).ref=ya(e,null,t),n.return=e,n;case S:return(t=Fc(t,e.mode,n)).return=e,t;case A:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Lc(t,e.mode,n,null)).return=e,t;ga(e,t)}return null}function p(e,t,n,r){var o=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==o?null:u(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===o?c(e,t,n,r):null;case S:return n.key===o?s(e,t,n,r):null;case A:return p(e,t,(o=n._init)(n._payload),r)}if(te(n)||L(n))return null!==o?null:f(e,t,n,r,null);ga(e,n)}return null}function m(e,t,n,r,o){if("string"==typeof r&&""!==r||"number"==typeof r)return u(t,e=e.get(n)||null,""+r,o);if("object"==typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case S:return s(t,e=e.get(null===r.key?n:r.key)||null,r,o);case A:return m(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||L(r))return f(t,e=e.get(n)||null,r,o,null);ga(t,r)}return null}function h(o,a,l,u){for(var c=null,s=null,f=a,h=a=0,v=null;null!==f&&h<l.length;h++){f.index>h?(v=f,f=null):v=f.sibling;var y=p(o,f,l[h],u);if(null===y){null===f&&(f=v);break}e&&f&&null===y.alternate&&t(o,f),a=i(y,a,h),null===s?c=y:s.sibling=y,s=y,f=v}if(h===l.length)return n(o,f),aa&&Zo(o,h),c;if(null===f){for(;h<l.length;h++)null!==(f=d(o,l[h],u))&&(a=i(f,a,h),null===s?c=f:s.sibling=f,s=f);return aa&&Zo(o,h),c}for(f=r(o,f);h<l.length;h++)null!==(v=m(f,o,h,l[h],u))&&(e&&null!==v.alternate&&f.delete(null===v.key?h:v.key),a=i(v,a,h),null===s?c=v:s.sibling=v,s=v);return e&&f.forEach(function(e){return t(o,e)}),aa&&Zo(o,h),c}function v(o,l,u,c){var s=L(u);if("function"!=typeof s)throw Error(a(150));if(null==(u=s.call(u)))throw Error(a(151));for(var f=s=null,h=l,v=l=0,y=null,g=u.next();null!==h&&!g.done;v++,g=u.next()){h.index>v?(y=h,h=null):y=h.sibling;var b=p(o,h,g.value,c);if(null===b){null===h&&(h=y);break}e&&h&&null===b.alternate&&t(o,h),l=i(b,l,v),null===f?s=b:f.sibling=b,f=b,h=y}if(g.done)return n(o,h),aa&&Zo(o,v),s;if(null===h){for(;!g.done;v++,g=u.next())null!==(g=d(o,g.value,c))&&(l=i(g,l,v),null===f?s=g:f.sibling=g,f=g);return aa&&Zo(o,v),s}for(h=r(o,h);!g.done;v++,g=u.next())null!==(g=m(h,o,v,g.value,c))&&(e&&null!==g.alternate&&h.delete(null===g.key?v:g.key),l=i(g,l,v),null===f?s=g:f.sibling=g,f=g);return e&&h.forEach(function(e){return t(o,e)}),aa&&Zo(o,v),s}return function e(r,a,i,u){if("object"==typeof i&&null!==i&&i.type===k&&null===i.key&&(i=i.props.children),"object"==typeof i&&null!==i){switch(i.$$typeof){case x:e:{for(var c=i.key,s=a;null!==s;){if(s.key===c){if((c=i.type)===k){if(7===s.tag){n(r,s.sibling),(a=o(s,i.props.children)).return=r,r=a;break e}}else if(s.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===A&&ba(c)===s.type){n(r,s.sibling),(a=o(s,i.props)).ref=ya(r,s,i),a.return=r,r=a;break e}n(r,s);break}t(r,s),s=s.sibling}i.type===k?((a=Lc(i.props.children,r.mode,u,i.key)).return=r,r=a):((u=Mc(i.type,i.key,i.props,null,r.mode,u)).ref=ya(r,a,i),u.return=r,r=u)}return l(r);case S:e:{for(s=i.key;null!==a;){if(a.key===s){if(4===a.tag&&a.stateNode.containerInfo===i.containerInfo&&a.stateNode.implementation===i.implementation){n(r,a.sibling),(a=o(a,i.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Fc(i,r.mode,u)).return=r,r=a}return l(r);case A:return e(r,a,(s=i._init)(i._payload),u)}if(te(i))return h(r,a,i,u);if(L(i))return v(r,a,i,u);ga(r,i)}return"string"==typeof i&&""!==i||"number"==typeof i?(i=""+i,null!==a&&6===a.tag?(n(r,a.sibling),(a=o(a,i)).return=r,r=a):(n(r,a),(a=Rc(i,r.mode,u)).return=r,r=a),l(r)):n(r,a)}}var xa=wa(!0),Sa=wa(!1),ka=Co(null),ja=null,Ca=null,Ea=null;function Oa(){Ea=Ca=ja=null}function _a(e){var t=ka.current;Eo(ka),e._currentValue=t}function Pa(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Na(e,t){ja=e,Ea=Ca=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bl=!0),e.firstContext=null)}function Ia(e){var t=e._currentValue;if(Ea!==e)if(e={context:e,memoizedValue:t,next:null},null===Ca){if(null===ja)throw Error(a(308));Ca=e,ja.dependencies={lanes:0,firstContext:e}}else Ca=Ca.next=e;return t}var Aa=null;function Ta(e){null===Aa?Aa=[e]:Aa.push(e)}function Ma(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,Ta(t)):(n.next=o.next,o.next=n),t.interleaved=n,La(e,r)}function La(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Da=!1;function Ra(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function za(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ua(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&_u){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,La(e,n)}return null===(o=r.interleaved)?(t.next=t,Ta(r)):(t.next=o.next,o.next=t),r.interleaved=t,La(e,n)}function Ba(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,gt(e,n)}}function Ka(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function $a(e,t,n,r){var o=e.updateQueue;Da=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var u=l,c=u.next;u.next=null,null===i?a=c:i.next=c,i=u;var s=e.alternate;null!==s&&(l=(s=s.updateQueue).lastBaseUpdate)!==i&&(null===l?s.firstBaseUpdate=c:l.next=c,s.lastBaseUpdate=u)}if(null!==a){var f=o.baseState;for(i=0,s=c=u=null,l=a;;){var d=l.lane,p=l.eventTime;if((r&d)===d){null!==s&&(s=s.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,h=l;switch(d=t,p=n,h.tag){case 1:if("function"==typeof(m=h.payload)){f=m.call(p,f,d);break e}f=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(d="function"==typeof(m=h.payload)?m.call(p,f,d):m))break e;f=R({},f,d);break e;case 2:Da=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(d=o.effects)?o.effects=[l]:d.push(l))}else p={eventTime:p,lane:d,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===s?(c=s=p,u=f):s=s.next=p,i|=d;if(null===(l=l.next)){if(null===(l=o.shared.pending))break;l=(d=l).next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}if(null===s&&(u=f),o.baseState=u,o.firstBaseUpdate=c,o.lastBaseUpdate=s,null!==(t=o.shared.interleaved)){o=t;do{i|=o.lane,o=o.next}while(o!==t)}else null===a&&(o.shared.lanes=0);Du|=i,e.lanes=i,e.memoizedState=f}}function Va(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!=typeof o)throw Error(a(191,o));o.call(r)}}}var Wa={},Ga=Co(Wa),Ha=Co(Wa),qa=Co(Wa);function Qa(e){if(e===Wa)throw Error(a(174));return e}function Ya(e,t){switch(Oo(qa,t),Oo(Ha,e),Oo(Ga,Wa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Eo(Ga),Oo(Ga,t)}function Xa(){Eo(Ga),Eo(Ha),Eo(qa)}function Ja(e){Qa(qa.current);var t=Qa(Ga.current),n=ue(t,e.type);t!==n&&(Oo(Ha,e),Oo(Ga,n))}function Za(e){Ha.current===e&&(Eo(Ga),Eo(Ha))}var ei=Co(0);function ti(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ni=[];function ri(){for(var e=0;e<ni.length;e++)ni[e]._workInProgressVersionPrimary=null;ni.length=0}var oi=w.ReactCurrentDispatcher,ai=w.ReactCurrentBatchConfig,ii=0,li=null,ui=null,ci=null,si=!1,fi=!1,di=0,pi=0;function mi(){throw Error(a(321))}function hi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!lr(e[n],t[n]))return!1;return!0}function vi(e,t,n,r,o,i){if(ii=i,li=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,oi.current=null===e||null===e.memoizedState?Zi:el,e=n(r,o),fi){i=0;do{if(fi=!1,di=0,25<=i)throw Error(a(301));i+=1,ci=ui=null,t.updateQueue=null,oi.current=tl,e=n(r,o)}while(fi)}if(oi.current=Ji,t=null!==ui&&null!==ui.next,ii=0,ci=ui=li=null,si=!1,t)throw Error(a(300));return e}function yi(){var e=0!==di;return di=0,e}function gi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ci?li.memoizedState=ci=e:ci=ci.next=e,ci}function bi(){if(null===ui){var e=li.alternate;e=null!==e?e.memoizedState:null}else e=ui.next;var t=null===ci?li.memoizedState:ci.next;if(null!==t)ci=t,ui=e;else{if(null===e)throw Error(a(310));e={memoizedState:(ui=e).memoizedState,baseState:ui.baseState,baseQueue:ui.baseQueue,queue:ui.queue,next:null},null===ci?li.memoizedState=ci=e:ci=ci.next=e}return ci}function wi(e,t){return"function"==typeof t?t(e):t}function xi(e){var t=bi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=ui,o=r.baseQueue,i=n.pending;if(null!==i){if(null!==o){var l=o.next;o.next=i.next,i.next=l}r.baseQueue=o=i,n.pending=null}if(null!==o){i=o.next,r=r.baseState;var u=l=null,c=null,s=i;do{var f=s.lane;if((ii&f)===f)null!==c&&(c=c.next={lane:0,action:s.action,hasEagerState:s.hasEagerState,eagerState:s.eagerState,next:null}),r=s.hasEagerState?s.eagerState:e(r,s.action);else{var d={lane:f,action:s.action,hasEagerState:s.hasEagerState,eagerState:s.eagerState,next:null};null===c?(u=c=d,l=r):c=c.next=d,li.lanes|=f,Du|=f}s=s.next}while(null!==s&&s!==i);null===c?l=r:c.next=u,lr(r,t.memoizedState)||(bl=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{i=o.lane,li.lanes|=i,Du|=i,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Si(e){var t=bi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(null!==o){n.pending=null;var l=o=o.next;do{i=e(i,l.action),l=l.next}while(l!==o);lr(i,t.memoizedState)||(bl=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function ki(){}function ji(e,t){var n=li,r=bi(),o=t(),i=!lr(r.memoizedState,o);if(i&&(r.memoizedState=o,bl=!0),r=r.queue,Di(Oi.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==ci&&1&ci.memoizedState.tag){if(n.flags|=2048,Ii(9,Ei.bind(null,n,r,o,t),void 0,null),null===Pu)throw Error(a(349));30&ii||Ci(n,t,o)}return o}function Ci(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=li.updateQueue)?(t={lastEffect:null,stores:null},li.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ei(e,t,n,r){t.value=n,t.getSnapshot=r,_i(t)&&Pi(e)}function Oi(e,t,n){return n(function(){_i(t)&&Pi(e)})}function _i(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!lr(e,n)}catch(e){return!0}}function Pi(e){var t=La(e,1);null!==t&&nc(t,e,1,-1)}function Ni(e){var t=gi();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wi,lastRenderedState:e},t.queue=e,e=e.dispatch=qi.bind(null,li,e),[t.memoizedState,e]}function Ii(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=li.updateQueue)?(t={lastEffect:null,stores:null},li.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ai(){return bi().memoizedState}function Ti(e,t,n,r){var o=gi();li.flags|=e,o.memoizedState=Ii(1|t,n,void 0,void 0===r?null:r)}function Mi(e,t,n,r){var o=bi();r=void 0===r?null:r;var a=void 0;if(null!==ui){var i=ui.memoizedState;if(a=i.destroy,null!==r&&hi(r,i.deps))return void(o.memoizedState=Ii(t,n,a,r))}li.flags|=e,o.memoizedState=Ii(1|t,n,a,r)}function Li(e,t){return Ti(8390656,8,e,t)}function Di(e,t){return Mi(2048,8,e,t)}function Ri(e,t){return Mi(4,2,e,t)}function Fi(e,t){return Mi(4,4,e,t)}function zi(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ui(e,t,n){return n=null!=n?n.concat([e]):null,Mi(4,4,zi.bind(null,t,e),n)}function Bi(){}function Ki(e,t){var n=bi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&hi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function $i(e,t){var n=bi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&hi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Vi(e,t,n){return 21&ii?(lr(n,t)||(n=ht(),li.lanes|=n,Du|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,bl=!0),e.memoizedState=n)}function Wi(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=ai.transition;ai.transition={};try{e(!1),t()}finally{bt=n,ai.transition=r}}function Gi(){return bi().memoizedState}function Hi(e,t,n){var r=tc(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Qi(e)?Yi(t,n):null!==(n=Ma(e,t,n,r))&&(nc(n,e,r,ec()),Xi(n,t,r))}function qi(e,t,n){var r=tc(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qi(e))Yi(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,l=a(i,n);if(o.hasEagerState=!0,o.eagerState=l,lr(l,i)){var u=t.interleaved;return null===u?(o.next=o,Ta(t)):(o.next=u.next,u.next=o),void(t.interleaved=o)}}catch(e){}null!==(n=Ma(e,t,o,r))&&(nc(n,e,r,o=ec()),Xi(n,t,r))}}function Qi(e){var t=e.alternate;return e===li||null!==t&&t===li}function Yi(e,t){fi=si=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Xi(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,gt(e,n)}}var Ji={readContext:Ia,useCallback:mi,useContext:mi,useEffect:mi,useImperativeHandle:mi,useInsertionEffect:mi,useLayoutEffect:mi,useMemo:mi,useReducer:mi,useRef:mi,useState:mi,useDebugValue:mi,useDeferredValue:mi,useTransition:mi,useMutableSource:mi,useSyncExternalStore:mi,useId:mi,unstable_isNewReconciler:!1},Zi={readContext:Ia,useCallback:function(e,t){return gi().memoizedState=[e,void 0===t?null:t],e},useContext:Ia,useEffect:Li,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Ti(4194308,4,zi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ti(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ti(4,2,e,t)},useMemo:function(e,t){var n=gi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=gi();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Hi.bind(null,li,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},gi().memoizedState=e},useState:Ni,useDebugValue:Bi,useDeferredValue:function(e){return gi().memoizedState=e},useTransition:function(){var e=Ni(!1),t=e[0];return e=Wi.bind(null,e[1]),gi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=li,o=gi();if(aa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Pu)throw Error(a(349));30&ii||Ci(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,Li(Oi.bind(null,r,i,e),[e]),r.flags|=2048,Ii(9,Ei.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=gi(),t=Pu.identifierPrefix;if(aa){var n=Jo;t=":"+t+"R"+(n=(Xo&~(1<<32-it(Xo)-1)).toString(32)+n),0<(n=di++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=pi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},el={readContext:Ia,useCallback:Ki,useContext:Ia,useEffect:Di,useImperativeHandle:Ui,useInsertionEffect:Ri,useLayoutEffect:Fi,useMemo:$i,useReducer:xi,useRef:Ai,useState:function(){return xi(wi)},useDebugValue:Bi,useDeferredValue:function(e){return Vi(bi(),ui.memoizedState,e)},useTransition:function(){return[xi(wi)[0],bi().memoizedState]},useMutableSource:ki,useSyncExternalStore:ji,useId:Gi,unstable_isNewReconciler:!1},tl={readContext:Ia,useCallback:Ki,useContext:Ia,useEffect:Di,useImperativeHandle:Ui,useInsertionEffect:Ri,useLayoutEffect:Fi,useMemo:$i,useReducer:Si,useRef:Ai,useState:function(){return Si(wi)},useDebugValue:Bi,useDeferredValue:function(e){var t=bi();return null===ui?t.memoizedState=e:Vi(t,ui.memoizedState,e)},useTransition:function(){return[Si(wi)[0],bi().memoizedState]},useMutableSource:ki,useSyncExternalStore:ji,useId:Gi,unstable_isNewReconciler:!1};function nl(e,t){if(e&&e.defaultProps){for(var n in t=R({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rl(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:R({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ol={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),o=tc(e),a=za(r,o);a.payload=t,null!=n&&(a.callback=n),null!==(t=Ua(e,a,o))&&(nc(t,e,o,r),Ba(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),o=tc(e),a=za(r,o);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Ua(e,a,o))&&(nc(t,e,o,r),Ba(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),o=za(n,r);o.tag=2,null!=t&&(o.callback=t),null!==(t=Ua(e,o,r))&&(nc(t,e,r,n),Ba(t,e,r))}};function al(e,t,n,r,o,a,i){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!(t.prototype&&t.prototype.isPureReactComponent&&ur(n,r)&&ur(o,a))}function il(e,t,n){var r=!1,o=_o,a=t.contextType;return"object"==typeof a&&null!==a?a=Ia(a):(o=To(t)?Io:Po.current,a=(r=null!=(r=t.contextTypes))?Ao(e,o):_o),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ol,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function ll(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ol.enqueueReplaceState(t,t.state,null)}function ul(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Ra(e);var a=t.contextType;"object"==typeof a&&null!==a?o.context=Ia(a):(a=To(t)?Io:Po.current,o.context=Ao(e,a)),o.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(rl(e,t,a,n),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&ol.enqueueReplaceState(o,o.state,null),$a(e,n,o,r),o.state=e.memoizedState),"function"==typeof o.componentDidMount&&(e.flags|=4194308)}function cl(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var o=n}catch(e){o="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:o,digest:null}}function sl(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fl(e,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var dl="function"==typeof WeakMap?WeakMap:Map;function pl(e,t,n){(n=za(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vu||(Vu=!0,Wu=r),fl(0,t)},n}function ml(e,t,n){(n=za(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){fl(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){fl(0,t),"function"!=typeof r&&(null===Gu?Gu=new Set([this]):Gu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function hl(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new dl;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function vl(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function yl(e,t,n,r,o){return 1&e.mode?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=za(-1,1)).tag=2,Ua(n,t,1))),n.lanes|=1),e)}var gl=w.ReactCurrentOwner,bl=!1;function wl(e,t,n,r){t.child=null===e?Sa(t,null,n,r):xa(t,e.child,n,r)}function xl(e,t,n,r,o){n=n.render;var a=t.ref;return Na(t,o),r=vi(e,t,n,r,a,o),n=yi(),null===e||bl?(aa&&n&&ta(t),t.flags|=1,wl(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vl(e,t,o))}function Sl(e,t,n,r,o){if(null===e){var a=n.type;return"function"!=typeof a||Ac(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Mc(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,kl(e,t,a,r,o))}if(a=e.child,0===(e.lanes&o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(i,r)&&e.ref===t.ref)return Vl(e,t,o)}return t.flags|=1,(e=Tc(a,r)).ref=t.ref,e.return=t,t.child=e}function kl(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(ur(a,r)&&e.ref===t.ref){if(bl=!1,t.pendingProps=r=a,0===(e.lanes&o))return t.lanes=e.lanes,Vl(e,t,o);131072&e.flags&&(bl=!0)}}return El(e,t,n,r,o)}function jl(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Oo(Tu,Au),Au|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Oo(Tu,Au),Au|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Oo(Tu,Au),Au|=n;else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Oo(Tu,Au),Au|=r;return wl(e,t,o,n),t.child}function Cl(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function El(e,t,n,r,o){var a=To(n)?Io:Po.current;return a=Ao(t,a),Na(t,o),n=vi(e,t,n,r,a,o),r=yi(),null===e||bl?(aa&&r&&ta(t),t.flags|=1,wl(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vl(e,t,o))}function Ol(e,t,n,r,o){if(To(n)){var a=!0;Ro(t)}else a=!1;if(Na(t,o),null===t.stateNode)$l(e,t),il(t,n,r),ul(t,n,r,o),r=!0;else if(null===e){var i=t.stateNode,l=t.memoizedProps;i.props=l;var u=i.context,c=n.contextType;c="object"==typeof c&&null!==c?Ia(c):Ao(t,c=To(n)?Io:Po.current);var s=n.getDerivedStateFromProps,f="function"==typeof s||"function"==typeof i.getSnapshotBeforeUpdate;f||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(l!==r||u!==c)&&ll(t,i,r,c),Da=!1;var d=t.memoizedState;i.state=d,$a(t,r,i,o),u=t.memoizedState,l!==r||d!==u||No.current||Da?("function"==typeof s&&(rl(t,n,s,r),u=t.memoizedState),(l=Da||al(t,n,l,r,d,u,c))?(f||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount&&(t.flags|=4194308)):("function"==typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),i.props=r,i.state=u,i.context=c,r=l):("function"==typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Fa(e,t),l=t.memoizedProps,c=t.type===t.elementType?l:nl(t.type,l),i.props=c,f=t.pendingProps,d=i.context,u="object"==typeof(u=n.contextType)&&null!==u?Ia(u):Ao(t,u=To(n)?Io:Po.current);var p=n.getDerivedStateFromProps;(s="function"==typeof p||"function"==typeof i.getSnapshotBeforeUpdate)||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(l!==f||d!==u)&&ll(t,i,r,u),Da=!1,d=t.memoizedState,i.state=d,$a(t,r,i,o);var m=t.memoizedState;l!==f||d!==m||No.current||Da?("function"==typeof p&&(rl(t,n,p,r),m=t.memoizedState),(c=Da||al(t,n,c,r,d,m,u)||!1)?(s||"function"!=typeof i.UNSAFE_componentWillUpdate&&"function"!=typeof i.componentWillUpdate||("function"==typeof i.componentWillUpdate&&i.componentWillUpdate(r,m,u),"function"==typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,m,u)),"function"==typeof i.componentDidUpdate&&(t.flags|=4),"function"==typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof i.componentDidUpdate||l===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||l===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),i.props=r,i.state=m,i.context=u,r=c):("function"!=typeof i.componentDidUpdate||l===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||l===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return _l(e,t,n,r,a,o)}function _l(e,t,n,r,o,a){Cl(e,t);var i=!!(128&t.flags);if(!r&&!i)return o&&Fo(t,n,!1),Vl(e,t,a);r=t.stateNode,gl.current=t;var l=i&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=xa(t,e.child,null,a),t.child=xa(t,null,l,a)):wl(e,t,l,a),t.memoizedState=r.state,o&&Fo(t,n,!0),t.child}function Pl(e){var t=e.stateNode;t.pendingContext?Lo(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lo(0,t.context,!1),Ya(e,t.containerInfo)}function Nl(e,t,n,r,o){return ma(),ha(o),t.flags|=256,wl(e,t,n,r),t.child}var Il,Al,Tl,Ml,Ll={dehydrated:null,treeContext:null,retryLane:0};function Dl(e){return{baseLanes:e,cachePool:null,transitions:null}}function Rl(e,t,n){var r,o=t.pendingProps,i=ei.current,l=!1,u=!!(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&!!(2&i)),r?(l=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Oo(ei,1&i),null===e)return sa(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(u=o.children,e=o.fallback,l?(o=t.mode,l=t.child,u={mode:"hidden",children:u},1&o||null===l?l=Dc(u,o,0,null):(l.childLanes=0,l.pendingProps=u),e=Lc(e,o,n,null),l.return=t,e.return=t,l.sibling=e,t.child=l,t.child.memoizedState=Dl(n),t.memoizedState=Ll,e):Fl(t,u));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,o,i,l){if(n)return 256&t.flags?(t.flags&=-257,zl(e,t,l,r=sl(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=Dc({mode:"visible",children:r.children},o,0,null),(i=Lc(i,o,l,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,1&t.mode&&xa(t,e.child,null,l),t.child.memoizedState=Dl(l),t.memoizedState=Ll,i);if(!(1&t.mode))return zl(e,t,l,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var u=r.dgst;return r=u,zl(e,t,l,r=sl(i=Error(a(419)),r,void 0))}if(u=0!==(l&e.childLanes),bl||u){if(null!==(r=Pu)){switch(l&-l){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(r.suspendedLanes|l))?0:o)&&o!==i.retryLane&&(i.retryLane=o,La(e,o),nc(r,e,o,-1))}return hc(),zl(e,t,l,r=sl(Error(a(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Oc.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,oa=co(o.nextSibling),ra=t,aa=!0,ia=null,null!==e&&(qo[Qo++]=Xo,qo[Qo++]=Jo,qo[Qo++]=Yo,Xo=e.id,Jo=e.overflow,Yo=t),(t=Fl(t,r.children)).flags|=4096,t)}(e,t,u,o,r,i,n);if(l){l=o.fallback,u=t.mode,r=(i=e.child).sibling;var c={mode:"hidden",children:o.children};return 1&u||t.child===i?(o=Tc(i,c)).subtreeFlags=14680064&i.subtreeFlags:((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null),null!==r?l=Tc(r,l):(l=Lc(l,u,n,null)).flags|=2,l.return=t,o.return=t,o.sibling=l,t.child=o,o=l,l=t.child,u=null===(u=e.child.memoizedState)?Dl(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},l.memoizedState=u,l.childLanes=e.childLanes&~n,t.memoizedState=Ll,o}return e=(l=e.child).sibling,o=Tc(l,{mode:"visible",children:o.children}),!(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Fl(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function zl(e,t,n,r){return null!==r&&ha(r),xa(t,e.child,null,n),(e=Fl(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ul(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Pa(e.return,t,n)}function Bl(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Kl(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(wl(e,t,r.children,n),2&(r=ei.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ul(e,n,t);else if(19===e.tag)Ul(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Oo(ei,r),1&t.mode)switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ti(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Bl(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ti(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Bl(t,!0,n,null,a);break;case"together":Bl(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function $l(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vl(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Du|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Tc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Tc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wl(e,t){if(!aa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Gl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Hl(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gl(t),null;case 1:case 17:return To(t.type)&&Mo(),Gl(t),null;case 3:return r=t.stateNode,Xa(),Eo(No),Eo(Po),ri(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==ia&&(ic(ia),ia=null))),Al(e,t),Gl(t),null;case 5:Za(t);var o=Qa(qa.current);if(n=t.type,null!==e&&null!=t.stateNode)Tl(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Gl(t),null}if(e=Qa(Ga.current),da(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[po]=t,r[mo]=i,e=!!(1&t.mode),n){case"dialog":zr("cancel",r),zr("close",r);break;case"iframe":case"object":case"embed":zr("load",r);break;case"video":case"audio":for(o=0;o<Lr.length;o++)zr(Lr[o],r);break;case"source":zr("error",r);break;case"img":case"image":case"link":zr("error",r),zr("load",r);break;case"details":zr("toggle",r);break;case"input":Y(r,i),zr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},zr("invalid",r);break;case"textarea":oe(r,i),zr("invalid",r)}for(var u in ge(n,i),o=null,i)if(i.hasOwnProperty(u)){var c=i[u];"children"===u?"string"==typeof c?r.textContent!==c&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",""+c]):l.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&zr("scroll",r)}switch(n){case"input":G(r),Z(r,i,!0);break;case"textarea":G(r),ie(r);break;case"select":case"option":break;default:"function"==typeof i.onClick&&(r.onclick=Zr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=le(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[po]=t,e[mo]=r,Il(e,t,!1,!1),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":zr("cancel",e),zr("close",e),o=r;break;case"iframe":case"object":case"embed":zr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Lr.length;o++)zr(Lr[o],e);o=r;break;case"source":zr("error",e),o=r;break;case"img":case"image":case"link":zr("error",e),zr("load",e),o=r;break;case"details":zr("toggle",e),o=r;break;case"input":Y(e,r),o=Q(e,r),zr("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=R({},r,{value:void 0}),zr("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),zr("invalid",e)}for(i in ge(n,o),c=o)if(c.hasOwnProperty(i)){var s=c[i];"style"===i?ve(e,s):"dangerouslySetInnerHTML"===i?null!=(s=s?s.__html:void 0)&&fe(e,s):"children"===i?"string"==typeof s?("textarea"!==n||""!==s)&&de(e,s):"number"==typeof s&&de(e,""+s):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(l.hasOwnProperty(i)?null!=s&&"onScroll"===i&&zr("scroll",e):null!=s&&b(e,i,s,u))}switch(n){case"input":G(e),Z(e,r,!1);break;case"textarea":G(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gl(t),null;case 6:if(e&&null!=t.stateNode)Ml(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));if(n=Qa(qa.current),Qa(Ga.current),da(t)){if(r=t.stateNode,n=t.memoizedProps,r[po]=t,(i=r.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:Jr(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,!!(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[po]=t,t.stateNode=r}return Gl(t),null;case 13:if(Eo(ei),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(aa&&null!==oa&&1&t.mode&&!(128&t.flags))pa(),ma(),t.flags|=98560,i=!1;else if(i=da(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[po]=t}else ma(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gl(t),i=!1}else null!==ia&&(ic(ia),ia=null),i=!0;if(!i)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!=(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&ei.current?0===Mu&&(Mu=3):hc())),null!==t.updateQueue&&(t.flags|=4),Gl(t),null);case 4:return Xa(),Al(e,t),null===e&&Kr(t.stateNode.containerInfo),Gl(t),null;case 10:return _a(t.type._context),Gl(t),null;case 19:if(Eo(ei),null===(i=t.memoizedState))return Gl(t),null;if(r=!!(128&t.flags),null===(u=i.rendering))if(r)Wl(i,!1);else{if(0!==Mu||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(u=ti(e))){for(t.flags|=128,Wl(i,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(u=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,e=u.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Oo(ei,1&ei.current|2),t.child}e=e.sibling}null!==i.tail&&Xe()>Ku&&(t.flags|=128,r=!0,Wl(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ti(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wl(i,!0),null===i.tail&&"hidden"===i.tailMode&&!u.alternate&&!aa)return Gl(t),null}else 2*Xe()-i.renderingStartTime>Ku&&1073741824!==n&&(t.flags|=128,r=!0,Wl(i,!1),t.lanes=4194304);i.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=i.last)?n.sibling=u:t.child=u,i.last=u)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Xe(),t.sibling=null,n=ei.current,Oo(ei,r?1&n|2:1&n),t):(Gl(t),null);case 22:case 23:return fc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Au)&&(Gl(t),6&t.subtreeFlags&&(t.flags|=8192)):Gl(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function ql(e,t){switch(na(t),t.tag){case 1:return To(t.type)&&Mo(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Xa(),Eo(No),Eo(Po),ri(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Za(t),null;case 13:if(Eo(ei),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ma()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Eo(ei),null;case 4:return Xa(),null;case 10:return _a(t.type._context),null;case 22:case 23:return fc(),null;default:return null}}Il=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Al=function(){},Tl=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Qa(Ga.current);var a,i=null;switch(n){case"input":o=Q(e,o),r=Q(e,r),i=[];break;case"select":o=R({},o,{value:void 0}),r=R({},r,{value:void 0}),i=[];break;case"textarea":o=re(e,o),r=re(e,r),i=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(e.onclick=Zr)}for(s in ge(n,r),n=null,o)if(!r.hasOwnProperty(s)&&o.hasOwnProperty(s)&&null!=o[s])if("style"===s){var u=o[s];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(l.hasOwnProperty(s)?i||(i=[]):(i=i||[]).push(s,null));for(s in r){var c=r[s];if(u=null!=o?o[s]:void 0,r.hasOwnProperty(s)&&c!==u&&(null!=c||null!=u))if("style"===s)if(u){for(a in u)!u.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&u[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(s,n)),n=c;else"dangerouslySetInnerHTML"===s?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(i=i||[]).push(s,c)):"children"===s?"string"!=typeof c&&"number"!=typeof c||(i=i||[]).push(s,""+c):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(l.hasOwnProperty(s)?(null!=c&&"onScroll"===s&&zr("scroll",e),i||u===c||(i=[])):(i=i||[]).push(s,c))}n&&(i=i||[]).push("style",n);var s=i;(t.updateQueue=s)&&(t.flags|=4)}},Ml=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ql=!1,Yl=!1,Xl="function"==typeof WeakSet?WeakSet:Set,Jl=null;function Zl(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){jc(e,t,n)}else n.current=null}function eu(e,t,n){try{n()}catch(n){jc(e,t,n)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,void 0!==a&&eu(t,n,a)}o=o.next}while(o!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ou(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function au(e){var t=e.alternate;null!==t&&(e.alternate=null,au(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[po],delete t[mo],delete t[vo],delete t[yo],delete t[go]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function iu(e){return 5===e.tag||3===e.tag||4===e.tag}function lu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||iu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}var su=null,fu=!1;function du(e,t,n){for(n=n.child;null!==n;)pu(e,t,n),n=n.sibling}function pu(e,t,n){if(at&&"function"==typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(e){}switch(n.tag){case 5:Yl||Zl(n,t);case 6:var r=su,o=fu;su=null,du(e,t,n),fu=o,null!==(su=r)&&(fu?(e=su,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):su.removeChild(n.stateNode));break;case 18:null!==su&&(fu?(e=su,n=n.stateNode,8===e.nodeType?uo(e.parentNode,n):1===e.nodeType&&uo(e,n),Kt(e)):uo(su,n.stateNode));break;case 4:r=su,o=fu,su=n.stateNode.containerInfo,fu=!0,du(e,t,n),su=r,fu=o;break;case 0:case 11:case 14:case 15:if(!Yl&&null!==(r=n.updateQueue)&&null!==(r=r.lastEffect)){o=r=r.next;do{var a=o,i=a.destroy;a=a.tag,void 0!==i&&(2&a||4&a)&&eu(n,t,i),o=o.next}while(o!==r)}du(e,t,n);break;case 1:if(!Yl&&(Zl(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){jc(n,t,e)}du(e,t,n);break;case 21:du(e,t,n);break;case 22:1&n.mode?(Yl=(r=Yl)||null!==n.memoizedState,du(e,t,n),Yl=r):du(e,t,n);break;default:du(e,t,n)}}function mu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xl),t.forEach(function(t){var r=_c.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function hu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,l=t,u=l;e:for(;null!==u;){switch(u.tag){case 5:su=u.stateNode,fu=!1;break e;case 3:case 4:su=u.stateNode.containerInfo,fu=!0;break e}u=u.return}if(null===su)throw Error(a(160));pu(i,l,o),su=null,fu=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(e){jc(o,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vu(t,e),t=t.sibling}function vu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(hu(t,e),yu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(t){jc(e,e.return,t)}try{nu(5,e,e.return)}catch(t){jc(e,e.return,t)}}break;case 1:hu(t,e),yu(e),512&r&&null!==n&&Zl(n,n.return);break;case 5:if(hu(t,e),yu(e),512&r&&null!==n&&Zl(n,n.return),32&e.flags){var o=e.stateNode;try{de(o,"")}catch(t){jc(e,e.return,t)}}if(4&r&&null!=(o=e.stateNode)){var i=e.memoizedProps,l=null!==n?n.memoizedProps:i,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===i.type&&null!=i.name&&X(o,i),be(u,l);var s=be(u,i);for(l=0;l<c.length;l+=2){var f=c[l],d=c[l+1];"style"===f?ve(o,d):"dangerouslySetInnerHTML"===f?fe(o,d):"children"===f?de(o,d):b(o,f,d,s)}switch(u){case"input":J(o,i);break;case"textarea":ae(o,i);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var m=i.value;null!=m?ne(o,!!i.multiple,m,!1):p!==!!i.multiple&&(null!=i.defaultValue?ne(o,!!i.multiple,i.defaultValue,!0):ne(o,!!i.multiple,i.multiple?[]:"",!1))}o[mo]=i}catch(t){jc(e,e.return,t)}}break;case 6:if(hu(t,e),yu(e),4&r){if(null===e.stateNode)throw Error(a(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(t){jc(e,e.return,t)}}break;case 3:if(hu(t,e),yu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Kt(t.containerInfo)}catch(t){jc(e,e.return,t)}break;case 4:default:hu(t,e),yu(e);break;case 13:hu(t,e),yu(e),8192&(o=e.child).flags&&(i=null!==o.memoizedState,o.stateNode.isHidden=i,!i||null!==o.alternate&&null!==o.alternate.memoizedState||(Bu=Xe())),4&r&&mu(e);break;case 22:if(f=null!==n&&null!==n.memoizedState,1&e.mode?(Yl=(s=Yl)||f,hu(t,e),Yl=s):hu(t,e),yu(e),8192&r){if(s=null!==e.memoizedState,(e.stateNode.isHidden=s)&&!f&&1&e.mode)for(Jl=e,f=e.child;null!==f;){for(d=Jl=f;null!==Jl;){switch(m=(p=Jl).child,p.tag){case 0:case 11:case 14:case 15:nu(4,p,p.return);break;case 1:Zl(p,p.return);var h=p.stateNode;if("function"==typeof h.componentWillUnmount){r=p,n=p.return;try{t=r,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(e){jc(r,n,e)}}break;case 5:Zl(p,p.return);break;case 22:if(null!==p.memoizedState){xu(d);continue}}null!==m?(m.return=p,Jl=m):xu(d)}f=f.sibling}e:for(f=null,d=e;;){if(5===d.tag){if(null===f){f=d;try{o=d.stateNode,s?"function"==typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none":(u=d.stateNode,l=null!=(c=d.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,u.style.display=he("display",l))}catch(t){jc(e,e.return,t)}}}else if(6===d.tag){if(null===f)try{d.stateNode.nodeValue=s?"":d.memoizedProps}catch(t){jc(e,e.return,t)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:hu(t,e),yu(e),4&r&&mu(e);case 21:}}function yu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(iu(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(de(o,""),r.flags&=-33),cu(e,lu(e),o);break;case 3:case 4:var i=r.stateNode.containerInfo;uu(e,lu(e),i);break;default:throw Error(a(161))}}catch(t){jc(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function gu(e,t,n){Jl=e,bu(e,t,n)}function bu(e,t,n){for(var r=!!(1&e.mode);null!==Jl;){var o=Jl,a=o.child;if(22===o.tag&&r){var i=null!==o.memoizedState||Ql;if(!i){var l=o.alternate,u=null!==l&&null!==l.memoizedState||Yl;l=Ql;var c=Yl;if(Ql=i,(Yl=u)&&!c)for(Jl=o;null!==Jl;)u=(i=Jl).child,22===i.tag&&null!==i.memoizedState?Su(o):null!==u?(u.return=i,Jl=u):Su(o);for(;null!==a;)Jl=a,bu(a,t,n),a=a.sibling;Jl=o,Ql=l,Yl=c}wu(e)}else 8772&o.subtreeFlags&&null!==a?(a.return=o,Jl=a):wu(e)}}function wu(e){for(;null!==Jl;){var t=Jl;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Yl||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Yl)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:nl(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Va(t,i,r);break;case 3:var l=t.updateQueue;if(null!==l){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Va(t,l,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var s=t.alternate;if(null!==s){var f=s.memoizedState;if(null!==f){var d=f.dehydrated;null!==d&&Kt(d)}}}break;default:throw Error(a(163))}Yl||512&t.flags&&ou(t)}catch(e){jc(t,t.return,e)}}if(t===e){Jl=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jl=n;break}Jl=t.return}}function xu(e){for(;null!==Jl;){var t=Jl;if(t===e){Jl=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jl=n;break}Jl=t.return}}function Su(e){for(;null!==Jl;){var t=Jl;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(e){jc(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(e){jc(t,o,e)}}var a=t.return;try{ou(t)}catch(e){jc(t,a,e)}break;case 5:var i=t.return;try{ou(t)}catch(e){jc(t,i,e)}}}catch(e){jc(t,t.return,e)}if(t===e){Jl=null;break}var l=t.sibling;if(null!==l){l.return=t.return,Jl=l;break}Jl=t.return}}var ku,ju=Math.ceil,Cu=w.ReactCurrentDispatcher,Eu=w.ReactCurrentOwner,Ou=w.ReactCurrentBatchConfig,_u=0,Pu=null,Nu=null,Iu=0,Au=0,Tu=Co(0),Mu=0,Lu=null,Du=0,Ru=0,Fu=0,zu=null,Uu=null,Bu=0,Ku=1/0,$u=null,Vu=!1,Wu=null,Gu=null,Hu=!1,qu=null,Qu=0,Yu=0,Xu=null,Ju=-1,Zu=0;function ec(){return 6&_u?Xe():-1!==Ju?Ju:Ju=Xe()}function tc(e){return 1&e.mode?2&_u&&0!==Iu?Iu&-Iu:null!==va.transition?(0===Zu&&(Zu=ht()),Zu):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Yt(e.type):1}function nc(e,t,n,r){if(50<Yu)throw Yu=0,Xu=null,Error(a(185));yt(e,n,r),2&_u&&e===Pu||(e===Pu&&(!(2&_u)&&(Ru|=n),4===Mu&&lc(e,Iu)),rc(e,r),1===n&&0===_u&&!(1&t.mode)&&(Ku=Xe()+500,Uo&&$o()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-it(a),l=1<<i,u=o[i];-1===u?0!==(l&n)&&0===(l&r)||(o[i]=pt(l,t)):u<=t&&(e.expiredLanes|=l),a&=~l}}(e,t);var r=dt(e,e===Pu?Iu:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Uo=!0,Ko(e)}(uc.bind(null,e)):Ko(uc.bind(null,e)),io(function(){!(6&_u)&&$o()}),n=null;else{switch(wt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Ju=-1,Zu=0,6&_u)throw Error(a(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=dt(e,e===Pu?Iu:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||t)t=vc(e,r);else{t=r;var o=_u;_u|=2;var i=mc();for(Pu===e&&Iu===t||($u=null,Ku=Xe()+500,dc(e,t));;)try{gc();break}catch(t){pc(e,t)}Oa(),Cu.current=i,_u=o,null!==Nu?t=0:(Pu=null,Iu=0,t=Mu)}if(0!==t){if(2===t&&0!==(o=mt(e))&&(r=o,t=ac(e,o)),1===t)throw n=Lu,dc(e,0),lc(e,r),rc(e,Xe()),n;if(6===t)lc(e,r);else{if(o=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!lr(a(),o))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)||(t=vc(e,r),2===t&&(i=mt(e),0!==i&&(r=i,t=ac(e,i))),1!==t)))throw n=Lu,dc(e,0),lc(e,r),rc(e,Xe()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:xc(e,Uu,$u);break;case 3:if(lc(e,r),(130023424&r)===r&&10<(t=Bu+500-Xe())){if(0!==dt(e,0))break;if(((o=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(xc.bind(null,e,Uu,$u),t);break}xc(e,Uu,$u);break;case 4:if(lc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var l=31-it(r);i=1<<l,(l=t[l])>o&&(o=l),r&=~i}if(r=o,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ju(r/1960))-r)){e.timeoutHandle=ro(xc.bind(null,e,Uu,$u),r);break}xc(e,Uu,$u);break;default:throw Error(a(329))}}}return rc(e,Xe()),e.callbackNode===n?oc.bind(null,e):null}function ac(e,t){var n=zu;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=vc(e,t))&&(t=Uu,Uu=n,null!==t&&ic(t)),e}function ic(e){null===Uu?Uu=e:Uu.push.apply(Uu,e)}function lc(e,t){for(t&=~Fu,t&=~Ru,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function uc(e){if(6&_u)throw Error(a(327));Sc();var t=dt(e,0);if(!(1&t))return rc(e,Xe()),null;var n=vc(e,t);if(0!==e.tag&&2===n){var r=mt(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=Lu,dc(e,0),lc(e,t),rc(e,Xe()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,Uu,$u),rc(e,Xe()),null}function cc(e,t){var n=_u;_u|=1;try{return e(t)}finally{0===(_u=n)&&(Ku=Xe()+500,Uo&&$o())}}function sc(e){null!==qu&&0===qu.tag&&!(6&_u)&&Sc();var t=_u;_u|=1;var n=Ou.transition,r=bt;try{if(Ou.transition=null,bt=1,e)return e()}finally{bt=r,Ou.transition=n,!(6&(_u=t))&&$o()}}function fc(){Au=Tu.current,Eo(Tu)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==Nu)for(n=Nu.return;null!==n;){var r=n;switch(na(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Mo();break;case 3:Xa(),Eo(No),Eo(Po),ri();break;case 5:Za(r);break;case 4:Xa();break;case 13:case 19:Eo(ei);break;case 10:_a(r.type._context);break;case 22:case 23:fc()}n=n.return}if(Pu=e,Nu=e=Tc(e.current,null),Iu=Au=t,Mu=0,Lu=null,Fu=Ru=Du=0,Uu=zu=null,null!==Aa){for(t=0;t<Aa.length;t++)if(null!==(r=(n=Aa[t]).interleaved)){n.interleaved=null;var o=r.next,a=n.pending;if(null!==a){var i=a.next;a.next=o,r.next=i}n.pending=r}Aa=null}return e}function pc(e,t){for(;;){var n=Nu;try{if(Oa(),oi.current=Ji,si){for(var r=li.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}si=!1}if(ii=0,ci=ui=li=null,fi=!1,di=0,Eu.current=null,null===n||null===n.return){Mu=1,Lu=t,Nu=null;break}e:{var i=e,l=n.return,u=n,c=t;if(t=Iu,u.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var s=c,f=u,d=f.tag;if(!(1&f.mode||0!==d&&11!==d&&15!==d)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var m=vl(l);if(null!==m){m.flags&=-257,yl(m,l,u,0,t),1&m.mode&&hl(i,s,t),c=s;var h=(t=m).updateQueue;if(null===h){var v=new Set;v.add(c),t.updateQueue=v}else h.add(c);break e}if(!(1&t)){hl(i,s,t),hc();break e}c=Error(a(426))}else if(aa&&1&u.mode){var y=vl(l);if(null!==y){!(65536&y.flags)&&(y.flags|=256),yl(y,l,u,0,t),ha(cl(c,u));break e}}i=c=cl(c,u),4!==Mu&&(Mu=2),null===zu?zu=[i]:zu.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,Ka(i,pl(0,c,t));break e;case 1:u=c;var g=i.type,b=i.stateNode;if(!(128&i.flags||"function"!=typeof g.getDerivedStateFromError&&(null===b||"function"!=typeof b.componentDidCatch||null!==Gu&&Gu.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,Ka(i,ml(i,u,t));break e}}i=i.return}while(null!==i)}wc(n)}catch(e){t=e,Nu===n&&null!==n&&(Nu=n=n.return);continue}break}}function mc(){var e=Cu.current;return Cu.current=Ji,null===e?Ji:e}function hc(){0!==Mu&&3!==Mu&&2!==Mu||(Mu=4),null===Pu||!(268435455&Du)&&!(268435455&Ru)||lc(Pu,Iu)}function vc(e,t){var n=_u;_u|=2;var r=mc();for(Pu===e&&Iu===t||($u=null,dc(e,t));;)try{yc();break}catch(t){pc(e,t)}if(Oa(),_u=n,Cu.current=r,null!==Nu)throw Error(a(261));return Pu=null,Iu=0,Mu}function yc(){for(;null!==Nu;)bc(Nu)}function gc(){for(;null!==Nu&&!Qe();)bc(Nu)}function bc(e){var t=ku(e.alternate,e,Au);e.memoizedProps=e.pendingProps,null===t?wc(e):Nu=t,Eu.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=ql(n,t)))return n.flags&=32767,void(Nu=n);if(null===e)return Mu=6,void(Nu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Hl(n,t,Au)))return void(Nu=n);if(null!==(t=t.sibling))return void(Nu=t);Nu=t=e}while(null!==t);0===Mu&&(Mu=5)}function xc(e,t,n){var r=bt,o=Ou.transition;try{Ou.transition=null,bt=1,function(e,t,n,r){do{Sc()}while(null!==qu);if(6&_u)throw Error(a(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-it(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}(e,i),e===Pu&&(Nu=Pu=null,Iu=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Hu||(Hu=!0,Pc(tt,function(){return Sc(),null})),i=!!(15990&n.flags),15990&n.subtreeFlags||i){i=Ou.transition,Ou.transition=null;var l=bt;bt=1;var u=_u;_u|=4,Eu.current=null,function(e,t){if(eo=Vt,pr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(e){n=null;break e}var l=0,u=-1,c=-1,s=0,f=0,d=e,p=null;t:for(;;){for(var m;d!==n||0!==o&&3!==d.nodeType||(u=l+o),d!==i||0!==r&&3!==d.nodeType||(c=l+r),3===d.nodeType&&(l+=d.nodeValue.length),null!==(m=d.firstChild);)p=d,d=m;for(;;){if(d===e)break t;if(p===n&&++s===o&&(u=l),p===i&&++f===r&&(c=l),null!==(m=d.nextSibling))break;p=(d=p).parentNode}d=m}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Vt=!1,Jl=t;null!==Jl;)if(e=(t=Jl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Jl=e;else for(;null!==Jl;){t=Jl;try{var h=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==h){var v=h.memoizedProps,y=h.memoizedState,g=t.stateNode,b=g.getSnapshotBeforeUpdate(t.elementType===t.type?v:nl(t.type,v),y);g.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(a(163))}}catch(e){jc(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Jl=e;break}Jl=t.return}h=tu,tu=!1}(e,n),vu(n,e),mr(to),Vt=!!eo,to=eo=null,e.current=n,gu(n,e,o),Ye(),_u=u,bt=l,Ou.transition=i}else e.current=n;if(Hu&&(Hu=!1,qu=e,Qu=o),0===(i=e.pendingLanes)&&(Gu=null),function(e){if(at&&"function"==typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),rc(e,Xe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((o=t[n]).value,{componentStack:o.stack,digest:o.digest});if(Vu)throw Vu=!1,e=Wu,Wu=null,e;!!(1&Qu)&&0!==e.tag&&Sc(),1&(i=e.pendingLanes)?e===Xu?Yu++:(Yu=0,Xu=e):Yu=0,$o()}(e,t,n,r)}finally{Ou.transition=o,bt=r}return null}function Sc(){if(null!==qu){var e=wt(Qu),t=Ou.transition,n=bt;try{if(Ou.transition=null,bt=16>e?16:e,null===qu)var r=!1;else{if(e=qu,qu=null,Qu=0,6&_u)throw Error(a(331));var o=_u;for(_u|=4,Jl=e.current;null!==Jl;){var i=Jl,l=i.child;if(16&Jl.flags){var u=i.deletions;if(null!==u){for(var c=0;c<u.length;c++){var s=u[c];for(Jl=s;null!==Jl;){var f=Jl;switch(f.tag){case 0:case 11:case 15:nu(8,f,i)}var d=f.child;if(null!==d)d.return=f,Jl=d;else for(;null!==Jl;){var p=(f=Jl).sibling,m=f.return;if(au(f),f===s){Jl=null;break}if(null!==p){p.return=m,Jl=p;break}Jl=m}}}var h=i.alternate;if(null!==h){var v=h.child;if(null!==v){h.child=null;do{var y=v.sibling;v.sibling=null,v=y}while(null!==v)}}Jl=i}}if(2064&i.subtreeFlags&&null!==l)l.return=i,Jl=l;else e:for(;null!==Jl;){if(2048&(i=Jl).flags)switch(i.tag){case 0:case 11:case 15:nu(9,i,i.return)}var g=i.sibling;if(null!==g){g.return=i.return,Jl=g;break e}Jl=i.return}}var b=e.current;for(Jl=b;null!==Jl;){var w=(l=Jl).child;if(2064&l.subtreeFlags&&null!==w)w.return=l,Jl=w;else e:for(l=b;null!==Jl;){if(2048&(u=Jl).flags)try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(e){jc(u,u.return,e)}if(u===l){Jl=null;break e}var x=u.sibling;if(null!==x){x.return=u.return,Jl=x;break e}Jl=u.return}}if(_u=o,$o(),at&&"function"==typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(e){}r=!0}return r}finally{bt=n,Ou.transition=t}}return!1}function kc(e,t,n){e=Ua(e,t=pl(0,t=cl(n,t),1),1),t=ec(),null!==e&&(yt(e,1,t),rc(e,t))}function jc(e,t,n){if(3===e.tag)kc(e,e,n);else for(;null!==t;){if(3===t.tag){kc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Gu||!Gu.has(r))){t=Ua(t,e=ml(t,e=cl(n,e),1),1),e=ec(),null!==t&&(yt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Pu===e&&(Iu&n)===n&&(4===Mu||3===Mu&&(130023424&Iu)===Iu&&500>Xe()-Bu?dc(e,0):Fu|=n),rc(e,t)}function Ec(e,t){0===t&&(1&e.mode?(t=st,!(130023424&(st<<=1))&&(st=4194304)):t=1);var n=ec();null!==(e=La(e,t))&&(yt(e,t,n),rc(e,n))}function Oc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ec(e,n)}function _c(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ec(e,n)}function Pc(e,t){return He(e,t)}function Nc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ic(e,t,n,r){return new Nc(e,t,n,r)}function Ac(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Tc(e,t){var n=e.alternate;return null===n?((n=Ic(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Mc(e,t,n,r,o,i){var l=2;if(r=e,"function"==typeof e)Ac(e)&&(l=1);else if("string"==typeof e)l=5;else e:switch(e){case k:return Lc(n.children,o,i,t);case j:l=8,o|=8;break;case C:return(e=Ic(12,n,t,2|o)).elementType=C,e.lanes=i,e;case P:return(e=Ic(13,n,t,o)).elementType=P,e.lanes=i,e;case N:return(e=Ic(19,n,t,o)).elementType=N,e.lanes=i,e;case T:return Dc(n,o,i,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case E:l=10;break e;case O:l=9;break e;case _:l=11;break e;case I:l=14;break e;case A:l=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Ic(l,n,t,o)).elementType=e,t.type=r,t.lanes=i,t}function Lc(e,t,n,r){return(e=Ic(7,e,r,t)).lanes=n,e}function Dc(e,t,n,r){return(e=Ic(22,e,r,t)).elementType=T,e.lanes=n,e.stateNode={isHidden:!1},e}function Rc(e,t,n){return(e=Ic(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=Ic(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zc(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,o,a,i,l,u){return e=new zc(e,t,n,l,u),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Ic(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ra(a),e}function Bc(e){if(!e)return _o;e:{if(Ke(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(To(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(To(n))return Do(e,n,t)}return t}function Kc(e,t,n,r,o,a,i,l,u){return(e=Uc(n,r,!0,e,0,a,0,l,u)).context=Bc(null),n=e.current,(a=za(r=ec(),o=tc(n))).callback=null!=t?t:null,Ua(n,a,o),e.current.lanes=o,yt(e,o,r),rc(e,r),e}function $c(e,t,n,r){var o=t.current,a=ec(),i=tc(o);return n=Bc(n),null===t.context?t.context=n:t.pendingContext=n,(t=za(a,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ua(o,t,i))&&(nc(e,o,i,a),Ba(e,o,i)),i}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}ku=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||No.current)bl=!0;else{if(0===(e.lanes&n)&&!(128&t.flags))return bl=!1,function(e,t,n){switch(t.tag){case 3:Pl(t),ma();break;case 5:Ja(t);break;case 1:To(t.type)&&Ro(t);break;case 4:Ya(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Oo(ka,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Oo(ei,1&ei.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Rl(e,t,n):(Oo(ei,1&ei.current),null!==(e=Vl(e,t,n))?e.sibling:null);Oo(ei,1&ei.current);break;case 19:if(r=0!==(n&t.childLanes),128&e.flags){if(r)return Kl(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Oo(ei,ei.current),r)break;return null;case 22:case 23:return t.lanes=0,jl(e,t,n)}return Vl(e,t,n)}(e,t,n);bl=!!(131072&e.flags)}else bl=!1,aa&&1048576&t.flags&&ea(t,Ho,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;$l(e,t),e=t.pendingProps;var o=Ao(t,Po.current);Na(t,n),o=vi(null,t,r,e,o,n);var i=yi();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,To(r)?(i=!0,Ro(t)):i=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Ra(t),o.updater=ol,t.stateNode=o,o._reactInternals=t,ul(t,r,e,n),t=_l(null,t,r,!0,i,n)):(t.tag=0,aa&&i&&ta(t),wl(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch($l(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return Ac(e)?1:0;if(null!=e){if((e=e.$$typeof)===_)return 11;if(e===I)return 14}return 2}(r),e=nl(r,e),o){case 0:t=El(null,t,r,e,n);break e;case 1:t=Ol(null,t,r,e,n);break e;case 11:t=xl(null,t,r,e,n);break e;case 14:t=Sl(null,t,r,nl(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,El(e,t,r,o=t.elementType===r?o:nl(r,o),n);case 1:return r=t.type,o=t.pendingProps,Ol(e,t,r,o=t.elementType===r?o:nl(r,o),n);case 3:e:{if(Pl(t),null===e)throw Error(a(387));r=t.pendingProps,o=(i=t.memoizedState).element,Fa(e,t),$a(t,r,null,n);var l=t.memoizedState;if(r=l.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Nl(e,t,r,n,o=cl(Error(a(423)),t));break e}if(r!==o){t=Nl(e,t,r,n,o=cl(Error(a(424)),t));break e}for(oa=co(t.stateNode.containerInfo.firstChild),ra=t,aa=!0,ia=null,n=Sa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ma(),r===o){t=Vl(e,t,n);break e}wl(e,t,r,n)}t=t.child}return t;case 5:return Ja(t),null===e&&sa(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,l=o.children,no(r,o)?l=null:null!==i&&no(r,i)&&(t.flags|=32),Cl(e,t),wl(e,t,l,n),t.child;case 6:return null===e&&sa(t),null;case 13:return Rl(e,t,n);case 4:return Ya(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xa(t,null,r,n):wl(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,xl(e,t,r,o=t.elementType===r?o:nl(r,o),n);case 7:return wl(e,t,t.pendingProps,n),t.child;case 8:case 12:return wl(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,l=o.value,Oo(ka,r._currentValue),r._currentValue=l,null!==i)if(lr(i.value,l)){if(i.children===o.children&&!No.current){t=Vl(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var u=i.dependencies;if(null!==u){l=i.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=za(-1,n&-n)).tag=2;var s=i.updateQueue;if(null!==s){var f=(s=s.shared).pending;null===f?c.next=c:(c.next=f.next,f.next=c),s.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),Pa(i.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===i.tag)l=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(l=i.return))throw Error(a(341));l.lanes|=n,null!==(u=l.alternate)&&(u.lanes|=n),Pa(l,n,t),l=i.sibling}else l=i.child;if(null!==l)l.return=i;else for(l=i;null!==l;){if(l===t){l=null;break}if(null!==(i=l.sibling)){i.return=l.return,l=i;break}l=l.return}i=l}wl(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Na(t,n),r=r(o=Ia(o)),t.flags|=1,wl(e,t,r,n),t.child;case 14:return o=nl(r=t.type,t.pendingProps),Sl(e,t,r,o=nl(r.type,o),n);case 15:return kl(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:nl(r,o),$l(e,t),t.tag=1,To(r)?(e=!0,Ro(t)):e=!1,Na(t,n),il(t,r,o),ul(t,r,o,n),_l(null,t,r,!0,e,n);case 19:return Kl(e,t,n);case 22:return jl(e,t,n)}throw Error(a(156,t.tag))};var Hc="function"==typeof reportError?reportError:function(e){console.error(e)};function qc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Zc(e,t,n,r,o){var a=n._reactRootContainer;if(a){var i=a;if("function"==typeof o){var l=o;o=function(){var e=Vc(i);l.call(e)}}$c(t,i,e,o)}else i=function(e,t,n,r,o){if(o){if("function"==typeof r){var a=r;r=function(){var e=Vc(i);a.call(e)}}var i=Kc(t,r,e,0,null,!1,0,"",Jc);return e._reactRootContainer=i,e[ho]=i.current,Kr(8===e.nodeType?e.parentNode:e),sc(),i}for(;o=e.lastChild;)e.removeChild(o);if("function"==typeof r){var l=r;r=function(){var e=Vc(u);l.call(e)}}var u=Uc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=u,e[ho]=u.current,Kr(8===e.nodeType?e.parentNode:e),sc(function(){$c(t,u,n,r)}),u}(n,t,e,o,r);return Vc(i)}Qc.prototype.render=qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));$c(e,t,null,null)},Qc.prototype.unmount=qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;sc(function(){$c(null,e,null,null)}),t[ho]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=jt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Tt.length&&0!==t&&t<Tt[n].priority;n++);Tt.splice(n,0,e),0===n&&Rt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ft(t.pendingLanes);0!==n&&(gt(t,1|n),rc(t,Xe()),!(6&_u)&&(Ku=Xe()+500,$o()))}break;case 13:sc(function(){var t=La(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Gc(e,1)}},St=function(e){if(13===e.tag){var t=La(e,134217728);null!==t&&nc(t,e,134217728,ec()),Gc(e,134217728)}},kt=function(e){if(13===e.tag){var t=tc(e),n=La(e,t);null!==n&&nc(n,e,t,ec()),Gc(e,t)}},jt=function(){return bt},Ct=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Se=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=So(r);if(!o)throw Error(a(90));H(r),J(r,o)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},_e=cc,Pe=sc;var es={usingClientEntryPoint:!1,Events:[wo,xo,So,Ee,Oe,cc]},ts={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ns={bundleType:ts.bundleType,version:ts.version,rendererPackageName:ts.rendererPackageName,rendererConfig:ts.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:ts.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rs.isDisabled&&rs.supportsFiber)try{ot=rs.inject(ns),at=rs}catch(se){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=es,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(a(299));var n=!1,r="",o=Hc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,o),e[ho]=t.current,Kr(8===e.nodeType?e.parentNode:e),new qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return sc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(a(200));return Zc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,o=!1,i="",l=Hc;if(null!=n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(l=n.onRecoverableError)),t=Kc(t,null,e,1,null!=n?n:null,o,0,i,l),e[ho]=t.current,Kr(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Qc(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(a(200));return Zc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(a(40));return!!e._reactRootContainer&&(sc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[ho]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Xc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Zc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},587:e=>{var t;e.exports=function(e){return function(n){var r=(n=n.toLowerCase().trim()).lastIndexOf("/");return r>=0&&(n=n.substr(r+1)),(r=n.lastIndexOf("."))>=0&&(n=n.substr(r+1)),t[n]||e}},t={"3gp":"video/3gpp",a:"application/octet-stream",ai:"application/postscript",aif:"audio/x-aiff",aiff:"audio/x-aiff",asc:"application/pgp-signature",asf:"video/x-ms-asf",asm:"text/x-asm",asx:"video/x-ms-asf",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bat:"application/x-msdownload",bin:"application/octet-stream",bmp:"image/bmp",bz2:"application/x-bzip2",c:"text/x-csrc",cab:"application/vnd.ms-cab-compressed",can:"application/candor",cc:"text/x-c++src",chm:"application/vnd.ms-htmlhelp",class:"application/octet-stream",com:"application/x-msdownload",conf:"text/plain",cpp:"text/x-c",crt:"application/x-x509-ca-cert",css:"text/css",csv:"text/csv",cxx:"text/x-c",deb:"application/x-debian-package",der:"application/x-x509-ca-cert",diff:"text/x-diff",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/x-msdownload",dmg:"application/octet-stream",doc:"application/msword",dot:"application/msword",dtd:"application/xml-dtd",dvi:"application/x-dvi",ear:"application/java-archive",eml:"message/rfc822",eps:"application/postscript",exe:"application/x-msdownload",f:"text/x-fortran",f77:"text/x-fortran",f90:"text/x-fortran",flv:"video/x-flv",for:"text/x-fortran",gem:"application/octet-stream",gemspec:"text/x-script.ruby",gif:"image/gif",gyp:"text/x-script.python",gypi:"text/x-script.python",gz:"application/x-gzip",h:"text/x-chdr",hh:"text/x-c++hdr",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",ifb:"text/calendar",iso:"application/octet-stream",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",less:"text/css",log:"text/plain",lua:"text/x-script.lua",luac:"application/x-bytecode.lua",makefile:"text/x-makefile",m3u:"audio/x-mpegurl",m4v:"video/mp4",man:"text/troff",manifest:"text/cache-manifest",markdown:"text/x-markdown",mathml:"application/mathml+xml",mbox:"application/mbox",mdoc:"text/troff",md:"text/x-markdown",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mime:"message/rfc822",mml:"application/mathml+xml",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ms:"text/troff",msi:"application/x-msdownload",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",p:"text/x-pascal",pas:"text/x-pascal",pbm:"image/x-portable-bitmap",pdf:"application/pdf",pem:"application/x-x509-ca-cert",pgm:"image/x-portable-graymap",pgp:"application/pgp-encrypted",pkg:"application/octet-stream",pl:"text/x-script.perl",pm:"text/x-script.perl-module",png:"image/png",pnm:"image/x-portable-anymap",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",py:"text/x-script.python",qt:"video/quicktime",ra:"audio/x-pn-realaudio",rake:"text/x-script.ruby",ram:"audio/x-pn-realaudio",rar:"application/x-rar-compressed",rb:"text/x-script.ruby",rdf:"application/rdf+xml",roff:"text/troff",rpm:"application/x-redhat-package-manager",rss:"application/rss+xml",rtf:"application/rtf",ru:"text/x-script.ruby",s:"text/x-asm",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",sig:"application/pgp-signature",snd:"audio/basic",so:"application/octet-stream",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tbz:"application/x-bzip-compressed-tar",tci:"application/x-topcloud",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",torrent:"application/x-bittorrent",tr:"text/troff",ttf:"application/x-font-ttf",txt:"text/plain",vcf:"text/x-vcard",vcs:"text/x-vcalendar",vrml:"model/vrml",war:"application/java-archive",wav:"audio/x-wav",webapp:"application/x-web-app-manifest+json",webm:"video/webm",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wrl:"model/vrml",wsdl:"application/wsdl+xml",xbm:"image/x-xbitmap",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",yaml:"text/yaml",yml:"text/yaml",zip:"application/zip"}},613:(e,t,n)=>{var r=n(503);e.exports=function(e,t,n){if(!e)throw new TypeError("must specify data as first parameter");if(n=0|+(n||0),Array.isArray(e)&&e[0]&&"number"==typeof e[0][0]){var o,a,i,l,u=e[0].length,c=e.length*u;t&&"string"!=typeof t||(t=new(r(t||"float32"))(c+n));var s=t.length-n;if(c!==s)throw new Error("source length "+c+" ("+u+"x"+e.length+") does not match destination length "+s);for(o=0,i=n;o<e.length;o++)for(a=0;a<u;a++)t[i++]=null===e[o][a]?NaN:e[o][a]}else if(t&&"string"!=typeof t)t.set(e,n);else{var f=r(t||"float32");if(Array.isArray(e)||"array"===t)for(o=0,i=n,l=(t=new f(e.length+n)).length;i<l;i++,o++)t[i]=null===e[o]?NaN:e[o];else 0===n?t=new f(e):(t=new f(e.length+n)).set(e,n)}return t}},621:(e,t,n)=>{"use strict";var r=n(16),o=n(613);e.exports=function e(t){if(!t)return null;if(t instanceof ArrayBuffer)return t;if("string"==typeof t)return r(t);if(ArrayBuffer.isView(t))return t.byteOffset?t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength):t.buffer;var n;if(t.buffer||t.data||t._data)return e(t.buffer||t.data||t._data);if(Array.isArray(t))for(var a=0;a<t.length;a++)if(null!=t[a].length){t=o(t);break}return(n=new Uint8Array(t)).length?n.buffer:null}},681:(e,t,n)=>{"use strict";var r=n(213).saveAs,o=n(547),a=null;function i(e,t){if("string"==typeof e&&("string"!=typeof t||t.length>e.length)){var n=t;t=e,e=n}var l=o(e,t);return a?a.then(function(){return a=i(e,t)}):a=new Promise(function(e,n){r(l,t),window.addEventListener("focus",function t(){a=null,window.removeEventListener("focus",t),e()})})}e.exports=i,e.exports.save=i,e.exports.saveSync=function(e,t){return r(o(e,t),t)}},848:(e,t,n)=>{"use strict";e.exports=n(20)},961:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(551)},982:(e,t,n)=>{"use strict";e.exports=n(463)},991:function(e,t){!function(){"use strict";function n(e,t){if(e instanceof Boolean||"boolean"==typeof e)return!1;if(t instanceof Object||(t={}),t.hasOwnProperty("allowBlank")&&!t.allowBlank&&""===e)return!1;var n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return t.mime&&(n="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+n),!1===t.paddingRequired&&(n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+n+"$","gi").test(e)}e.exports&&(t=e.exports=n),t.isBase64=n}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(373),t=n.n(e),r=n(540),o=n(338),a=n(681);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}for(var l=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],u=function(e){return 440*Math.pow(2,(e-69)/12)},c={},s={},f=[],d=0;d<=255;d++){var p=(d%12+12)%12,m=Math.floor(d/12)-1,h="".concat(l[p]).concat(m),v=u(d),y=d-12,g=y>=0&&y<=95,b=-1,w=0;g&&(b=Math.floor(y/12),w=y%12+4);var x={midi:d,name:h,frequency:v,semitone:p,octave:m,ticOctave:b,ticNoteNibble:w,isAvailableInPattern:g,ticAbsoluteNoteIndex:y};c[d]=x,s[h]=x,f.push(x)}function S(e){return c[e]}function k(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Assertion failed";if(arguments.length>0&&void 0!==arguments[0]&&!arguments[0])throw console.error("Assertion failed:",e),new Error(e)}Object.fromEntries(Object.entries(s).map(function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(t,n)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return[r[0],r[1].midi]}));var j=function(e,t,n){return Math.min(Math.max(e,t),n)};function C(e){return null==e||0===e.trim().length}function E(e){if("number"==typeof e&&isFinite(e))return Math.floor(e);if("string"==typeof e){var t=parseInt(e,10);if(!isNaN(t))return t}return null}function O(e,t){return null==e?t:e}var _=function(e){return null==e?"...":e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(1)," KB"):"".concat((e/1048576).toFixed(2)," MB")},P=function(e){return e[e.M=0]="M",e[e.C=1]="C",e[e.J=2]="J",e[e.S=3]="S",e[e.P=4]="P",e[e.V=5]="V",e[e.D=6]="D",e}({}),N=4,I=16,A=16,T=64,M=8,L=64,D=30,R=7,F=15,z=-8,U=7,B=15,K=16,$=32,V=16,W=function(e){return j(e,0,N-1)},G=85712;function H(e){return function(e){if(Array.isArray(e))return q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return q(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Q(e){for(var t=new Set,n=new Set,r=new Set,o=Math.max(e.patterns.length-1,0),a=0;a<e.songOrder.length;a++){var i=j(e.songOrder[a],0,o);t.add(i)}var l=Math.max(e.instruments.length-1,0);t.forEach(function(t){var r=e.patterns[t];r&&r.channels.forEach(function(e){e.rows.forEach(function(e){if(void 0!==e.instrumentIndex&&null!==e.instrumentIndex){var t=j(e.instrumentIndex,0,l);n.add(t)}})})});var u=Math.max(e.waveforms.length-1,0);n.forEach(function(t){var n=e.instruments[t];n&&n.waveFrames.forEach(function(e){r.add(j(e,0,u))})});var c=0===t.size?0:Math.max.apply(Math,H(t)),s=0===n.size?0:Math.max.apply(Math,H(n)),f=0===r.size?0:Math.max.apply(Math,H(r));return{usedPatterns:t,usedInstruments:n,usedWaveforms:r,maxPattern:c,maxInstrument:s,maxWaveform:f}}function Y(e){var t=e.clone(),n=[],r=new Map,o=new Map;t.patterns.forEach(function(e,t){var a=e.contentSignature(),i=r.get(a);void 0!==i?(o.set(t,i),n.push("Pattern ".concat(t," duplicated pattern ").concat(i,"; remapped usage."))):(r.set(a,t),o.set(t,t))});var a=new Set;t.songOrder=t.songOrder.map(function(e,r){var i,l=j(e,0,Math.max(t.patterns.length-1,0));l!==e&&n.push("Song order entry ".concat(r," clamped from ").concat(e," to ").concat(l,"."));var u=null!==(i=o.get(l))&&void 0!==i?i:l;return a.add(u),u});var i=[],l=new Map,u=function(e){l.set(e,i.length),i.push(t.patterns[e].clone())};t.patterns.forEach(function(e,t){a.has(t)&&u(t)}),t.patterns.forEach(function(e,t){a.has(t)||u(t)}),t.songOrder=t.songOrder.map(function(e){var t;return null!==(t=l.get(e))&&void 0!==t?t:0}),t.patterns=i;var c=a.size;n.push("Moved ".concat(c," used patterns to the front out of ").concat(i.length,"."));var s=new Set([0,1]);a.forEach(function(e){var n;t.patterns[null!==(n=l.get(e))&&void 0!==n?n:e].channels.forEach(function(e){e.rows.forEach(function(e){if(void 0!==e.instrumentIndex&&null!==e.instrumentIndex){var n=j(e.instrumentIndex,0,t.instruments.length-1);s.add(n)}})})});var f=[],d=new Map,p=function(e){d.set(e,f.length),f.push(t.instruments[e].clone())};t.instruments.forEach(function(e,t){s.has(t)&&p(t)}),t.instruments.forEach(function(e,t){s.has(t)||p(t)}),t.patterns.forEach(function(e){e.channels.forEach(function(e){e.rows.forEach(function(e){if(void 0!==e.instrumentIndex&&null!==e.instrumentIndex){var t,n=j(e.instrumentIndex,0,f.length-1),r=null!==(t=d.get(n))&&void 0!==t?t:0;e.instrumentIndex=r}})})}),t.instruments=f;var m=s.size;n.push("Packed instruments: ".concat(m," used (including reserved 0/1) of ").concat(f.length,"."));var h=new Set;s.forEach(function(e){var n=d.get(e);void 0!==n&&f[n].waveFrames.forEach(function(e){h.add(j(e,0,t.waveforms.length-1))})}),0===h.size&&h.add(0);var v=[],y=new Map,g=function(e){y.set(e,v.length),v.push(t.waveforms[e].clone())};t.waveforms.forEach(function(e,t){h.has(t)&&g(t)}),t.waveforms.forEach(function(e,t){h.has(t)||g(t)}),t.instruments.forEach(function(e){e.waveFrames=new Int8Array(e.waveFrames.map(function(e){var t,n=j(e,0,v.length-1);return null!==(t=y.get(n))&&void 0!==t?t:0}))}),t.waveforms=v;var b=h.size;return n.push("Packed waveforms: ".concat(b," used of ").concat(v.length,".")),t.songOrder.length>A&&(t.songOrder=t.songOrder.slice(0,A),n.push("Trimmed song order to ".concat(A," entries."))),0===t.songOrder.length&&(t.songOrder=[0],n.push("Song order was empty; added pattern 0.")),{optimizedSong:t,usedPatternCount:c,usedWaveformCount:b,usedSfxCount:m,changeLog:n,resultingStats:Q(t)}}function X(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Z(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||Z(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){if(e){if("string"==typeof e)return ee(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function te(e,t,n,r,o){var a=function(e){if(void 0===e)return{noteNibble:0,octave:0};var t=f[e];return{noteNibble:t.ticNoteNibble,octave:t.octave}}(e);return[(15&r)<<4|15&a.noteNibble,(t>>5&1)<<7|(7&n)<<4|15&o,(7&a.octave)<<5|31&t]}function ne(e,t){for(var n=new Uint8Array(3*T),r=0;r<T;r++){var o,a,i,l=e.getCell(t,r),u=null!==(o=l.instrumentIndex)&&void 0!==o?o:0,c=null!==(a=l.effectX)&&void 0!==a?a:0,s=null!==(i=l.effectY)&&void 0!==i?i:0,f=void 0===l.effect?0:j(l.effect+1,0,7),d=J(te(l.midiNote,u,f,c,s),3),p=d[0],m=d[1],h=d[2],v=3*r;n[v+0]=p,n[v+1]=m,n[v+2]=h}return n}function re(e){var t=function(e){return[ne(e,0),ne(e,1),ne(e,2),ne(e,3)]}(e),n=J(t,4),r=n[0],o=n[1],a=n[2],i=n[3],l=new Uint8Array(r.length+o.length+a.length+i.length),u=0;return l.set(r,u),u+=r.length,l.set(o,u),u+=o.length,l.set(a,u),u+=a.length,l.set(i,u),l}function oe(e){var t=63&e[0]|(63&e[1])<<6|(63&e[2])<<12|(63&e[3])<<18;return[255&t,t>>8&255,t>>16&255]}function ae(e){for(var t,n,r=new Uint8Array(3*I+3),o=0;o<I;o++){var a=J(oe(o%2==0?[1,2,3,4]:[5,6,7,8]),3),i=a[0],l=a[1],u=a[2],c=3*o;r[c+0]=i,r[c+1]=l,r[c+2]=u}return r[50]=(t=e.speed,6===(n=j(t,1,31))?0:n>=7?n-6:n+249),r[49]=64-e.rowsPerPattern,r[48]=e.tempo-150+256&255,r}function ie(e){for(var t=$/2,n=new Uint8Array(K*t),r=function(e){return Q(e).maxWaveform}(e)+1,o=0;o<r;o++)for(var a=e.waveforms[o],i=0;i<16;i++){var l,u,c=j(null!==(l=a.amplitudes[2*i])&&void 0!==l?l:0,0,15),s=j(null!==(u=a.amplitudes[2*i+1])&&void 0!==u?u:0,0,15);n[o*t+i]=c<<4|s}return n}function le(e){for(var t=function(e,t){var n=j(e,0,D-1);return j(t,0,D-1)<<4|n},n=function(e){for(var n,r,o=new Uint8Array(66),a=0;a<D;a++){var i=F-j(e.volumeFrames[a],0,F),l=j(e.waveFrames[a],0,15),u=j(e.arpeggioFrames[a],0,15),c=j(e.pitchFrames[a]+z,z,U);o[2*a+0]=(15&l)<<4|15&i,o[2*a+1]=(15&c)<<4|15&u}var s,f=e.arpeggioDown?1:0,d=((s=e.speed-4)<0&&(s+=8),7&s),p=j(null!==(n=e.octave)&&void 0!==n?n:0,0,7),m=e.pitch16x?1:0;o[60]=7&p|m<<3|d<<4|(f?128:0);var h=j(null!==(r=e.baseNote)&&void 0!==r?r:0,0,11),v=e.stereoLeft?0:1,y=e.stereoRight?0:1;return o[61]=15&h|v<<4|y<<5,o[62]=t(e.waveLoopStart,e.waveLoopLength),o[63]=t(e.volumeLoopStart,e.volumeLoopLength),o[64]=t(e.arpeggioLoopStart,e.arpeggioLoopLength),o[65]=t(e.pitchLoopStart,e.pitchLoopLength),o},r=function(e){return Q(e).maxInstrument}(e),o=new Uint8Array(66*r),a=1;a<r;a++){var i,l=n(null===(i=e.instruments)||void 0===i?void 0:i[a]);o.set(l,66*a)}return o}function ue(e){var t=ie(e),n=le(e),r=ae(e),o=new Uint8Array(257);o[0]=e.songOrder.length;for(var a=0;a<256;a++){var i,l=null!==(i=e.songOrder[a])&&void 0!==i?i:0;o[1+a]=255&l}var u=function(e){for(var t=[],n=0;n<e.patterns.length;n++){var r=re(e.patterns[n]);t.push(r)}return t}(e);return{waveformData:t,sfxData:n,trackData:r,songOrderData:o,patternData:ce(u)}}function ce(e){var t,n=0,r=X(e);try{for(r.s();!(t=r.n()).done;)n+=2+t.value.length}catch(e){r.e(e)}finally{r.f()}k(768===e[0].length,"ch_serializePatterns: unexpected pattern length ".concat(e[0].length,", expected 768"));var o,a=new Uint8Array(n),i=0,l=[],u=X(e);try{for(u.s();!(o=u.n()).done;){var c=o.value,s=65535&c.length;a[i++]=255&s,a[i++]=s>>8&255,a.set(c,i),i+=c.length;for(var f=0,d=0;d<c.length;d++)f+=c[d];f&=4294967295;var p=Array.from(c.slice(0,8)).map(function(e){return e.toString(16).padStart(2,"0")}).join(" ");l.push({checksum:f,length:c.length,firstBytes:p})}}catch(e){u.e(e)}finally{u.f()}return a}function se(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;n&&(t=function(e){if(0===e.length)return e;for(var t=e.length;t>0&&0===e[t-1];)t--;return e.slice(0,Math.max(1,t))}(t));var o=new Uint8Array(4+t.length);return o[0]=(7&r)<<5|31&e,o[1]=255&t.length,o[2]=t.length>>8&255,o[3]=0,o.set(t,4),o}function fe(e,t){var n=e.songOrder.map(function(e){return e.toString()}).join(","),r=function(e){return Q(e).maxPattern}(e),o=e.patterns.slice(0,r+1).map(function(e,t){return function(e){for(var t="",n=e.length,r=0;r<n;r+=4){for(var o,a,i,l,u=null!==(o=e[r])&&void 0!==o?o:0,c=null!==(a=e[r+1])&&void 0!==a?a:0,s=null!==(i=e[r+2])&&void 0!==i?i:0,f=null!==(l=e[r+3])&&void 0!==l?l:0,d=u*Math.pow(2,24)+c*Math.pow(2,16)+s*Math.pow(2,8)+f,p=new Array(5),m=4;m>=0;m--)p[m]=d%85,d=Math.floor(d/85);for(var h=0;h<5;h++)t+=String.fromCharCode(33+p[h])}return t}(re(e))}).map(function(e){return t=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r"),'"'.concat(t,'"');var t}).join(",\n\t\t"),a="-- BEGIN_SOMATIC_MUSIC_DATA\nSOMATIC_MUSIC_DATA = {\n\tsongOrder = { ".concat(n," },\n\tpatterns = {\n\t\t").concat(o,"\n\t},\n}\n-- END_SOMATIC_MUSIC_DATA"),i=function(e){return"debug"===e?'-- BEGIN_SOMATIC_MUSIC_DATA\r\nSOMATIC_MUSIC_DATA = {\r\n\tsongOrder = { 0, 3, 2 },\r\n\tpatterns = {\r\n\t\t"#lnB?!\'pSb!!!!!!!!!!!!!!!!!!!!#lm6k!!!!!!!`Ki!!!!!!!!!!!!`Ki!!!!!!!!!!!!`Ki!!!!(!\'pSb!!`Ki!!!!!!!!6(5l^lb!!!!(!\'pSb!!!!!#67$i!!!6(5l^lb!!!!!!!!6(5l^lb!!!!(!\'pSb!!!!!#67$i!!!!!!!`Ki!!!!!!!!6(5l^lb!!!!!!!!!!!!`Ki!!!!!!!!!!!!`Ki#67$i!!!!!!!`Ki!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\\"9;j1!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\\"9>+q!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",\r\n\t\t"#67$i!!!6(5l^lb!!!!(!\'pSb!!!!!!!!!(!\'pSb!!!!!#67$i!!!6(5l^lb#67$p!\'pSb!!`Ki#67%\\"!+?*45n3m\'#67$i!!!!!!!`Ki%KKo;!!!!!!!`Ki%KKoB!\'q(p@0Zcu!!!!(!\'pSb!\\"K!;#67$p!\'pSb!!!!!#67%\\"!+>j-!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\\"9;j1!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\\"9<uQ!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\\"TX)R!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",\r\n\t\t"#67$i!!!0&@K6B.!!!!(!\'pSb!!!!!%feor!!!N063dKV!!!!!!!!!!!!!!!%feor!!!!!!!!!!!!!!!!!!6(5l^lb!!!!!!!!!!!!!!!%feor!!!!!!!!!!!!!!!!!!!!!!`Ki!!!!!!!!!!!\\"T&r!!!!!!!!!!!!!!!!!!!(!\'pSb!!!!!!!!!!!!!!!!\\"T&r!!!!!!!!!!!!!!!#67$i!!!!!!!!!!!!!!0!($Yc!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#67$i!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#67$i!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#6804!!!!!!!!!!!!!!!!!!!!!!!!!",\r\n\t\t"%felq!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&!+>j-!!!!!!!!!!!!!!!!!!!!#9Z;4!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#67$i!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!%KKo;!!!!!!!!!!!!!!!!!!!!!!!!!#67$i!!!!!!\\"T&q!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!0+@,u-!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!N@2!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!E:Q!!!!!!!!!!!!!!!#lm6k!!!!!!!!!!!!!!!!!!!!!!N@2!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!%felq!!!!!!!!!!!!!!!!!!N05l^lb!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!-!\'pSb!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!0&@/p9-%KJcp!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!`Ki!!!!!!!!!!!!`Ki!!!!!!!!!!!!!!!!!!!!!!!0&@/p9-!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&!+>j-!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!0&@0Zcu%fem!!+?B<5mIBU\\"TVsA!\'phi5m76s!!!!!!!!!!!!!!!",\r\n\t\t"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",\r\n\t},\r\n}\r\n-- END_SOMATIC_MUSIC_DATA\r\n\r\n-- Debug logging\r\nlocal LOG_LINES = 15\r\nlocal log_lines = {}\r\nlocal log_serial = 0\r\n\r\nlocal function log(s)\r\n\tlog_serial = log_serial + 1\r\n\tlocal prefix = string.format("[%03d] ", log_serial)\r\n\ttrace(prefix .. s)\r\n\ttable.insert(log_lines, 1, prefix .. s)\r\n\tif #log_lines > LOG_LINES then\r\n\t\ttable.remove(log_lines)\r\n\tend\r\nend\r\n\r\n-- =========================\r\n-- general playroutine support\r\nmusicInitialized = false\r\ncurrentSongOrder = 0\r\nlastPlayingFrame = -1\r\nbackBufferIsA = false -- A means patterns 0,1,2,3; B = 4,5,6,7\r\nstopPlayingOnNextFrame = false\r\nlocal PATTERN_BUFFER_BYTES = 192 * 4 -- 192 bytes per pattern-channel * 4 channels\r\nlocal bufferALocation = 0x11164 -- pointer to first pattern https://github.com/nesbox/TIC-80/wiki/.tic-File-Format\r\nlocal bufferBLocation = bufferALocation + PATTERN_BUFFER_BYTES -- pointer to pattern 4\r\n\r\n-- base85 decode (ASCII85-style) for TIC-80 Lua\r\n-- Will become your compressed byte stream (before RLE3 decode)\r\n-- local bytes = base85_decode_to_bytes(PAT0_B85, COMPRESSED_LEN)\r\n-- returns array of byte values\r\nfunction base85_decode_to_bytes(s, expectedLen)\r\n\t-- Alphabet: chars with codes 33..117 (\'!\'..\'u\')\r\n\tlocal BASE85_RADIX = 85\r\n\tlocal BASE85_OFFSET = 33\r\n\r\n\tlocal n = #s\r\n\tif n % 5 ~= 0 then\r\n\t\terror("base85_decode_to_bytes: input length not multiple of 5")\r\n\tend\r\n\r\n\tlocal bytes = {}\r\n\tlocal outCount = 0\r\n\tlocal i = 1\r\n\r\n\twhile i <= n do\r\n\t\tlocal v = 0\r\n\r\n\t\t-- Read 5 base85 chars -> 32-bit value\r\n\t\tfor j = 1, 5 do\r\n\t\t\tlocal c = s:byte(i)\r\n\t\t\ti = i + 1\r\n\t\t\tlocal digit = c - BASE85_OFFSET\r\n\t\t\tif digit < 0 or digit >= BASE85_RADIX then\r\n\t\t\t\terror("base85_decode_to_bytes: invalid base85 char")\r\n\t\t\tend\r\n\t\t\tv = v * BASE85_RADIX + digit\r\n\t\tend\r\n\r\n\t\t-- Extract 4 bytes (big-endian)\r\n\t\tlocal b0 = math.floor(v / 16777216) % 256 -- 256^3\r\n\t\tlocal b1 = math.floor(v / 65536) % 256 -- 256^2\r\n\t\tlocal b2 = math.floor(v / 256) % 256 -- 256^1\r\n\t\tlocal b3 = v % 256 -- 256^0\r\n\r\n\t\t-- Append, but don\'t exceed expectedLen\r\n\t\tlocal remaining = expectedLen - outCount\r\n\t\tif remaining <= 0 then\r\n\t\t\tbreak\r\n\t\tend\r\n\r\n\t\tif remaining >= 1 then\r\n\t\t\tbytes[#bytes + 1] = b0\r\n\t\t\toutCount = outCount + 1\r\n\t\tend\r\n\t\tif remaining >= 2 then\r\n\t\t\tbytes[#bytes + 1] = b1\r\n\t\t\toutCount = outCount + 1\r\n\t\tend\r\n\t\tif remaining >= 3 then\r\n\t\t\tbytes[#bytes + 1] = b2\r\n\t\t\toutCount = outCount + 1\r\n\t\tend\r\n\t\tif remaining >= 4 then\r\n\t\t\tbytes[#bytes + 1] = b3\r\n\t\t\toutCount = outCount + 1\r\n\t\tend\r\n\tend\r\n\r\n\tif outCount ~= expectedLen then\r\n\t\terror("base85_decode_to_bytes: decoded length mismatch")\r\n\tend\r\n\r\n\treturn bytes\r\nend\r\n\r\nlocal function getSongOrderCount()\r\n\tlocal count = #SOMATIC_MUSIC_DATA.songOrder\r\n\tlog("getSongOrderCount: " .. tostring(count))\r\n\treturn count\r\nend\r\n\r\n-- demo version:\r\nlocal function swapInPlayorder(songPosition0b, destPointer)\r\n\tpatternIndex0b = SOMATIC_MUSIC_DATA.songOrder[songPosition0b + 1]\r\n\tpatternString = SOMATIC_MUSIC_DATA.patterns[patternIndex0b + 1]\r\n\tlocal patternLengthBytes = 192 * 4 -- 192 bytes per pattern-channel * 4 channels\r\n\tlog(string.format("swapIn: pos=%d pat=%d len=%d", songPosition0b, patternIndex0b, #patternString))\r\n\tpatternBytes = base85_decode_to_bytes(patternString, patternLengthBytes)\r\n\r\n\t-- Calculate checksum for debugging\r\n\tlocal checksum = 0\r\n\tfor i = 1, #patternBytes do\r\n\t\tchecksum = checksum + patternBytes[i]\r\n\tend\r\n\tlog(string.format("Pattern checksum: %d (bytes: %d)", checksum, #patternBytes))\r\n\r\n\t-- Log first few bytes of pattern data\r\n\tlocal sampleBytes = {}\r\n\tfor i = 1, math.min(12, #patternBytes) do\r\n\t\tsampleBytes[i] = string.format("%02X", patternBytes[i])\r\n\tend\r\n\tlog(string.format("First bytes: %s", table.concat(sampleBytes, " ")))\r\n\r\n\tfor i = 0, patternLengthBytes - 1 do\r\n\t\tpoke(destPointer + i, patternBytes[i + 1])\r\n\tend\r\n\tsync(24, 0, true)\r\nend\r\n\r\n-- =========================\r\n-- general playroutine support\r\n\r\nlocal function getBufferPointer()\r\n\tif backBufferIsA then\r\n\t\treturn bufferALocation\r\n\telse\r\n\t\treturn bufferBLocation\r\n\tend\r\nend\r\n\r\nlocal function clearPatternBuffer(destPointer)\r\n\tfor i = 0, PATTERN_BUFFER_BYTES - 1 do\r\n\t\tpoke(destPointer + i, 0)\r\n\tend\r\nend\r\n\r\ntf_music_reset_state = function()\r\n\tcurrentSongOrder = 0\r\n\tlastPlayingFrame = -1\r\n\tbackBufferIsA = false\r\n\tstopPlayingOnNextFrame = false\r\n\tlog("tf_music_reset_state")\r\n\t--ch_set_playroutine_regs(0xFF)\r\nend\r\n\r\ntf_music_reset_state()\r\n\r\n-- init state and begin playback from start\r\ntf_music_init = function(songPosition, startRow)\r\n\tsongPosition = songPosition or 0\r\n\tstartRow = startRow or 0\r\n\r\n\tlog(string.format("tf_music_init: pos=%d row=%d", songPosition, startRow))\r\n\r\n\t-- Initialize audio system - set master volume and enable all channels\r\n\t-- Master volume is at 0x14000 (range 0-15)\r\n\tpoke(0x14000, 15)\r\n\tlog("Set master volume to 15")\r\n\r\n\t-- Channel volumes at 0x14001-0x14004 (range 0-15 each)\r\n\tfor ch = 0, 3 do\r\n\t\tpoke(0x14001 + ch, 15)\r\n\tend\r\n\tlog("Set all channel volumes to 15")\r\n\r\n\t-- seed state\r\n\tcurrentSongOrder = songPosition\r\n\tbackBufferIsA = true -- act like we came from buffer B so tick() will set it correctly on first pass.\r\n\tlastPlayingFrame = -1 -- this means tick() will immediately seed the back buffer.\r\n\tstopPlayingOnNextFrame = false\r\n\r\n\tlocal patternIndex = swapInPlayorder(currentSongOrder, bufferALocation)\r\n\r\n\t--ch_set_playroutine_regs(currentSongOrder)\r\n\r\n\tmusic(\r\n\t\t0, -- track\r\n\t\t0, -- frame\r\n\t\tstartRow, -- row\r\n\t\tfalse, -- loop\r\n\t\ttrue -- sustain\r\n\t)\r\n\tlog("tf_music_init: music() called")\r\n\r\n\t-- Verify what\'s actually in memory at pattern 0\r\n\tlocal verifyBytes = {}\r\n\tfor i = 0, 11 do\r\n\t\tverifyBytes[i + 1] = string.format("%02X", peek(bufferALocation + i))\r\n\tend\r\n\tlog(string.format("Memory verify: %s", table.concat(verifyBytes, " ")))\r\nend\r\n\r\nlocal function get_music_pos()\r\n\tlocal track = peek(0x13FFC)\r\n\tlocal frame = peek(0x13FFD)\r\n\tlocal row = peek(0x13FFE)\r\n\r\n\tif track == 255 then\r\n\t\ttrack = -1\r\n\tend -- stopped / none\r\n\r\n\treturn track, frame, row\r\nend\r\n\r\nfunction tf_music_tick()\r\n\tlocal track, currentFrame = get_music_pos()\r\n\r\n\tif track == -1 then\r\n\t\treturn -- not playing\r\n\tend\r\n\r\n\tif currentFrame == lastPlayingFrame then\r\n\t\treturn\r\n\tend\r\n\r\n\tlog(string.format("tick: frm=%d last=%d", currentFrame, lastPlayingFrame))\r\n\r\n\tif stopPlayingOnNextFrame then\r\n\t\tlog("tick: stopping")\r\n\t\tmusic() -- stops playback.\r\n\t\ttf_music_reset_state()\r\n\t\treturn\r\n\tend\r\n\r\n\tbackBufferIsA = not backBufferIsA\r\n\tlastPlayingFrame = currentFrame\r\n\t--ch_set_playroutine_regs(currentSongOrder) -- the queued pattern is now playing; inform host.\r\n\tcurrentSongOrder = currentSongOrder + 1\r\n\r\n\tlocal destPointer = getBufferPointer()\r\n\tlocal orderCount = getSongOrderCount()\r\n\r\n\tlog(string.format("tick: advance to=%d count=%d", currentSongOrder, orderCount))\r\n\r\n\tif orderCount == 0 or currentSongOrder >= orderCount then\r\n\t\tlog("tick: end of song")\r\n\t\tclearPatternBuffer(destPointer)\r\n\t\tstopPlayingOnNextFrame = true\r\n\t\treturn\r\n\tend\r\n\r\n\tlocal patternIndex = swapInPlayorder(currentSongOrder, destPointer)\r\nend\r\n\r\n-- =========================\r\n-- TIC loop\r\n-- =========================\r\nfunction TIC()\r\n\tif not musicInitialized then\r\n\t\tlog("Initializing music...")\r\n\t\ttf_music_init(0, 0)\r\n\t\tmusicInitialized = true\r\n\tend\r\n\r\n\ttf_music_tick()\r\n\tcls(0)\r\n\tlocal y = 2\r\n\tprint("PLAYROUTINE TEST", 52, y, 12)\r\n\ty = y + 8\r\n\tlocal track, currentFrame, currentRow = get_music_pos()\r\n\tprint(string.format("t:%d f:%d r:%d", track, currentFrame, currentRow), 60, y, 6)\r\n\ty = y + 8\r\n\tprint(\r\n\t\tstring.format(\r\n\t\t\t"ord:%d buf:%s stop:%s",\r\n\t\t\tcurrentSongOrder,\r\n\t\t\ttostring(backBufferIsA),\r\n\t\t\ttostring(stopPlayingOnNextFrame)\r\n\t\t),\r\n\t\t2,\r\n\t\ty,\r\n\t\t11\r\n\t)\r\n\ty = y + 10\r\n\r\n\t-- Show logs\r\n\tprint("LOGS:", 2, y, 14)\r\n\ty = y + 8\r\n\tfor i = math.min(#log_lines, LOG_LINES), 1, -1 do\r\n\t\tlocal logY = y + (LOG_LINES - i) * 6\r\n\t\tif logY < 136 then\r\n\t\t\tprint(log_lines[i], 2, logY, 15)\r\n\t\tend\r\n\tend\r\nend\r\n':'-- BEGIN_SOMATIC_MUSIC_DATA\r\nSOMATIC_MUSIC_DATA = {\r\n\tsongOrder = { 0, 3, 2 },\r\n\tpatterns = {\r\n\t\t-- (base85 encoded patterns here ...)\r\n\t},\r\n}\r\n-- END_SOMATIC_MUSIC_DATA\r\n\r\ndo\r\n\tlocal initialized = false\r\n\tlocal currentSongOrder = 0\r\n\tlocal lastPlayingFrame = -1\r\n\tlocal backBufferIsA = false\r\n\tlocal stopPlayingOnNextFrame = false\r\n\tlocal PATTERN_BUFFER_BYTES = 192 * 4\r\n\tlocal bufferALocation = 0x11164\r\n\tlocal bufferBLocation = bufferALocation + PATTERN_BUFFER_BYTES\r\n\r\n\tfunction base85_decode_to_bytes(s, expectedLen)\r\n\t\tlocal RADIX, OFFSET = 85, 33\r\n\t\tlocal bytes, outCount = {}, 0\r\n\t\tlocal n, i = #s, 1\r\n\r\n\t\twhile i <= n and outCount < expectedLen do\r\n\t\t\tlocal v = 0\r\n\t\t\tfor _ = 1, 5 do\r\n\t\t\t\tlocal c = s:byte(i)\r\n\t\t\t\ti = i + 1\r\n\t\t\t\tlocal d = c - OFFSET\r\n\t\t\t\tv = v * RADIX + d\r\n\t\t\tend\r\n\r\n\t\t\tfor shift = 3, 0, -1 do\r\n\t\t\t\tif outCount >= expectedLen then\r\n\t\t\t\t\tbreak\r\n\t\t\t\tend\r\n\t\t\t\tbytes[#bytes + 1] = math.floor(v / (256 ^ shift)) % 256\r\n\t\t\t\toutCount = outCount + 1\r\n\t\t\tend\r\n\t\tend\r\n\r\n\t\treturn bytes\r\n\tend\r\n\r\n\tlocal function getSongOrderCount()\r\n\t\treturn #SOMATIC_MUSIC_DATA.songOrder\r\n\tend\r\n\r\n\tlocal function swapInPlayorder(songPosition0b, destPointer)\r\n\t\tlocal patternIndex0b = SOMATIC_MUSIC_DATA.songOrder[songPosition0b + 1]\r\n\t\tlocal patternString = SOMATIC_MUSIC_DATA.patterns[patternIndex0b + 1]\r\n\t\tlocal patternLengthBytes = 192 * 4\r\n\t\tlocal patternBytes = base85_decode_to_bytes(patternString, patternLengthBytes)\r\n\t\tfor i = 0, patternLengthBytes - 1 do\r\n\t\t\tpoke(destPointer + i, patternBytes[i + 1])\r\n\t\tend\r\n\t\tsync(24, 0, true)\r\n\tend\r\n\r\n\tlocal function getBufferPointer()\r\n\t\tif backBufferIsA then\r\n\t\t\treturn bufferALocation\r\n\t\telse\r\n\t\t\treturn bufferBLocation\r\n\t\tend\r\n\tend\r\n\r\n\tlocal function clearPatternBuffer(destPointer)\r\n\t\tfor i = 0, PATTERN_BUFFER_BYTES - 1 do\r\n\t\t\tpoke(destPointer + i, 0)\r\n\t\tend\r\n\tend\r\n\r\n\tlocal function reset_state()\r\n\t\tcurrentSongOrder = 0\r\n\t\tlastPlayingFrame = -1\r\n\t\tbackBufferIsA = false\r\n\t\tstopPlayingOnNextFrame = false\r\n\tend\r\n\r\n\tlocal function somatic_init(songPosition, startRow)\r\n\t\tsongPosition = songPosition or 0\r\n\t\tstartRow = startRow or 0\r\n\t\tpoke(0x14000, 15)\r\n\t\tfor ch = 0, 3 do\r\n\t\t\tpoke(0x14001 + ch, 15)\r\n\t\tend\r\n\t\tcurrentSongOrder = songPosition\r\n\t\tbackBufferIsA = true\r\n\t\tlastPlayingFrame = -1\r\n\t\tstopPlayingOnNextFrame = false\r\n\t\tswapInPlayorder(currentSongOrder, bufferALocation)\r\n\t\tmusic(0, 0, startRow, false, true)\r\n\tend\r\n\r\n\tfunction somatic_get_state()\r\n\t\tlocal track = peek(0x13FFC)\r\n\t\tlocal frame = peek(0x13FFD)\r\n\t\tlocal row = peek(0x13FFE)\r\n\t\tif track == 255 then\r\n\t\t\ttrack = -1\r\n\t\tend\r\n\t\treturn track, frame, row\r\n\tend\r\n\r\n\tfunction somatic_tick()\r\n\t\tif not initialized then\r\n\t\t\tsomatic_init(0, 0)\r\n\t\t\tinitialized = true\r\n\t\tend\r\n\t\tlocal track, currentFrame = somatic_get_state()\r\n\t\tif track == -1 then\r\n\t\t\treturn\r\n\t\tend\r\n\t\tif currentFrame == lastPlayingFrame then\r\n\t\t\treturn\r\n\t\tend\r\n\t\tif stopPlayingOnNextFrame then\r\n\t\t\tmusic()\r\n\t\t\treset_state()\r\n\t\t\treturn\r\n\t\tend\r\n\t\tbackBufferIsA = not backBufferIsA\r\n\t\tlastPlayingFrame = currentFrame\r\n\t\tcurrentSongOrder = currentSongOrder + 1\r\n\t\tlocal destPointer = getBufferPointer()\r\n\t\tlocal orderCount = getSongOrderCount()\r\n\t\tif orderCount == 0 or currentSongOrder >= orderCount then\r\n\t\t\tclearPatternBuffer(destPointer)\r\n\t\t\tstopPlayingOnNextFrame = true\r\n\t\t\treturn\r\n\t\tend\r\n\t\tswapInPlayorder(currentSongOrder, destPointer)\r\n\tend\r\nend -- do\r\n\r\nfunction TIC()\r\n\tsomatic_tick()\r\n\r\n\tcls(0)\r\n\tlocal y = 2\r\n\tprint("PLAYROUTINE TEST", 52, y, 12)\r\n\ty = y + 8\r\n\tlocal track, currentFrame, currentRow = somatic_get_state()\r\n\tprint(string.format("t:%d f:%d r:%d", track, currentFrame, currentRow), 60, y, 6)\r\nend\r\n'}(t),l=i.indexOf("-- END_SOMATIC_MUSIC_DATA");if(-1===l)throw new Error('Template marker "-- END_SOMATIC_MUSIC_DATA" not found in playroutine-min.lua');var u=i.indexOf("-- BEGIN_SOMATIC_MUSIC_DATA");if(-1===u)throw new Error('Could not find "BEGIN_SOMATIC_MUSIC_DATA" in template');var c=i.indexOf("\n",l);return{code:i.substring(0,u)+a+"\n"+i.substring(c+1),generatedCode:a}}function de(e,t,n){var r=function(e){return{optimizedSong:e,usedPatternCount:0,usedWaveformCount:0,usedSfxCount:0,changeLog:[],resultingStats:{usedPatterns:new Set,usedInstruments:new Set,usedWaveforms:new Set,maxPattern:0,maxInstrument:0,maxWaveform:0}}}(e);if(t){var o=Y(e);e=o.optimizedSong,r=o}for(var a=se(10,ie(e),!0),i=se(9,le(e),!0),l=se(15,new Uint8Array(1),!0),u=se(14,ae(e),!0),c=fe(e,n),s=c.code,f=c.generatedCode,d=se(5,function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=127&e.charCodeAt(n);return t}(s),!1,0),p=[d,a,i,l,u],m=p.reduce(function(e,t){return e+t.length},0),h=new Uint8Array(m),v=0,y=0,g=p;y<g.length;y++){var b=g[y];h.set(b,v),v+=b.length}return{waveformChunk:a,sfxChunk:i,patternChunk:l,trackChunk:u,codeChunk:d,generatedCode:f,optimizeResult:r,cartridge:h}}function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function me(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return he(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ve(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return ye(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(ye(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ye(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,ye(f,"constructor",c),ye(c,"constructor",u),u.displayName="GeneratorFunction",ye(c,o,"GeneratorFunction"),ye(f),ye(f,o,"Generator"),ye(f,r,function(){return this}),ye(f,"toString",function(){return"[object Generator]"}),(ve=function(){return{w:a,m:d}})()}function ye(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ye=function(e,t,n,r){function a(t,n){ye(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},ye(e,t,n,r)}function ge(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function be(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ge(a,r,o,i,l,"next",e)}function l(e){ge(a,r,o,i,l,"throw",e)}i(void 0)})}}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Se(r.key),r)}}function xe(e,t,n){return(t=Se(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Se(e){var t=function(e){if("object"!=pe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==pe(t)?t:t+""}var ke=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xe(this,"song",null),xe(this,"serializedSong",null),xe(this,"lastKnownMusicState",{somaticPatternIndex:0,somaticSongPosition:0,isPlaying:!1,tic80TrackIndex:-1,tic80FrameIndex:0,tic80RowIndex:0,isLooping:!1}),this.bridge=t},t=[{key:"setSong",value:(c=be(ve().m(function e(t){var n,r=this;return ve().w(function(e){for(;;)switch(e.n){case 0:if(this.song=t,!t){e.n=3;break}if(this.serializedSong=ue(t),(n=this.bridge())&&n.isReady()){e.n=1;break}return e.a(2);case 1:return e.n=2,n.invokeExclusive(function(){var e=be(ve().m(function e(t){return ve().w(function(e){for(;;)switch(e.n){case 0:t.uploadSongData(r.serializedSong,"Song has been modified.");case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:this.serializedSong=null;case 4:return e.a(2)}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"sfxNoteOn",value:(u=be(ve().m(function e(t,n,r,o){var a;return ve().w(function(e){for(;;)switch(e.n){case 0:if((a=this.bridge())&&a.isReady()){e.n=1;break}return e.a(2);case 1:return e.n=2,a.invokeExclusive(function(){var e=be(ve().m(function e(a){var i,l;return ve().w(function(e){for(;;)switch(e.n){case 0:return i=S(r).ticAbsoluteNoteIndex,l=n.speed,e.n=1,a.playSfx({sfxId:t,tic80Note:i,channel:o,speed:l}).catch(function(e){console.warn("[Tic80Backend] sfxNoteOn failed",e)});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e,this)})),function(e,t,n,r){return u.apply(this,arguments)})},{key:"sfxNoteOff",value:(l=be(ve().m(function e(t){var n;return ve().w(function(e){for(;;)switch(e.n){case 0:if((n=this.bridge())&&n.isReady()){e.n=1;break}return e.a(2);case 1:return e.n=2,n.invokeExclusive(function(){var e=be(ve().m(function e(n){return ve().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n.stopSfx({channel:t}).catch(function(e){console.warn("[Tic80Backend] sfxNoteOff failed",e)});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"playRow",value:(i=be(ve().m(function e(t,n){var r,o,a,i,l,u,c,s,f,d,p,m;return ve().w(function(e){for(;;)switch(e.n){case 0:if(r=this.song){e.n=1;break}return e.a(2);case 1:if((o=this.bridge())&&o.isReady()){e.n=2;break}return e.a(2);case 2:a=[],i=0;case 3:if(!(i<N)){e.n=8;break}if(u=i,(c=t.getCell(u,n)).midiNote&&null!=c.instrumentIndex){e.n=4;break}return e.a(3,7);case 4:if(s=S(c.midiNote)){e.n=5;break}return e.a(3,7);case 5:if(f=c.instrumentIndex,d=Math.max(0,Math.min(r.instruments.length-1,f)),p=r.instruments[d]){e.n=6;break}return e.a(3,7);case 6:m=Math.max(0,Math.min(7,null!==(l=p.speed)&&void 0!==l?l:0)),a.push({channel:u,sfxId:d,tic80Note:s.ticAbsoluteNoteIndex,speed:m});case 7:i++,e.n=3;break;case 8:return e.n=9,o.invokeExclusive(function(){var e=be(ve().m(function e(t){var n,r,o,i,l,u,c,s,f;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:n=me([0,1,2,3]),e.p=1,n.s();case 2:if((r=n.n()).done){e.n=7;break}return o=r.value,e.p=3,e.n=4,t.stopSfx({channel:o});case 4:e.n=6;break;case 5:e.p=5,c=e.v,console.warn("[Tic80Backend] stopSfx failed",c);case 6:e.n=2;break;case 7:e.n=9;break;case 8:e.p=8,s=e.v,n.e(s);case 9:return e.p=9,n.f(),e.f(9);case 10:i=0,l=a;case 11:if(!(i<l.length)){e.n=16;break}return u=l[i],e.p=12,e.n=13,t.playSfx(u);case 13:e.n=15;break;case 14:e.p=14,f=e.v,console.warn("[Tic80Backend] playSfx failed",f);case 15:i++,e.n=11;break;case 16:return e.a(2)}},e,null,[[12,14],[3,5],[1,8,9,10]])}));return function(t){return e.apply(this,arguments)}}());case 9:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"playPattern",value:(a=be(ve().m(function e(t){var n;return ve().w(function(e){for(;;)switch(e.n){case 0:if((n=this.bridge())&&n.isReady()){e.n=1;break}return e.a(2);case 1:n.invokeExclusive(function(){var e=be(ve().m(function e(t){return ve().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"playSong",value:(o=be(ve().m(function e(t,n){var r;return ve().w(function(e){for(;;)switch(e.n){case 0:if((r=this.bridge())&&r.isReady()){e.n=1;break}return e.a(2);case 1:return e.n=2,r.invokeExclusive(function(){var e=be(ve().m(function e(r){return ve().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r.play({songPosition:t,row:null!=n?n:0});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"panic",value:(r=be(ve().m(function e(){var t;return ve().w(function(e){for(;;)switch(e.n){case 0:if((t=this.bridge())&&t.isReady()){e.n=1;break}return e.a(2);case 1:return e.n=2,t.invokeExclusive(function(){var e=be(ve().m(function e(t){var n,r,o,a,i,l;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:n=me([0,1,2,3]),e.p=1,n.s();case 2:if((r=n.n()).done){e.n=7;break}return o=r.value,e.p=3,e.n=4,t.stopSfx({channel:o});case 4:e.n=6;break;case 5:e.p=5,a=e.v,console.warn("[Tic80Backend] panic stopSfx failed",a);case 6:e.n=2;break;case 7:e.n=9;break;case 8:e.p=8,i=e.v,n.e(i);case 9:return e.p=9,n.f(),e.f(9);case 10:return e.p=10,e.n=11,t.stop();case 11:e.n=13;break;case 12:e.p=12,l=e.v,console.warn("[Tic80Backend] panic stop failed",l);case 13:return e.a(2)}},e,null,[[10,12],[3,5],[1,8,9,10]])}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"stop",value:(n=be(ve().m(function e(){var t;return ve().w(function(e){for(;;)switch(e.n){case 0:if(!(t=this.bridge())||!t.isReady()){e.n=1;break}return e.n=1,t.invokeExclusive(function(){var e=be(ve().m(function e(t){return ve().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.stop();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getMusicState",value:function(){var e=this.bridge();if(!e||!e.isReady())return this.lastKnownMusicState;var t=e.peekS8(81916),n=e.peekU8(81917),r=e.peekU8(81918),o=e.peekU8(81919),a=e.peekU8(85569),i=e.peekU8(85568),l=!!(1&o);return this.lastKnownMusicState={tic80RowIndex:r,tic80FrameIndex:n,tic80TrackIndex:t,somaticPatternIndex:a,somaticSongPosition:255===i?-1:i,isPlaying:255!==i,isLooping:l},this.lastKnownMusicState}}],t&&we(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,o,a,i,l,u,c}();function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ce(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ee(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ee(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_e(r.key),r)}}function _e(e){var t=function(e){if("object"!=je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==je(t)?t:t+""}var Pe=function(){return e=function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,r=[],(n=_e(n="voices"))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r;for(var o=0;o<N;o++)this.voices.push({channel:o,midiNote:null,instrumentIndex:null,timestamp:0})},(t=[{key:"allocateVoice",value:function(e,t){var n,r=performance.now(),o=Ce(this.voices);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(null===a.midiNote)return a.midiNote=t,a.instrumentIndex=e,a.timestamp=r,a.channel}}catch(e){o.e(e)}finally{o.f()}var i,l=this.voices[0],u=Ce(this.voices);try{for(u.s();!(i=u.n()).done;){var c=i.value;c.timestamp<l.timestamp&&(l=c)}}catch(e){u.e(e)}finally{u.f()}return l.midiNote=t,l.instrumentIndex=e,l.timestamp=r,l.channel}},{key:"releaseVoice",value:function(e){var t,n=Ce(this.voices);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.midiNote===e){var o=r.channel;return r.midiNote=null,r.instrumentIndex=null,r.timestamp=0,o}}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"releaseAll",value:function(){var e,t=[],n=Ce(this.voices);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!==r.midiNote&&(t.push(r.channel),r.midiNote=null,r.instrumentIndex=null,r.timestamp=0)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getChannelForNote",value:function(e){var t,n=Ce(this.voices);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.midiNote===e)return r.channel}}catch(e){n.e(e)}finally{n.f()}return null}}])&&Oe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ae(r.key),r)}}function Ae(e){var t=function(e){if("object"!=Ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ne(t)?t:t+""}var Te=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.volume=.3,this.song=null,this.isPlaying=!1,this.voiceManager=new Pe,this.backend=new ke(t.bridgeGetter)},(t=[{key:"setSong",value:function(e,t){this.song=e,this.backend.setSong(e,t)}},{key:"stop",value:function(){this.backend.stop(),this.isPlaying=!1}},{key:"getMusicState",value:function(){return this.backend.getMusicState()}},{key:"sfxNoteOn",value:function(e,t){if(this.song){var n=this.voiceManager.allocateVoice(e,t);this.backend.sfxNoteOn(e,this.song.instruments[e],t,n)}}},{key:"sfxNoteOff",value:function(e){var t=this.voiceManager.releaseVoice(e);null!==t&&this.backend.sfxNoteOff(t)}},{key:"readRow",value:function(e,t){this.backend.playRow(e,t)}},{key:"playRow",value:function(e,t){this.backend.playRow(e,t)}},{key:"playSong",value:function(e,t){this.backend.playSong(e,t),this.isPlaying=!0}},{key:"panic",value:function(){this.voiceManager.releaseAll(),this.backend.panic(),this.isPlaying=!1}}])&&Ie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),Me=n(848);function Le(e,t){if(e){if("string"==typeof e)return De(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?De(e,t):void 0}}function De(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Re=(0,r.createContext)(null),Fe=function(e){var t,n,o=e.children,a=(t=(0,r.useState)([]),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(t,n)||Le(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],l=a[1],u=(0,r.useRef)({}),c=(0,r.useCallback)(function(e){var t=u.current[e];t&&(window.clearTimeout(t),delete u.current[e]),l(function(t){return t.filter(function(t){return t.id!==e})})},[]),s=(0,r.useCallback)(function(e){var t,n,r="toast-".concat(Date.now().toString(36),"-").concat(Math.random().toString(36).slice(2,7)),o={id:r,message:e.message,variant:null!==(t=e.variant)&&void 0!==t?t:"info",durationMs:null!==(n=e.durationMs)&&void 0!==n?n:3500};return l(function(e){return[].concat(function(e){return function(e){if(Array.isArray(e))return De(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Le(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e),[o])}),o.durationMs>0&&Number.isFinite(o.durationMs)&&(u.current[r]=window.setTimeout(function(){return c(r)},o.durationMs)),r},[c]);(0,r.useEffect)(function(){return function(){Object.values(u.current).forEach(function(e){return window.clearTimeout(e)})}},[]);var f=(0,r.useMemo)(function(){return{pushToast:s,removeToast:c}},[s,c]);return(0,Me.jsxs)(Re.Provider,{value:f,children:[o,(0,Me.jsx)("div",{className:"toast-viewport","aria-live":"polite","aria-atomic":"false",children:i.map(function(e){return(0,Me.jsxs)("div",{className:"toast toast--".concat(e.variant),role:"status",children:[(0,Me.jsx)("div",{className:"toast__stripe","aria-hidden":"true"}),(0,Me.jsxs)("div",{className:"toast__body",children:[(0,Me.jsx)("div",{className:"toast__message",children:e.message}),(0,Me.jsx)("button",{className:"toast__close",onClick:function(){return c(e.id)},"aria-label":"Dismiss notification",type:"button",children:"x"})]})]},e.id)})})]})},ze=function(){var e=(0,r.useContext)(Re);if(!e)throw new Error("useToasts must be used within a ToastProvider");return e};function Ue(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return Be(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(Be(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Be(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Be(f,"constructor",c),Be(c,"constructor",u),u.displayName="GeneratorFunction",Be(c,o,"GeneratorFunction"),Be(f),Be(f,o,"Generator"),Be(f,r,function(){return this}),Be(f,"toString",function(){return"[object Generator]"}),(Ue=function(){return{w:a,m:d}})()}function Be(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Be=function(e,t,n,r){function a(t,n){Be(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Be(e,t,n,r)}function Ke(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function $e(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Ke(a,r,o,i,l,"next",e)}function l(e){Ke(a,r,o,i,l,"throw",e)}i(void 0)})}}var Ve=(0,r.createContext)(void 0),We=function(e){var t=e.children,n=ze(),o=(0,r.useCallback)(function(){var e=$e(Ue().m(function e(t){var r;return Ue().w(function(e){for(;;)switch(e.n){case 0:return r=JSON.stringify(t),e.n=1,navigator.clipboard.writeText(r);case 1:n.pushToast({message:"Copied ".concat(r.length," chars to clipboard")});case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),[]),a=(0,r.useCallback)($e(Ue().m(function e(){var t;return Ue().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,navigator.clipboard.readText();case 1:return t=e.v,n.pushToast({message:"Read ".concat(t.length," chars from clipboard")}),e.a(2,JSON.parse(t))}},e)})),[]),i=(0,r.useCallback)(function(){var e=$e(Ue().m(function e(t){return Ue().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,navigator.clipboard.writeText(t);case 1:n.pushToast({message:"Copied ".concat(t.length," chars to clipboard")});case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),[]),l=(0,r.useCallback)($e(Ue().m(function e(){var t;return Ue().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,navigator.clipboard.readText();case 1:return t=e.v,n.pushToast({message:"Read ".concat(t.length," chars from clipboard")}),e.a(2,t)}},e)})),[]);return(0,Me.jsx)(Ve.Provider,{value:{copyObjectToClipboard:o,readObjectFromClipboard:a,copyTextToClipboard:i,readTextFromClipboard:l},children:t})},Ge=function(){var e=(0,r.useContext)(Ve);if(!e)throw new Error("useClipboard must be used within a ClipboardProvider");return e};function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function Qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ye(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return Xe(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(Xe(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Xe(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Xe(f,"constructor",c),Xe(c,"constructor",u),u.displayName="GeneratorFunction",Xe(c,o,"GeneratorFunction"),Xe(f),Xe(f,o,"Generator"),Xe(f,r,function(){return this}),Xe(f,"toString",function(){return"[object Generator]"}),(Ye=function(){return{w:a,m:d}})()}function Xe(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Xe=function(e,t,n,r){function a(t,n){Xe(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Xe(e,t,n,r)}function Je(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,tt(r.key),r)}}function et(e,t,n){return(t=tt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tt(e){var t=function(e){if("object"!=qe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qe(t)?t:t+""}var nt=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),et(this,"status","pending"),et(this,"devices",[]),et(this,"noteOnListeners",new Set),et(this,"noteOffListeners",new Set),et(this,"deviceListeners",new Set),et(this,"access",null),et(this,"enabled",!0)},t=[{key:"init",value:(n=Ye().m(function e(){var t,n,r=this;return Ye().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("[MidiManager] Initializing MIDI..."),navigator.requestMIDIAccess){e.n=1;break}return this.status="unsupported",console.warn("[MidiManager] Web MIDI API not supported in this browser."),this.emitDevices(),e.a(2);case 1:return this.status="pending",e.p=2,e.n=3,navigator.requestMIDIAccess({sysex:!1});case 3:t=e.v,this.access=t,this.status="ready",t.onstatechange=function(){return r.refreshDevices()},this.attachInputs(),this.refreshDevices(),e.n=5;break;case 4:e.p=4,n=e.v,console.warn("[MidiManager] Error accessing MIDI devices",n),this.status="denied",console.warn("[MidiManager] MIDI access denied",n);case 5:this.emitDevices();case 6:return e.a(2)}},e,this,[[2,4]])}),r=function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){Je(a,r,o,i,l,"next",e)}function l(e){Je(a,r,o,i,l,"throw",e)}i(void 0)})},function(){return r.apply(this,arguments)})},{key:"getStatus",value:function(){return this.status}},{key:"getDevices",value:function(){return function(e){return function(e){if(Array.isArray(e))return Qe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Qe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.devices)}},{key:"onDevicesChanged",value:function(e){var t=this;return this.deviceListeners.add(e),e(this.getDevices()),function(){return t.deviceListeners.delete(e)}}},{key:"onNoteOn",value:function(e){var t=this;return this.noteOnListeners.add(e),function(){return t.noteOnListeners.delete(e)}}},{key:"onNoteOff",value:function(e){var t=this;return this.noteOffListeners.add(e),function(){return t.noteOffListeners.delete(e)}}},{key:"setEnabled",value:function(e){this.enabled=e,console.log("[MidiManager] MIDI input ".concat(e?"enabled":"disabled"))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"emitDevices",value:function(){var e=this.getDevices();this.deviceListeners.forEach(function(t){return t(e)})}},{key:"refreshDevices",value:function(){if(this.access){var e=[];this.access.inputs.forEach(function(t){e.push({id:t.id,name:t.name||"Unknown device",manufacturer:t.manufacturer||void 0,state:t.state})}),this.devices=e,this.emitDevices(),this.attachInputs()}}},{key:"attachInputs",value:function(){var e=this;this.access&&this.access.inputs.forEach(function(t){t.onmidimessage=null,t.onmidimessage=function(n){return e.handleMessage(t.id,n)}})}},{key:"handleMessage",value:function(e,t){var n=Array.from(t.data||[]),r=n[0],o=n[1],a=n[2],i=240&r,l=15&r,u=null!=a?a:0;144===i&&u>0?this.dispatchNote(!0,{note:o,velocity:u,channel:l,deviceId:e}):(128===i||144===i&&0===u)&&this.dispatchNote(!1,{note:o,velocity:u,channel:l,deviceId:e})}},{key:"dispatchNote",value:function(e,t){this.enabled&&(e?this.noteOnListeners:this.noteOffListeners).forEach(function(e){return e(t)})}}],t&&Ze(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function rt(e){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,it(r.key),r)}}function at(e,t,n){return(t=it(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function it(e){var t=function(e){if("object"!=rt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==rt(t)?t:t+""}var lt="-zsxdcvgbhnjmq2w3er5t6y7ui".split(""),ut=function(){return e=function e(t){var n,r,o,a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),at(this,"noteOnListeners",new Set),at(this,"noteOffListeners",new Set),at(this,"enabled",!0),at(this,"activeKeys",new Set),at(this,"initialized",!1),at(this,"handleKeyDown",function(e){var t;if(a.enabled&&!function(e){var t,n=e;if(!n)return!1;var r=null===(t=n.tagName)||void 0===t?void 0:t.toLowerCase();return"input"===r||"textarea"===r||"select"===r||"button"===r||n.isContentEditable}(e.target)&&("command"!==(t=function(e){var t;if(!e)return null;var n=null===(t=e.dataset)||void 0===t?void 0:t.cellType;return"note"===n||"instrument"===n||"command"===n||"param"===n?n:null}(e.target))&&"param"!==t&&!(e.metaKey||e.ctrlKey||e.altKey||e.repeat))){var n=a.noteKeyMap.indexOf(e.key);if(-1!==n&&!a.activeKeys.has(e.key)){a.activeKeys.add(e.key);var r={note:n+12*(a.getOctave()-1),velocity:127,channel:0,deviceId:a.sourceId};a.noteOnListeners.forEach(function(e){return e(r)}),e.preventDefault()}}}),at(this,"handleKeyUp",function(e){if(a.enabled){var t=a.noteKeyMap.indexOf(e.key);if(-1!==t&&a.activeKeys.has(e.key)){a.activeKeys.delete(e.key);var n={note:t+12*(a.getOctave()-1),velocity:0,channel:0,deviceId:a.sourceId};a.noteOffListeners.forEach(function(e){return e(n)}),e.preventDefault()}}}),this.getOctave=null!==(n=null==t?void 0:t.getOctave)&&void 0!==n?n:function(){return 4},this.noteKeyMap=null!==(r=null==t?void 0:t.noteKeyMap)&&void 0!==r?r:lt,this.sourceId=null!==(o=null==t?void 0:t.sourceId)&&void 0!==o?o:"keyboard"},(t=[{key:"init",value:function(){this.initialized||(window.addEventListener("keydown",this.handleKeyDown,!0),window.addEventListener("keyup",this.handleKeyUp,!0),this.initialized=!0)}},{key:"dispose",value:function(){this.initialized&&(window.removeEventListener("keydown",this.handleKeyDown,!0),window.removeEventListener("keyup",this.handleKeyUp,!0),this.initialized=!1)}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"isEnabled",value:function(){return this.enabled}},{key:"onNoteOn",value:function(e){var t=this;return this.noteOnListeners.add(e),function(){return t.noteOnListeners.delete(e)}}},{key:"onNoteOff",value:function(e){var t=this;return this.noteOffListeners.add(e),function(){return t.noteOffListeners.delete(e)}}}])&&ot(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ct(e){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ct(e)}function st(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?st(Object(n),!0).forEach(function(t){dt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function dt(e,t,n){return(t=vt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pt(e){return function(e){if(Array.isArray(e))return mt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return mt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vt(r.key),r)}}function vt(e){var t=function(e){if("object"!=ct(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ct(t)?t:t+""}var yt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.octave,r=void 0===n?Math.floor(M/2):n,o=t.activeSongPosition,a=void 0===o?0:o,i=t.currentInstrument,l=void 0===i?2:i,u=t.editingEnabled,c=void 0!==u&&u,s=t.patternEditRow,f=void 0===s?0:s,d=t.patternEditChannel,p=void 0===d?0:d,m=t.selectedArrangementPositions,h=void 0===m?[]:m,v=t.patternSelection,y=void 0===v?null:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.octave=j(r,1,M),this.activeSongPosition=j(a,0,255),this.currentInstrument=j(l,0,L-1),this.editingEnabled=O(c,!0),this.patternEditRow=j(f,0,63),this.patternEditChannel=W(p),this.selectedArrangementPositions=pt(h),this.patternSelection=y?this.normalizePatternSelection(y):null}return t=e,n=[{key:"setOctave",value:function(e){this.octave=j(e,1,M)}},{key:"setActiveSongPosition",value:function(e){this.activeSongPosition=j(e,0,255)}},{key:"setCurrentInstrument",value:function(e){this.currentInstrument=j(e,0,L-1)}},{key:"setEditingEnabled",value:function(e){this.editingEnabled=Boolean(e)}},{key:"setPatternEditTarget",value:function(e){var t=e.rowIndex,n=e.channelIndex;this.patternEditRow=j(t,0,T-1),this.patternEditChannel=n}},{key:"setArrangementSelection",value:function(e){this.selectedArrangementPositions=pt(e)}},{key:"setPatternSelection",value:function(e){this.patternSelection=e?this.normalizePatternSelection(e):null}},{key:"advancePatternEditRow",value:function(e){var t=j((arguments.length>1&&void 0!==arguments[1]?arguments[1]:T)-1,0,T-1),n=j(e,-T,T);this.patternEditRow=j(this.patternEditRow+n,0,t)}},{key:"normalizePatternSelection",value:function(e){return{startRow:j(Math.min(e.startRow,e.endRow),0,T-1),endRow:j(Math.max(e.startRow,e.endRow),0,T-1),startChannel:j(Math.min(e.startChannel,e.endChannel),0,N-1),endChannel:j(Math.max(e.startChannel,e.endChannel),0,N-1)}}},{key:"toData",value:function(){return{octave:this.octave,activeSongPosition:this.activeSongPosition,currentInstrument:this.currentInstrument,editingEnabled:this.editingEnabled,patternEditRow:this.patternEditRow,patternEditChannel:this.patternEditChannel,selectedArrangementPositions:pt(this.selectedArrangementPositions),patternSelection:this.patternSelection?ft({},this.patternSelection):null}}},{key:"clone",value:function(){return e.fromData(this.toData())}}],r=[{key:"fromData",value:function(t){return new e(t||{})}}],n&&ht(t.prototype,n),r&&ht(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}(),gt=["name"];function bt(e){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bt(e)}function wt(e){return function(e){if(Array.isArray(e))return xt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return xt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,kt(r.key),r)}}function kt(e){var t=function(e){if("object"!=bt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=bt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==bt(t)?t:t+""}var jt=function(){function e(){var t,n,r,o,a,i,l,u,c,s,f,d,p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=null!==(t=p.name)&&void 0!==t?t:"",this.speed=j(null!==(n=p.speed)&&void 0!==n?n:3,0,R),this.baseNote=j(null!==(r=p.baseNote)&&void 0!==r?r:0,0,11),this.octave=j(null!==(o=p.octave)&&void 0!==o?o:4,0,7),this.stereoLeft=O(p.stereoLeft,!0),this.stereoRight=O(p.stereoRight,!0),this.volumeFrames=p.volumeFrames?new Int8Array(p.volumeFrames):new Int8Array(D),this.volumeFrames.length<D){var m=new Int8Array(D);m.set(this.volumeFrames),this.volumeFrames=m}if(!p.volumeFrames)for(var h=0;h<D;h++)this.volumeFrames[h]=15;if(this.volumeLoopStart=j(null!==(a=p.volumeLoopStart)&&void 0!==a?a:0,0,D-1),this.volumeLoopLength=j(null!==(i=p.volumeLoopLength)&&void 0!==i?i:0,0,D-1),this.arpeggioFrames=p.arpeggioFrames?new Int8Array(p.arpeggioFrames):new Int8Array(D),this.arpeggioLoopStart=j(null!==(l=p.arpeggioLoopStart)&&void 0!==l?l:0,0,D-1),this.arpeggioLoopLength=j(null!==(u=p.arpeggioLoopLength)&&void 0!==u?u:0,0,D-1),this.arpeggioDown=O(p.arpeggioDown,!1),this.waveFrames=p.waveFrames?new Int8Array(p.waveFrames):new Int8Array(D),this.waveLoopStart=j(null!==(c=p.waveLoopStart)&&void 0!==c?c:0,0,D-1),this.waveLoopLength=j(null!==(s=p.waveLoopLength)&&void 0!==s?s:0,0,D-1),this.pitchFrames=p.pitchFrames?new Int8Array(p.pitchFrames):new Int8Array(D),!p.pitchFrames)for(var v=0;v<D;v++)this.pitchFrames[v]=-z;this.pitchLoopStart=j(null!==(f=p.pitchLoopStart)&&void 0!==f?f:0,0,D-1),this.pitchLoopLength=j(null!==(d=p.pitchLoopLength)&&void 0!==d?d:0,0,D-1),this.pitch16x=O(p.pitch16x,!1)}return t=e,n=[{key:"toData",value:function(){return{name:this.name,speed:this.speed,baseNote:this.baseNote,octave:this.octave,stereoLeft:this.stereoLeft,stereoRight:this.stereoRight,volumeFrames:wt(this.volumeFrames),volumeLoopStart:this.volumeLoopStart,volumeLoopLength:this.volumeLoopLength,arpeggioFrames:wt(this.arpeggioFrames),arpeggioLoopStart:this.arpeggioLoopStart,arpeggioLoopLength:this.arpeggioLoopLength,arpeggioDown:this.arpeggioDown,waveFrames:wt(this.waveFrames),waveLoopStart:this.waveLoopStart,waveLoopLength:this.waveLoopLength,pitchFrames:wt(this.pitchFrames),pitchLoopStart:this.pitchLoopStart,pitchLoopLength:this.pitchLoopLength,pitch16x:this.pitch16x}}},{key:"clone",value:function(){return new e(this.toData())}},{key:"contentSignature",value:function(){var e=this.toData(),t=(e.name,function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,gt));return JSON.stringify(t)}}],r=[{key:"fromData",value:function(t){return new e(t||{})}}],n&&St(t.prototype,n),r&&St(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function Ct(e){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ct(e)}function Et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(n),!0).forEach(function(t){_t(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Et(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _t(e,t,n){return(t=Tt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Nt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function It(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tt(r.key),r)}}function At(e,t,n){return t&&It(e.prototype,t),n&&It(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tt(e){var t=function(e){if("object"!=Ct(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ct(t)?t:t+""}function Mt(e){return 1===e.instrumentIndex}var Lt=function(){function e(t){var n;Nt(this,e),this.rows=t?function(e){if(Array.isArray(e))return Pt(e)}(n=t.rows)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return Pt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pt(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}():[],this.ensureRows(T)}return At(e,[{key:"setRow",value:function(e,t){e<0||e>=this.rows.length||(this.ensureRows(e+1),this.rows[e]=Ot({},t))}},{key:"ensureRows",value:function(e){for(;this.rows.length<e;)this.rows.push({})}},{key:"toData",value:function(){return{rows:this.rows.map(function(e){return Ot({},e)})}}},{key:"clone",value:function(){return e.fromData(this.toData())}}],[{key:"fromData",value:function(t){return new e(t)}}])}(),Dt=function(){function e(t){var n;Nt(this,e),t?(k(t.channels.length===N),this.name=null!==(n=t.name)&&void 0!==n?n:"",this.channels=[new Lt(t.channels[0]),new Lt(t.channels[1]),new Lt(t.channels[2]),new Lt(t.channels[3])]):(this.name="",this.channels=[new Lt,new Lt,new Lt,new Lt])}return At(e,[{key:"toData",value:function(){return{name:this.name,channels:[this.channels[0].toData(),this.channels[1].toData(),this.channels[2].toData(),this.channels[3].toData()]}}},{key:"setCell",value:function(e,t,n){this.channels[e].setRow(t,n)}},{key:"getCell",value:function(e,t){return this.channels[e].ensureRows(t+1),this.channels[e].rows[t]}},{key:"clone",value:function(){return e.fromData(this.toData())}},{key:"contentSignature",value:function(){var e=this.toData();return JSON.stringify({channels:e.channels})}}],[{key:"fromData",value:function(t){return new e(t)}}])}(),Rt=["name"];function Ft(e){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ft(e)}function zt(e){return function(e){if(Array.isArray(e))return Ut(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ut(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ut(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Kt(r.key),r)}}function Kt(e){var t=function(e){if("object"!=Ft(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ft(t)?t:t+""}var $t=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=null!==(t=n.name)&&void 0!==t?t:"",this.amplitudes=n.amplitudes?new Uint8Array(n.amplitudes):new Uint8Array($),this.amplitudes.length!==$){var r=new Uint8Array($);r.set(this.amplitudes.subarray(0,Math.min(this.amplitudes.length,$))),this.amplitudes=r}}return t=e,n=[{key:"toData",value:function(){return{name:this.name,amplitudes:zt(this.amplitudes)}}},{key:"clone",value:function(){return new e(this.toData())}},{key:"contentSignature",value:function(){var e=this.toData(),t=(e.name,function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Rt));return JSON.stringify(t)}}],r=[{key:"fromData",value:function(t){return new e(t||{})}}],n&&Bt(t.prototype,n),r&&Bt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gt(r.key),r)}}function Gt(e){var t=function(e){if("object"!=Vt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Vt(t)?t:t+""}var Ht=function(){function e(){var t,n,r,o,a,i,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instruments=function(e){var t=Array.from({length:L},function(t,n){var r=e[n],o=new jt(r);return C(o.name)&&(o.name=0===n?"dontuse":1===n?"off":"SFX ".concat(n)),o});return t[1].volumeFrames.fill(0),t}(l.instruments||[]),this.patterns=function(e){var t=e.map(function(e){return Dt.fromData(e)});return 0===t.length&&t.push(new Dt),t}(l.patterns||[]),this.songOrder=l.songOrder||[0],this.waveforms=function(e){var t=Array.from({length:K},function(t,n){var r=e[n],o=new $t(r);return C(o.name)&&(o.name="WAVE ".concat(n)),o});if(0===e.length)for(var n=0;n<K;n++)for(var r=t[n],o=0;o<$;o++){var a=Math.floor((V-1)*(o<$/2?o/($/2):1-(o-$/2)/($/2)));r.amplitudes[o]=a}return t}(l.waveforms||[]),this.rowsPerPattern=j(null!==(t=l.rowsPerPattern)&&void 0!==t?t:T,1,T),this.tempo=j(null!==(n=l.tempo)&&void 0!==n?n:120,1,255),this.speed=j(null!==(r=l.speed)&&void 0!==r?r:6,1,31),this.name=null!==(o=l.name)&&void 0!==o?o:"New song",this.highlightRowCount=null!==(a=l.highlightRowCount)&&void 0!==a?a:4,this.patternEditStep=j(null!==(i=l.patternEditStep)&&void 0!==i?i:1,0,32)}return t=e,r=[{key:"fromData",value:function(t){return new e(t||{})}},{key:"fromJSON",value:function(t){try{var n=JSON.parse(t);return e.fromData(n)}catch(t){return console.error("Failed to parse song JSON",t),new e}}}],(n=[{key:"setTempo",value:function(e){this.tempo=j(e,1,255)}},{key:"setSpeed",value:function(e){this.speed=j(e,1,31)}},{key:"setHighlightRowCount",value:function(e){this.highlightRowCount=j(e,1,64)}},{key:"setPatternEditStep",value:function(e){this.patternEditStep=j(e,0,32)}},{key:"setRowsPerPattern",value:function(e){this.rowsPerPattern=j(e,1,T)}},{key:"toData",value:function(){return{instruments:this.instruments.map(function(e){return e.toData()}),patterns:this.patterns.map(function(e){return e.toData()}),waveforms:this.waveforms.map(function(e){return e.toData()}),songOrder:this.songOrder,tempo:this.tempo,speed:this.speed,rowsPerPattern:this.rowsPerPattern,name:this.name,highlightRowCount:this.highlightRowCount,patternEditStep:this.patternEditStep}}},{key:"toJSON",value:function(){return JSON.stringify(this.toData(),null,2)}},{key:"clone",value:function(){return e.fromData(this.toData())}}])&&Wt(t.prototype,n),r&&Wt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Qt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Yt=(0,r.createContext)(void 0),Xt=function(){var e=(0,r.useContext)(Yt);if(!e)throw new Error("useConfirmDialog must be used within a ConfirmDialogProvider");return e},Jt=function(e){var t=e.children,n=qt((0,r.useState)(!1),2),o=n[0],a=n[1],i=qt((0,r.useState)(null),2),l=i[0],u=i[1],c=(0,r.useRef)(null),s=(0,r.useCallback)(function(e){c.current&&(c.current(e),c.current=null),a(!1),u(null)},[]),f=(0,r.useCallback)(function(e){return new Promise(function(t){var n,r,o;c.current=t,u({content:e.content,defaultAction:null!==(n=e.defaultAction)&&void 0!==n?n:"yes",yesLabel:null!==(r=e.yesLabel)&&void 0!==r?r:"Yes",noLabel:null!==(o=e.noLabel)&&void 0!==o?o:"No"}),a(!0)})},[]);return(0,r.useEffect)(function(){if(o){var e=function(e){if("Enter"===e.key){var t;e.preventDefault();var n=null!==(t=null==l?void 0:l.defaultAction)&&void 0!==t?t:"yes";s("yes"===n)}else"Escape"===e.key&&(e.preventDefault(),s(!1))};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}},[o,l,s]),(0,Me.jsxs)(Yt.Provider,{value:{confirm:f},children:[t,o&&l&&(0,Me.jsx)("div",{className:"modal-backdrop",onClick:function(e){e.target===e.currentTarget&&s(!1)},children:(0,Me.jsxs)("div",{className:"modal-dialog",role:"dialog","aria-modal":"true",children:[(0,Me.jsx)("div",{className:"modal-dialog__body",children:l.content}),(0,Me.jsxs)("div",{className:"modal-dialog__footer",children:[(0,Me.jsx)("button",{type:"button",className:"modal-dialog__button modal-dialog__button--primary",onClick:function(){return s(!0)},autoFocus:"no"!==l.defaultAction,children:l.yesLabel}),(0,Me.jsx)("button",{type:"button",className:"modal-dialog__button",onClick:function(){return s(!1)},autoFocus:"no"===l.defaultAction,children:l.noLabel})]})]})})]})},Zt=n(961);function en(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var nn=function(e){var t=e.title,n=e.children,o=e.placement,a=void 0===o?"bottom":o,i=e.className,l=e.disabled,u=void 0!==l&&l,c=r.useRef(null),s=r.useRef(null),f=en(r.useState(!1),2),d=f[0],p=f[1],m=en(r.useState(null),2),h=m[0],v=m[1],y=r.useCallback(function(){var e=c.current,t=s.current;if(e){var n=e.getBoundingClientRect(),r=window.innerWidth,o=window.innerHeight,i=(null==t?void 0:t.offsetWidth)||320,l=(null==t?void 0:t.offsetHeight)||100,u=0,f=0;switch(a){case"top":u=n.top-6,f=n.left+n.width/2;break;case"bottom":u=n.bottom+6,f=n.left+n.width/2;break;case"left":u=n.top+n.height/2,f=n.left-6;break;case"right":u=n.top+n.height/2,f=n.right+6}if("bottom"===a||"top"===a){var d=i/2;f-d<8?f=d+8:f+d>r-8&&(f=r-d-8)}else"right"===a?f+i>r-8&&(f=r-i-8):"left"===a&&f-i<8&&(f=i+8);if("left"===a||"right"===a){var p=l/2;u-p<8?u=p+8:u+p>o-8&&(u=o-p-8)}else"bottom"===a?u+l>o-8&&(u=o-l-8):"top"===a&&u-l<8&&(u=8+l);v({top:u,left:f})}},[a]);r.useEffect(function(){if(d){y();var e=function(){return y()};return window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),function(){window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",e)}}},[d,y]),r.useEffect(function(){d&&s.current&&requestAnimationFrame(function(){y()})},[d,t,y]);var g=r.Children.only(n),b=r.cloneElement(g,{ref:function(e){c.current=e;var t=g.ref;"function"==typeof t?t(e):t&&(t.current=e)},onMouseEnter:function(e){var t,n;u||p(!0),null===(t=(n=g.props).onMouseEnter)||void 0===t||t.call(n,e)},onMouseLeave:function(e){var t,n;u||p(!1),null===(t=(n=g.props).onMouseLeave)||void 0===t||t.call(n,e)},onFocus:function(e){var t,n;u||p(!0),null===(t=(n=g.props).onFocus)||void 0===t||t.call(n,e)},onBlur:function(e){var t,n;u||p(!1),null===(t=(n=g.props).onBlur)||void 0===t||t.call(n,e)}}),w=d&&!u&&t;return(0,Me.jsxs)(Me.Fragment,{children:[b,w&&h&&(0,Zt.createPortal)((0,Me.jsx)("span",{ref:s,className:"generic-tooltip generic-tooltip--".concat(a," ").concat(i||""),style:{top:h.top,left:h.left},children:t}),document.body)]})};function rn(e){return function(e){if(Array.isArray(e))return fn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||sn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function on(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return an(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(an(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,an(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,an(f,"constructor",c),an(c,"constructor",u),u.displayName="GeneratorFunction",an(c,o,"GeneratorFunction"),an(f),an(f,o,"Generator"),an(f,r,function(){return this}),an(f,"toString",function(){return"[object Generator]"}),(on=function(){return{w:a,m:d}})()}function an(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}an=function(e,t,n,r){function a(t,n){an(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},an(e,t,n,r)}function ln(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function un(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ln(a,r,o,i,l,"next",e)}function l(e){ln(a,r,o,i,l,"throw",e)}i(void 0)})}}function cn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||sn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sn(e,t){if(e){if("string"==typeof e)return fn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fn(e,t):void 0}}function fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var dn=function(e){var t,n=e.song,o=e.editorState,a=e.musicState,i=e.onEditorStateChange,l=e.onSongChange,u=Xt().confirm,c=256,s=256,f=cn((0,r.useState)(null),2),d=f[0],p=f[1],m=cn((0,r.useState)(""),2),h=m[0],v=m[1],y=(0,r.useMemo)(function(){return Array(s).fill(null)},[s]),g=function(e){return e.toString().padStart(2,"0")},b=function(e,t){for(var n=j(t,0,255);e.patterns.length<=n&&e.patterns.length<c;)e.patterns.push(new Dt);return n},w=function(e,t){l(function(n){var r;if(!(e<0||e>=n.songOrder.length)){var o=(null!==(r=n.songOrder[e])&&void 0!==r?r:0)+t;o=j(o,0,255),o=b(n,o),n.songOrder[e]=o}}),i(function(t){t.setActiveSongPosition(e)})},x=function(e){l(function(t){t.songOrder.length<=1||e<0||e>=t.songOrder.length||t.songOrder.splice(e,1)}),i(function(t){t.activeSongPosition>=e&&t.activeSongPosition>0&&t.setActiveSongPosition(t.activeSongPosition-1)})},S=function(){var e=un(on().m(function e(t){return on().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({content:(0,Me.jsx)("div",{children:(0,Me.jsxs)("p",{children:["Are you sure you want to delete position ",g(t)," from the arrangement?"]})}),defaultAction:"no",yesLabel:"Delete",noLabel:"Cancel"});case 1:if(e.v){e.n=2;break}return e.a(2);case 2:x(t);case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(e,t){for(var n=new Set(e.songOrder),r=[],o=0;o<c&&r.length<t;o++)n.has(o)||(b(e,o),r.push(o));return r},C=function(){return o.selectedArrangementPositions.length>0?rn(o.selectedArrangementPositions).sort(function(e,t){return e-t}):[o.activeSongPosition]},E=function(){var e=un(on().m(function e(){var t;return on().w(function(e){for(;;)switch(e.n){case 0:if(!((t=C()).length>=n.songOrder.length)){e.n=1;break}return e.a(2);case 1:return e.n=2,u({content:(0,Me.jsx)("div",{children:(0,Me.jsxs)("p",{children:["Are you sure you want to delete ",t.length," position",t.length>1?"s":""," from the arrangement?"]})}),defaultAction:"yes",yesLabel:"Delete",noLabel:"Cancel"});case 2:if(e.v){e.n=3;break}return e.a(2);case 3:l(function(e){for(var n=t.length-1;n>=0;n--)e.songOrder.splice(t[n],1)}),i(function(e){var r=Math.min(t[0],n.songOrder.length-t.length-1);e.setActiveSongPosition(Math.max(0,r)),e.setArrangementSelection([])});case 4:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),O=function(e){return n.patterns[e].name},_=function(){if(null!==d){var e=d,t=h.trim();l(function(n){var r=n.patterns[e];r&&(r.name=t)}),p(null)}},P=function(e,t){i(function(n){if(t&&n.activeSongPosition!==e){for(var r=Math.min(n.activeSongPosition,e),o=Math.max(n.activeSongPosition,e),a=[],i=r;i<=o;i++)a.push(i);n.setArrangementSelection(a)}else n.setActiveSongPosition(e),n.setArrangementSelection([])}),function(e){var t=y[e];t&&t.focus()}(e)},N=null!==(t=a.somaticSongPosition)&&void 0!==t?t:-1;return(0,Me.jsxs)("div",{className:"arrangement-editor",children:[(0,Me.jsx)("div",{className:"arrangement-editor__header"}),(0,Me.jsx)("div",{className:"arrangement-editor__content",children:n.songOrder.map(function(e,t){var r=j(null!=e?e:0,0,255),a=o.activeSongPosition===t,i=o.selectedArrangementPositions.includes(t),l=N===t,u=n.songOrder.length>1,c=rn(o.selectedArrangementPositions).sort(function(e,t){return e-t}),s=["arrangement-editor__row",a&&"arrangement-editor__row--selected",i&&"arrangement-editor__row--in-selection",c.length>0&&t===c[0]&&"arrangement-editor__row--selection-first",c.length>0&&t===c[c.length-1]&&"arrangement-editor__row--selection-last",l&&"arrangement-editor__row--playing"].filter(Boolean).join(" ");return(0,Me.jsxs)("div",{ref:function(e){return y[t]=e},className:s,children:[(0,Me.jsxs)("div",{className:"arrangement-editor__controls",tabIndex:0,onClick:function(e){return P(t,e.shiftKey)},onKeyDown:function(e){return function(e,t){switch(e.key){case"ArrowUp":e.preventDefault(),t>0&&P(t-1,e.shiftKey);break;case"ArrowDown":e.preventDefault(),t<n.songOrder.length-1&&P(t+1,e.shiftKey);break;case"Delete":case"Backspace":e.preventDefault(),e.shiftKey||e.ctrlKey?E():S(t);break;case"Enter":case" ":e.preventDefault(),P(t,e.shiftKey)}}(e,t)},children:[(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__delete",onClick:function(e){e.stopPropagation(),S(t)},disabled:!u,"aria-label":"Delete position",children:""}),(0,Me.jsxs)("span",{className:"arrangement-editor__position-id",children:[(0,Me.jsx)("span",{style:{visibility:a?"visible":"hidden"},children:""}),g(t)]}),(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__pattern",onClick:function(e){e.stopPropagation(),P(t,e.shiftKey)},children:g(r)}),(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__step",onClick:function(e){e.stopPropagation(),w(t,-1)},disabled:r<=0,"aria-label":"Previous pattern",children:"<"}),(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__step",onClick:function(e){e.stopPropagation(),w(t,1)},disabled:r>=255,"aria-label":"Next pattern",children:">"})]}),(0,Me.jsx)("div",{className:"arrangement-editor__pattern-name-container",onClick:function(e){return e.stopPropagation()},children:d===r?(0,Me.jsx)("input",{type:"text",className:"arrangement-editor__pattern-name-input",value:h,autoFocus:!0,onChange:function(e){return v(e.target.value)},onBlur:_,onKeyDown:function(e){"Enter"===e.key?(e.preventDefault(),_()):"Escape"===e.key&&(e.preventDefault(),p(null))}}):(0,Me.jsx)("span",{className:"arrangement-editor__pattern-name",title:O(r),onDoubleClick:function(){return function(e){p(e),v(O(e))}(r)},children:O(r)})})]},t)})}),(0,Me.jsxs)("div",{className:"arrangement-editor__footer",children:[(0,Me.jsxs)("div",{className:"arrangement-editor__footer-row",children:[(0,Me.jsx)(nn,{title:"Insert new pattern above selection",children:(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__command",onClick:function(){l(function(e){if(!(e.songOrder.length>=s)){var t=C()[0],n=k(e,1);n.length>0&&e.songOrder.splice(t,0,n[0])}}),i(function(e){e.setArrangementSelection([])})},disabled:n.songOrder.length>=s,"aria-label":"Insert above",children:"+"})}),(0,Me.jsx)(nn,{title:"Insert new pattern below selection",children:(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__command",onClick:function(){l(function(e){if(!(e.songOrder.length>=s)){var t=C(),n=t[t.length-1]+1,r=k(e,1);r.length>0&&e.songOrder.splice(n,0,r[0])}}),i(function(e){e.setArrangementSelection([])})},disabled:n.songOrder.length>=s,"aria-label":"Insert below",children:"+"})}),(0,Me.jsx)(nn,{title:"Repeat selection (reuse same patterns)",children:(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__command",onClick:function(){l(function(e){var t;if(!(e.songOrder.length>=s)){var n=C(),r=n.map(function(t){return e.songOrder[t]}),o=n[n.length-1]+1;e.songOrder.length+r.length>s||(t=e.songOrder).splice.apply(t,[o,0].concat(rn(r)))}}),i(function(e){e.setArrangementSelection([])})},disabled:n.songOrder.length>=s,"aria-label":"Repeat selection",children:""})}),(0,Me.jsx)(nn,{title:"Duplicate selection (copy patterns)",children:(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__command",onClick:function(){l(function(e){var t;if(!(e.songOrder.length>=s)){var n=C(),r=n.map(function(t){return e.songOrder[t]});if(!(e.songOrder.length+r.length>s)){var o=k(e,r.length);if(!(o.length<r.length)){var a=r.map(function(t,n){var r=o[n],a=e.patterns[t];return e.patterns[r]=a.clone(),r}),i=n[n.length-1]+1;(t=e.songOrder).splice.apply(t,[i,0].concat(rn(a)))}}}}),i(function(e){e.setArrangementSelection([])})},disabled:n.songOrder.length>=s,"aria-label":"Duplicate selection",children:""})})]}),(0,Me.jsxs)("div",{className:"arrangement-editor__footer-row",children:[(0,Me.jsx)(nn,{title:"Delete selected positions",children:(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__command",onClick:E,disabled:C().length>=n.songOrder.length,"aria-label":"Delete selected",children:""})}),(0,Me.jsx)(nn,{title:"Move selection up",children:(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__command",onClick:function(){var e=C();0!==e[0]&&(l(function(t){var n,r=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=sn(e))){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==t.return||t.return()}finally{if(i)throw o}}}}(e);try{for(r.s();!(n=r.n()).done;){var o=n.value,a=t.songOrder[o];t.songOrder[o]=t.songOrder[o-1],t.songOrder[o-1]=a}}catch(e){r.e(e)}finally{r.f()}}),i(function(e){e.setActiveSongPosition(e.activeSongPosition-1),e.selectedArrangementPositions.length>0&&e.setArrangementSelection(e.selectedArrangementPositions.map(function(e){return e-1}))}))},disabled:0===C()[0],"aria-label":"Move up",children:""})}),(0,Me.jsx)(nn,{title:"Move selection down",children:(0,Me.jsx)("button",{type:"button",className:"arrangement-editor__command",onClick:function(){var e=C();e[e.length-1]>=n.songOrder.length-1||(l(function(t){for(var n=e.length-1;n>=0;n--){var r=e[n],o=t.songOrder[r];t.songOrder[r]=t.songOrder[r+1],t.songOrder[r+1]=o}}),i(function(e){e.setActiveSongPosition(e.activeSongPosition+1),e.selectedArrangementPositions.length>0&&e.setArrangementSelection(e.selectedArrangementPositions.map(function(e){return e+1}))}))},disabled:C()[C().length-1]>=n.songOrder.length-1,"aria-label":"Move down",children:""})})]})]})]})},pn=[{key:"Escape",action:"Toggle edit mode and panic (stop all sound)."},{key:"[ / ]",action:"Octave down / up."},{key:"Shift+[ / Shift+]",action:"Current instrument down / up."},{key:"Ctrl/Cmd+Z",action:"Undo last edit (song + cursor)."},{key:"Ctrl/Cmd+Shift+Z or Ctrl/Cmd+Y",action:"Redo the last undone edit."},{key:"Alt+0",action:"Play song from the beginning / Stop."},{key:"Alt+8",action:"Play from the current pattern."},{key:"Alt+9",action:"Play from the current song position & row."},{key:"Alt+1",action:"Focus the pattern grid."},{key:"Alt+2",action:"Toggle waveform editor panel."},{key:"Alt+3",action:"Toggle instrument panel."},{key:"Alt+4",action:"Toggle TIC-80 bridge panel."},{key:"Arrow keys",action:"Move between cells."},{key:"Ctrl+Arrow Left/Right",action:"Jump to previous/next channel (same column)."},{key:"Ctrl+Arrow Up/Down",action:"Jump 4 rows up/down (wrap song order)."},{key:"Page Up / Page Down",action:"Jump by the highlight block size."},{key:"Home / End",action:"Jump to first/last row (same column)."},{key:"Ctrl+Home / Ctrl+End",action:"Jump to top-left / bottom-right of the pattern."},{key:"Enter",action:"Preview the current row."},{key:"Computer keyboard (- Z S X ...)",action:"Enter notes using the QWERTY piano layout."},{key:"0-9, A-F",action:"Enter instrument hex values or effect parameters."},{key:"M, C, J, S, P, V, D",action:"Enter effect commands."},{key:"Shift+Backspace (note column)",action:"Insert a note cut (^^^)."},{key:"0 (note column)",action:"Clear the note."},{key:"Backspace",action:"Clear the focused field (note/inst/cmd/param)."},{key:"Delete",action:"Clear the entire cell (all columns)."},{key:"Mouse drag",action:"Select multiple cells."},{key:"Ctrl/Cmd+C or Ctrl+Insert",action:"Copy selection to clipboard."},{key:"Ctrl/Cmd+V or Shift+Insert",action:"Paste selection."},{key:"Ctrl/Cmd+X or Shift+Delete",action:"Cut selection."}],mn=function(e){var t=e.onClose;return(0,Me.jsxs)("div",{className:"help-panel",role:"dialog","aria-label":"Keyboard shortcuts",children:[(0,Me.jsx)("h2",{children:"Keyboard shortcuts"}),(0,Me.jsxs)("table",{children:[(0,Me.jsx)("thead",{children:(0,Me.jsxs)("tr",{children:[(0,Me.jsx)("th",{children:"Action"}),(0,Me.jsx)("th",{children:"Key"})]})}),(0,Me.jsx)("tbody",{children:pn.map(function(e){return(0,Me.jsxs)("tr",{children:[(0,Me.jsx)("td",{className:"shortcut-key",children:e.key}),(0,Me.jsx)("td",{children:e.action})]},e.key)})})]}),(0,Me.jsx)("div",{className:"help-panel__actions",children:(0,Me.jsx)("button",{onClick:t,children:"Close"})})]})};function hn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return vn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var yn=function(e){var t=e.values,n=e.maxValue,o=e.scale,a=e.classNamePrefix,i=void 0===a?"waveform-editor":a,l=e.onChange,u=e.supportsLoop,c=void 0!==u&&u,s=e.loopStart,f=void 0===s?0:s,d=e.loopLength,p=void 0===d?0:d,m=e.onHoverChange,h=t.length,v=n+1,y=hn((0,r.useState)(!1),2),g=y[0],b=y[1],w=hn((0,r.useState)(null),2),x=w[0],S=w[1],k=hn((0,r.useState)(null),2),C=k[0],E=k[1],O=(0,r.useRef)(null),_=(0,r.useRef)(null),P=(0,r.useRef)(null),N=(0,r.useRef)(null),I=(0,r.useRef)(null),A=(0,r.useRef)(null),T=(0,r.useRef)(t.map(function(e){return Number.isFinite(e)?e:0})),M="number"==typeof o||null==o?null!=o?o:16:o.x,L="number"==typeof o||null==o?null!=o?o:16:o.y;if(0===h||v<=0)return(0,Me.jsx)("div",{className:i,children:(0,Me.jsx)("p",{children:"No waveform data."})});var D=function(e){return j(e,0,n)};(0,r.useEffect)(function(){g||(T.current=t.map(function(e){return D(e)}))},[t,n,g]);var R=function(e,t){var n,r=null!==(n=_.current)&&void 0!==n?n:O.current;if(!r)return null;var o=r.getBoundingClientRect();if(o.width<=0||o.height<=0)return null;var a=e-o.left,i=t-o.top;a<0&&(a=0),a>o.width&&(a=o.width),i<0&&(i=0),i>o.height&&(i=o.height);var l=Math.floor(a/o.width*h);l<0&&(l=0),l>=h&&(l=h-1);var u=o.height-i,c=o.height/v,s=Math.floor(u/c);return{index:l,value:s=D(s)}},F=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=R(e,t);if(r){var o=r.index,a=r.value;S(o),E(a);var i=T.current.slice(),u=i.length,c=function(e,t){e<0||e>=u||(i[e]=D(t))};if(n&&null!=I.current&&null!=A.current){var s=I.current,f=o,d=A.current,p=a;if(s===f)c(f,p);else for(var m=f-s,h=m>0?1:-1,v=s;v!==f+h;v+=h){var y=(v-s)/m;c(v,Math.round(d+y*(p-d)))}}else{var g=P.current,b=N.current,w=o,x=a;if(null!=g&&null!=b&&g!==w)for(var k=w>g?1:-1,j=w-g,C=g+k;C!==w;C+=k){var O=(C-g)/j;c(C,Math.round(b+O*(x-b)))}c(w,x),P.current=w,N.current=x}T.current=i,l(i)}};(0,r.useEffect)(function(){if(g){var e=function(e){var n=R(e.clientX,e.clientY);n?(S(n.index),E(n.value),null==m||m({index:n.index,value:n.value,actualValue:t[n.index]}),F(e.clientX,e.clientY,e.shiftKey)):(S(null),E(null),null==m||m(null))},n=function(){b(!1),P.current=null,N.current=null,I.current=null,A.current=null,S(null),E(null),null==m||m(null)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",n),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)}}},[g]);for(var z=h*M,U=v*L,B=[],K=0;K<=v;K+=1){var $=K*U/v;B.push((0,Me.jsx)("line",{x1:0,x2:z,y1:$,y2:$,className:"".concat(i,"__grid-line")},"h-".concat(K)))}for(var V=0;V<=h;V+=1){var W=V*z/h;B.push((0,Me.jsx)("line",{x1:W,x2:W,y1:0,y2:U,className:"".concat(i,"__grid-line")},"v-".concat(V)))}var G=[];if(c&&p>0){var H=j(f,0,h-1),q=j(f+p,0,h),Q=H*z/h,Y=q*z/h;G.push((0,Me.jsx)("line",{x1:Q,x2:Q,y1:0,y2:U,className:"".concat(i,"__loop-line ").concat(i,"__loop-line--start")},"loop-start")),G.push((0,Me.jsx)("line",{x1:Y,x2:Y,y1:0,y2:U,className:"".concat(i,"__loop-line ").concat(i,"__loop-line--end")},"loop-end"))}for(var X=[],J=0;J<h;J+=1){var Z,ee=D(null!==(Z=t[J])&&void 0!==Z?Z:0),te=(J+.5)*(z/h),ne=U-(ee+.5)*U/v,re=x===J;X.push((0,Me.jsx)("rect",{x:te-.4*M,y:ne-.4*L,width:.8*M,height:.8*L,className:re?"".concat(i,"__point ").concat(i,"__point--hovered"):"".concat(i,"__point")},J))}var oe=null;if(null!=x&&null!=C){var ae=(x+.5)*(z/h),ie=U-(C+.5)*U/v;oe=(0,Me.jsx)("rect",{x:ae-.4*M,y:ie-.4*L,width:.8*M,height:.8*L,className:"".concat(i,"__point-preview")})}var le=null;return null!=x&&null!=C&&(le=(0,Me.jsxs)("text",{x:8,y:16,className:"".concat(i,"__coordinates"),children:["[",x,", ",C,"]"]})),(0,Me.jsx)("div",{className:i,children:(0,Me.jsx)("div",{className:"".concat(i,"__canvas"),style:{width:z,height:U},ref:O,onMouseDown:function(e){if(0===e.button){P.current=null,N.current=null;var t=R(e.clientX,e.clientY);t&&(I.current=t.index,A.current=t.value),b(!0),F(e.clientX,e.clientY,e.shiftKey)}},onMouseMove:function(e){var n=R(e.clientX,e.clientY);n?(S(n.index),E(n.value),null==m||m({index:n.index,value:n.value,actualValue:t[n.index]})):(S(null),E(null),null==m||m(null)),g&&F(e.clientX,e.clientY,e.shiftKey)},onMouseUp:function(){b(!1),P.current=null,N.current=null,S(null),E(null),null==m||m(null)},onMouseLeave:function(){S(null),E(null),null==m||m(null)},children:(0,Me.jsxs)("svg",{className:"".concat(i,"__svg"),ref:_,viewBox:"0 0 ".concat(z," ").concat(U),width:z,height:U,"aria-label":"Waveform editor",children:[(0,Me.jsx)("rect",{x:0,y:0,width:z,height:U,className:"".concat(i,"__background")}),B,G,X,oe,le]})})})};function gn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return bn(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(bn(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,bn(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,bn(f,"constructor",c),bn(c,"constructor",u),u.displayName="GeneratorFunction",bn(c,o,"GeneratorFunction"),bn(f),bn(f,o,"Generator"),bn(f,r,function(){return this}),bn(f,"toString",function(){return"[object Generator]"}),(gn=function(){return{w:a,m:d}})()}function bn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}bn=function(e,t,n,r){function a(t,n){bn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},bn(e,t,n,r)}function wn(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function xn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){wn(a,r,o,i,l,"next",e)}function l(e){wn(a,r,o,i,l,"throw",e)}i(void 0)})}}function Sn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return kn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var jn=function(e){for(var t=e.value,n=e.scale,r=e.isSelected,o=e.onClick,a=$,i=V,l=n*a,u=n*i,c=i-1,s=[],f=0;f<a;f+=1){var d,p=f*(l/a),m=u-(j(null!==(d=t.amplitudes[f])&&void 0!==d?d:0,0,c)+1)*u/i;s.push((0,Me.jsx)("rect",{className:"waveform-swatch__point",x:p,y:m,width:n,height:n},f))}var h="waveform-swatch".concat(r?" waveform-swatch--selected":"");return(0,Me.jsx)("button",{type:"button",className:h,onClick:o,style:{width:l,height:u},children:(0,Me.jsx)("svg",{className:"waveform-swatch__svg",viewBox:"0 0 ".concat(l," ").concat(u),width:l,height:u,"aria-hidden":"true",children:s})})},Cn=function(e){var t=e.selectedWaveformId,n=e.song,r=e.onClickWaveform,o=Math.min(n.waveforms.length,K);return(0,Me.jsx)("div",{className:"waveform-select",children:Array.from({length:o},function(e,o){var a=n.waveforms[o];return(0,Me.jsx)(jn,{value:a,scale:3,isSelected:o===t,onClick:function(){return r(o)}},o)})})},En=function(e){var t=e.song,n=e.editingWaveformId,r=(e.editorState,e.onSongChange),o=t.waveforms[n];if(!o)return(0,Me.jsx)("div",{className:"waveform-editor",children:(0,Me.jsx)("p",{children:"No waveform selected."})});var a=V-1;return(0,Me.jsx)(yn,{values:Array.from(o.amplitudes),maxValue:a,scale:16,classNamePrefix:"waveform-editor",onChange:function(e){r(function(t){var r=t.waveforms[n];if(r)for(var o=Math.min(r.amplitudes.length,e.length),i=0;i<o;i+=1){var l,u=Math.max(0,Math.min(a,null!==(l=e[i])&&void 0!==l?l:0));r.amplitudes[i]=u}})}})},On=function(e){var t=e.song,n=e.editorState,o=e.onSongChange,a=Sn((0,r.useState)(0),2),i=a[0],l=a[1],u=Sn((0,r.useState)(100),2),c=u[0],s=u[1],f=Sn((0,r.useState)(1),2),d=f[0],p=f[1],m=Ge(),h=function(e){if(t.waveforms[i]){var n=$,r=V-1,a=Math.max(0,Math.min(100,c))/100;o(function(t){var o=t.waveforms[i];if(o)for(var l=Math.min(o.amplitudes.length,n),u=0;u<l;u+=1){var c,s=Math.max(0,Math.min(r,null!==(c=o.amplitudes[u])&&void 0!==c?c:0)),f=Math.max(0,Math.min(r,e(u,n,r))),d=Math.round(s*(1-a)+f*a);o.amplitudes[u]=d}})}},v=function(e,t){return d*e/t},y=function(e){var t=V-1;o(function(n){var r=n.waveforms[i];if(r)for(var o=0;o<r.amplitudes.length;o+=1){var a,l=Math.max(0,Math.min(t,null!==(a=r.amplitudes[o])&&void 0!==a?a:0))+e;l<0&&(l=t),l>t&&(l=0),r.amplitudes[o]=l}})},g=function(){var e=xn(gn().m(function e(){var n;return gn().w(function(e){for(;;)switch(e.n){case 0:return n=t.waveforms[i],e.n=1,m.copyObjectToClipboard(n.toData());case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=xn(gn().m(function e(){var t;return gn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m.readObjectFromClipboard();case 1:if(t=e.v){e.n=2;break}return e.a(2);case 2:o(function(e){e.waveforms[i]=$t.fromData(t)});case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();return(0,Me.jsxs)("div",{className:"waveform-editor-panel",children:[(0,Me.jsx)("h3",{children:"Waveform Editor"}),(0,Me.jsx)(Cn,{onClickWaveform:l,selectedWaveformId:i,song:t}),(0,Me.jsx)(En,{song:t,editorState:n,onSongChange:o,editingWaveformId:i}),(0,Me.jsxs)("div",{className:"waveform-editor-controls",children:[(0,Me.jsxs)("div",{className:"waveform-editor-controls__row",children:[(0,Me.jsx)("button",{type:"button",onClick:g,children:"Copy"}),(0,Me.jsx)("button",{type:"button",onClick:b,children:"Paste"})]}),(0,Me.jsxs)("div",{className:"waveform-editor-controls__row",children:[(0,Me.jsx)("span",{className:"waveform-editor-controls__label",children:"Mix"}),(0,Me.jsx)("input",{type:"range",min:0,max:100,step:1,value:c,onChange:function(e){return s(Number(e.target.value))}}),(0,Me.jsxs)("span",{className:"waveform-editor-controls__value",children:[c,"%"]})]}),(0,Me.jsxs)("div",{className:"waveform-editor-controls__row",children:[(0,Me.jsx)("span",{className:"waveform-editor-controls__label",children:"Harmonic"}),[1,2,3,4,5].map(function(e){return(0,Me.jsx)("button",{type:"button",className:e===d?"waveform-editor-controls__button waveform-editor-controls__button--active":"waveform-editor-controls__button",onClick:function(){return p(e)},children:e},e)})]}),(0,Me.jsxs)("div",{className:"waveform-editor-controls__row",children:[(0,Me.jsx)("button",{type:"button",onClick:function(){h(function(e,t,n){var r=v(e,t);return r-Math.floor(r)<.5?n:0})},children:"Pulse"}),(0,Me.jsx)("button",{type:"button",onClick:function(){h(function(e,t,n){var r=v(e,t),o=r-Math.floor(r);return Math.round(o*n)})},children:"Saw"}),(0,Me.jsx)("button",{type:"button",onClick:function(){h(function(e,t,n){var r=v(e,t),o=r-Math.floor(r),a=o<.5?2*o:2*(1-o);return Math.round(a*n)})},children:"Tri"}),(0,Me.jsx)("button",{type:"button",onClick:function(){h(function(e,t,n){var r=v(e,t),o=2*Math.PI*r,a=(Math.sin(o)+1)/2;return Math.round(a*n)})},children:"Sine"}),(0,Me.jsx)("button",{type:"button",onClick:function(){h(function(e,t,n){return Math.floor(Math.random()*(n+1))})},children:"Noise"})]}),(0,Me.jsxs)("div",{className:"waveform-editor-controls__row",children:[(0,Me.jsx)("span",{className:"waveform-editor-controls__label",children:"Shift"}),(0,Me.jsx)("button",{type:"button",onClick:function(){return y(1)},children:"Up"}),(0,Me.jsx)("button",{type:"button",onClick:function(){return y(-1)},children:"Down"}),(0,Me.jsx)("button",{type:"button",onClick:function(){var e=V-1;o(function(t){var n=t.waveforms[i];if(n){for(var r=e,o=0,a=0;a<n.amplitudes.length;a+=1){var l=n.amplitudes[a];l<r&&(r=l),l>o&&(o=l)}if(r!==o)for(var u=o-r,c=0;c<n.amplitudes.length;c+=1){var s=n.amplitudes[c];n.amplitudes[c]=Math.round((s-r)/u*e)}}})},children:"Normalize"}),(0,Me.jsx)("button",{type:"button",onClick:function(){var e=V-1;o(function(t){var n=t.waveforms[i];if(n)for(var r=new Uint8Array(n.amplitudes),o=r.length,a=0;a<o;a+=1){var l=.25*r[(a-1+o)%o]+.5*r[a]+.25*r[(a+1)%o];n.amplitudes[a]=Math.round(Math.max(0,Math.min(e,l)))}})},children:"Lowpass"}),(0,Me.jsx)("button",{type:"button",onClick:function(){var e=V-1;o(function(t){var n=t.waveforms[i];if(n)for(var r=new Uint8Array(n.amplitudes),o=r.length,a=r[0],l=0;l<o;l+=1)a+=.5*(r[l]-a),n.amplitudes[l]=Math.round(Math.max(0,Math.min(e,a)))})},children:"LP 1-pole"})]})]})]})};function _n(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return Pn(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(Pn(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Pn(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Pn(f,"constructor",c),Pn(c,"constructor",u),u.displayName="GeneratorFunction",Pn(c,o,"GeneratorFunction"),Pn(f),Pn(f,o,"Generator"),Pn(f,r,function(){return this}),Pn(f,"toString",function(){return"[object Generator]"}),(_n=function(){return{w:a,m:d}})()}function Pn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Pn=function(e,t,n,r){function a(t,n){Pn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Pn(e,t,n,r)}function Nn(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function In(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Nn(a,r,o,i,l,"next",e)}function l(e){Nn(a,r,o,i,l,"throw",e)}i(void 0)})}}function An(e,t){if(e){if("string"==typeof e)return Tn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tn(e,t):void 0}}function Tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Mn=function(e){var t=e.title,n=e.className,o=e.frames,a=e.loopStart,i=e.loopLength,l=e.minValue,u=e.maxValue,c=e.onChange,s=e.onHoverChange,f=o.length,d=u-l,p=d<=0?0:d,m=Ge(),h=(0,r.useMemo)(function(){return function(e){if(Array.isArray(e))return Tn(e)}(e=o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||An(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var e},[o]),v=function(){var e=In(_n().m(function e(){return _n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m.copyObjectToClipboard({frames:Array.from(o),loopStart:a,loopLength:i});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),y=function(){var e=In(_n().m(function e(){var t,n,r,o,s,d,p;return _n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m.readObjectFromClipboard();case 1:if((t=e.v)&&Array.isArray(t.frames)){e.n=2;break}return e.a(2);case 2:(n=new Int8Array(t.frames.slice(0,f).map(function(e){return j(e,l,u)}))).length<f?((s=new Int8Array(f)).set(n),c(s,null!==(r=t.loopStart)&&void 0!==r?r:a,null!==(o=t.loopLength)&&void 0!==o?o:i)):c(n,null!==(d=t.loopStart)&&void 0!==d?d:a,null!==(p=t.loopLength)&&void 0!==p?p:i);case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();return(0,Me.jsxs)("div",{className:"instrument-envelope-editor ".concat(n||""),children:[(0,Me.jsxs)("div",{className:"instrument-envelope-editor__header",children:[(0,Me.jsx)("h4",{children:t}),(0,Me.jsxs)("div",{className:"instrument-envelope-editor__loop-controls",children:[(0,Me.jsxs)("label",{children:["Loop start",(0,Me.jsx)("input",{type:"number",min:0,max:Math.max(0,f-1),value:a,onChange:function(e){var t=E(e.target.value);if(null!==t){var n=j(t,0,Math.max(0,f-1)),r=j(i,0,Math.max(0,f-1));c(o,n,r)}}})]}),(0,Me.jsxs)("label",{children:["Loop len",(0,Me.jsx)("input",{type:"number",min:0,max:Math.max(0,f-1),value:i,onChange:function(e){var t=E(e.target.value);if(null!==t){var n=Math.max(0,f-1),r=j(t,0,n),i=j(a,0,n);c(o,i,r)}}})]})]})]}),(0,Me.jsxs)("div",{className:"instrument-envelope-editor__content",children:[(0,Me.jsx)(yn,{values:h,maxValue:p,scale:{x:16,y:12},classNamePrefix:"instrument-envelope",onChange:function(e){k(e.length===f,"Unexpected frame count in canvas change");var t=new Int8Array(e);c(t,a,i)},supportsLoop:!0,loopStart:a,loopLength:i,onHoverChange:s}),(0,Me.jsxs)("div",{className:"instrument-envelope-editor__controls",children:[(0,Me.jsx)("button",{onClick:function(){var e=new Int8Array(o.map(function(e){return j(e+1,l,u)}));c(e,a,i)},title:"Rotate up",children:""}),(0,Me.jsx)("button",{onClick:function(){var e=new Int8Array(o.map(function(e){return j(e-1,l,u)}));c(e,a,i)},title:"Rotate down",children:""}),(0,Me.jsx)("button",{onClick:function(){if(0!==f){for(var e=new Int8Array(f),t=0;t<f;t++)e[t]=o[(t+1)%f];c(e,a,i)}},title:"Rotate left",children:""}),(0,Me.jsx)("button",{onClick:function(){if(0!==f){for(var e=new Int8Array(f),t=0;t<f;t++)e[t]=o[(t-1+f)%f];c(e,a,i)}},title:"Rotate right",children:""}),(0,Me.jsx)("button",{onClick:v,title:"Copy",children:"Copy"}),(0,Me.jsx)("button",{onClick:y,title:"Paste",children:"Paste"})]})]})]})},Ln=function(e){var t,n,o=e.song,a=e.currentInstrument,i=e.onSongChange,l=e.onClose,u=a,c=o.instruments[u],s=Ge(),f=(t=(0,r.useState)(null),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(t,n)||An(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=f[0],p=f[1];if(!c)return(0,Me.jsxs)("div",{className:"instrument-panel",children:[(0,Me.jsxs)("div",{className:"toolbar",children:[(0,Me.jsx)("label",{htmlFor:"instrument",children:"Instrument Editor"}),(0,Me.jsx)("button",{onClick:l,children:"Close"})]}),(0,Me.jsx)("div",{className:"section",children:(0,Me.jsx)("p",{children:"No instrument selected."})})]});var m=function(){var e=In(_n().m(function e(){return _n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,s.copyObjectToClipboard(c.toData());case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),h=function(){var e=In(_n().m(function e(){var t;return _n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,s.readObjectFromClipboard();case 1:t=e.v,i(function(e){e.instruments[u]=jt.fromData(t)});case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();return(0,Me.jsxs)("div",{className:"instrument-panel",children:[(0,Me.jsxs)("div",{className:"toolbar",children:[(0,Me.jsx)("label",{htmlFor:"instrument",children:"Instrument Editor"}),0===u&&(0,Me.jsx)("div",{className:"alertPanel",children:"!! instrument 0 is weird and should not be used."}),1===u&&(0,Me.jsx)("div",{className:"alertPanel",children:"!! This is the note-off sfx and should not be edited."}),(0,Me.jsx)("button",{onClick:m,children:"Copy"}),(0,Me.jsx)("button",{onClick:h,children:"Paste"}),(0,Me.jsx)("button",{onClick:l,children:"Close"})]}),(0,Me.jsxs)("div",{className:"",children:[(0,Me.jsxs)("div",{className:"field-row",children:[(0,Me.jsx)("label",{htmlFor:"instrument-name",children:"Name"}),(0,Me.jsx)("input",{id:"instrument-name",type:"text",value:c.name,onChange:function(e){var t=e.target.value;i(function(e){e.instruments[u].name=t})}})]}),(0,Me.jsxs)("div",{className:"field-row",children:[(0,Me.jsx)("label",{htmlFor:"instrument-speed",children:"Speed"}),(0,Me.jsx)("input",{id:"instrument-speed",type:"number",min:0,max:R,value:c.speed,onChange:function(e){var t=E(e.target.value);null!==t&&i(function(e){e.instruments[u].speed=j(t,0,R)})}})]}),(0,Me.jsxs)("div",{className:"field-row",children:[(0,Me.jsx)("label",{children:"Stereo"}),(0,Me.jsxs)("label",{children:[(0,Me.jsx)("input",{type:"checkbox",checked:c.stereoLeft,onChange:function(e){var t=e.target.checked;i(function(e){e.instruments[u].stereoLeft=t})}}),"L"]}),(0,Me.jsxs)("label",{children:[(0,Me.jsx)("input",{type:"checkbox",checked:c.stereoRight,onChange:function(e){var t=e.target.checked;i(function(e){e.instruments[u].stereoRight=t})}}),"R"]})]}),(0,Me.jsx)(Mn,{title:"Volume",frames:c.volumeFrames,loopStart:c.volumeLoopStart,loopLength:c.volumeLoopLength,minValue:0,maxValue:F,onChange:function(e,t,n){i(function(r){var o=r.instruments[u];o.volumeFrames=new Int8Array(e),o.volumeLoopStart=t,o.volumeLoopLength=n})}}),(0,Me.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,Me.jsx)(Mn,{title:"Waveforms",frames:c.waveFrames,loopStart:c.waveLoopStart,loopLength:c.waveLoopLength,minValue:0,maxValue:K-1,onChange:function(e,t,n){i(function(r){var o=r.instruments[u];o.waveFrames=new Int8Array(e),o.waveLoopStart=t,o.waveLoopLength=n})},onHoverChange:function(e){return p(e)}}),(0,Me.jsxs)("div",{className:"waveform-swatch-previews",children:[(0,Me.jsxs)("div",{className:"waveform-swatch-preview",style:{visibility:null==d?"hidden":void 0},children:[(0,Me.jsx)("span",{children:"actual"}),(0,Me.jsx)(jn,{value:o.waveforms[(null==d?void 0:d.actualValue)||0],scale:4})]}),(0,Me.jsxs)("div",{className:"waveform-swatch-preview",style:{visibility:null==d?"hidden":void 0},children:[(0,Me.jsx)("span",{children:"hovered"}),(0,Me.jsx)(jn,{value:o.waveforms[(null==d?void 0:d.value)||0],scale:4})]})]})]}),(0,Me.jsx)(Mn,{title:"Arpeggio",frames:c.arpeggioFrames,loopStart:c.arpeggioLoopStart,loopLength:c.arpeggioLoopLength,minValue:0,maxValue:B,onChange:function(e,t,n){i(function(r){var o=r.instruments[u];o.arpeggioFrames=new Int8Array(e),o.arpeggioLoopStart=t,o.arpeggioLoopLength=n})}}),(0,Me.jsx)("div",{className:"field-row",children:(0,Me.jsxs)("label",{children:[(0,Me.jsx)("input",{type:"checkbox",checked:c.arpeggioDown,onChange:function(e){var t=e.target.checked;i(function(e){e.instruments[u].arpeggioDown=t})}}),"Arpeggio reverse"]})}),(0,Me.jsx)(Mn,{title:"Pitch",frames:c.pitchFrames,loopStart:c.pitchLoopStart,loopLength:c.pitchLoopLength,minValue:z,maxValue:U,onChange:function(e,t,n){i(function(r){var o=r.instruments[u];o.pitchFrames=new Int8Array(e),o.pitchLoopStart=t,o.pitchLoopLength=n})}}),(0,Me.jsx)("div",{className:"field-row",children:(0,Me.jsxs)("label",{children:[(0,Me.jsx)("input",{type:"checkbox",checked:c.pitch16x,onChange:function(e){var t=e.target.checked;i(function(e){e.instruments[u].pitch16x=t})}}),"Pitch 16x"]})})]})]})};function Dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Rn=[0,.5,1,1.5,2,3,3.5,4,4.5,5,5.5,6],Fn=function(e){var t,n,o=e.onNoteOn,a=e.onNoteOff,i=(t=(0,r.useState)(new Set),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(t,n)||function(e,t){if(e){if("string"==typeof e)return Dn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dn(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=i[0],u=i[1],c=f.filter(function(e){return e.isAvailableInPattern}).map(function(e){var t=[1,3,6,8,10].includes(e.semitone);return{id:"".concat(e.octave,"-").concat(e.semitone),noteName:e.name,midiNoteValue:e.midi,className:"key ".concat(t?"black":"white"," ").concat(l.has(e.midi)?"active":""),left:32*(7*(e.octave-1)+Rn[e.semitone])}}),s=function(e){l.has(e)&&(u(function(t){var n=new Set(t);return n.delete(e),n}),a(e))};return(0,Me.jsx)("ul",{id:"keyboard",children:c.map(function(e){return(0,Me.jsx)("button",{className:e.className,style:{left:"".concat(e.left,"px")},onMouseDown:function(){return function(e){l.has(e)||(u(function(t){return new Set(t).add(e)}),o(e))}(e.midiNoteValue)},onMouseUp:function(){return s(e.midiNoteValue)},onMouseLeave:function(){return s(e.midiNoteValue)},children:e.noteName},e.id)})})};function zn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Un(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Un(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Bn=[{value:"selection",label:"Selection"},{value:"channel-pattern",label:"Column in pattern"},{value:"channel-song",label:"Column in song"},{value:"pattern",label:"Whole pattern"},{value:"song",label:"Whole song"}],Kn=[{value:"notes",label:"Notes"},{value:"paramX",label:"Param X"},{value:"paramY",label:"Param Y"}],$n=function(e){var t=e.enabled,n=void 0===t||t,o=e.onTranspose,a=e.onSetInstrument,i=e.onChangeInstrument,l=e.onInterpolate,u=(0,r.useId)(),c=zn((0,r.useState)("selection"),2),s=c[0],f=c[1],d=zn((0,r.useState)(2),2),p=d[0],m=d[1],h=zn((0,r.useState)(2),2),v=h[0],y=h[1],g=zn((0,r.useState)(3),2),b=g[0],w=g[1],x=zn((0,r.useState)("notes"),2),S=x[0],k=x[1];return(0,Me.jsxs)("aside",{id:"pattern-advanced-panel",className:"pattern-advanced-panel",children:[(0,Me.jsx)("header",{className:"pattern-advanced-panel__header",children:"Advanced Edit"}),(0,Me.jsxs)("div",{className:"pattern-advanced-panel__body",children:[(0,Me.jsxs)("fieldset",{className:"pattern-advanced-panel__group","aria-labelledby":"".concat(u,"-legend"),children:[(0,Me.jsx)("legend",{id:"".concat(u,"-legend"),children:"Apply edits to"}),(0,Me.jsx)("div",{className:"pattern-advanced-panel__scope",children:Bn.map(function(e){return(0,Me.jsxs)("label",{className:"pattern-advanced-panel__scopeOption",children:[(0,Me.jsx)("input",{type:"radio",name:"".concat(u,"-scope"),value:e.value,checked:s===e.value,onChange:function(){return f(e.value)}}),(0,Me.jsx)("span",{children:e.label})]},e.value)})})]}),(0,Me.jsxs)("section",{className:"pattern-advanced-panel__section",children:[(0,Me.jsx)("div",{className:"pattern-advanced-panel__sectionTitle",children:"Transpose"}),(0,Me.jsx)("div",{className:"pattern-advanced-panel__buttonRow",children:[-12,-1,1,12].map(function(e){return(0,Me.jsx)("button",{type:"button",className:"pattern-advanced-panel__button pattern-advanced-panel__button--primary",onClick:function(){return o(e,s)},disabled:!n,children:e>0?"+".concat(e):e},e)})})]}),(0,Me.jsxs)("section",{className:"pattern-advanced-panel__section",children:[(0,Me.jsx)("label",{className:"pattern-advanced-panel__stacked",children:(0,Me.jsxs)("div",{className:"pattern-advanced-panel__inputRow",children:[(0,Me.jsx)("input",{type:"number",min:0,max:63,value:p,onChange:function(e){return m(Number(e.target.value))}}),(0,Me.jsx)("button",{type:"button",className:"pattern-advanced-panel__button pattern-advanced-panel__button--primary",onClick:function(){return a(p,s)},disabled:!n,children:"Set instrument"})]})}),(0,Me.jsx)("label",{className:"pattern-advanced-panel__stacked",children:(0,Me.jsxs)("div",{className:"pattern-advanced-panel__inputRow",children:[(0,Me.jsx)("input",{type:"number",min:0,max:63,value:v,onChange:function(e){return y(Number(e.target.value))},"aria-label":"Change instrument: from"}),(0,Me.jsx)("span",{className:"pattern-advanced-panel__arrow",children:""}),(0,Me.jsx)("input",{type:"number",min:0,max:63,value:b,onChange:function(e){return w(Number(e.target.value))},"aria-label":"Change instrument: to"}),(0,Me.jsx)("button",{type:"button",className:"pattern-advanced-panel__button pattern-advanced-panel__button--primary",onClick:function(){return i(v,b,s)},disabled:!n,children:"Change Inst"})]})})]}),(0,Me.jsxs)("section",{className:"pattern-advanced-panel__section",children:[(0,Me.jsx)("div",{className:"pattern-advanced-panel__toggleRow",children:Kn.map(function(e){return(0,Me.jsxs)("label",{className:"pattern-advanced-panel__chip",children:[(0,Me.jsx)("input",{type:"radio",name:"".concat(u,"-interp"),value:e.value,checked:S===e.value,onChange:function(){return k(e.value)}}),(0,Me.jsx)("span",{children:e.label.toUpperCase()})]},e.value)})}),(0,Me.jsx)("button",{type:"button",className:"pattern-advanced-panel__button pattern-advanced-panel__button--primary",onClick:function(){return l(S,s)},disabled:!n,children:"Interpolate"})]})]})]})};function Vn(e){return Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vn(e)}function Wn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return Gn(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(Gn(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Gn(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Gn(f,"constructor",c),Gn(c,"constructor",u),u.displayName="GeneratorFunction",Gn(c,o,"GeneratorFunction"),Gn(f),Gn(f,o,"Generator"),Gn(f,r,function(){return this}),Gn(f,"toString",function(){return"[object Generator]"}),(Wn=function(){return{w:a,m:d}})()}function Gn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Gn=function(e,t,n,r){function a(t,n){Gn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Gn(e,t,n,r)}function Hn(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function qn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Hn(a,r,o,i,l,"next",e)}function l(e){Hn(a,r,o,i,l,"throw",e)}i(void 0)})}}function Qn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||er(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(n),!0).forEach(function(t){Jn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Jn(e,t,n){return(t=function(e){var t=function(e){if("object"!=Vn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Vn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Vn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=er(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function er(e,t){if(e){if("string"==typeof e)return tr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tr(e,t):void 0}}function tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var nr="0123456789abcdef".split(""),rr="mcjspvd".split(""),or=nr,ar="somatic-pattern-block",ir=12+12*M-1,lr=function(e){return Number.isFinite(e)?j(Math.floor(e),0,L-1):0},ur=function(e,t){var n=Math.min(e,t),r=Math.max(e,t),o=Math.max(r-n+1,0);return Array.from({length:o},function(e,t){return n+t})},cr=function(){},sr=function(e,t,n,r,o){var a=j(r-1,0,T-1);if(a<0)return!1;var i=j(Math.min(n.start,n.end),0,a),l=j(Math.max(n.start,n.end),0,a);if(i>l)return!1;for(var u=N-1,c=!1,s=i;s<=l;s++){var f,d=Zn(t);try{for(d.s();!(f=d.n()).done;){var p=f.value;if(Number.isFinite(p)){var m=j(Math.floor(p),0,u),h=W(m),v=o(e.getCell(h,s),h,s);v&&(e.setCell(h,s,v),c=!0)}}}catch(e){d.e(e)}finally{d.f()}}return c},fr=function(e,t,n,r,o){return sr(e,t,n,r,function(e){if(void 0===e.midiNote)return null;if(Mt(e))return null;var t=e.midiNote+o;return t<12||t>ir||t===e.midiNote?null:Xn(Xn({},e),{},{midiNote:t})})},dr=function(e,t,n,r,o){return sr(e,t,n,r,function(e){return void 0===e.instrumentIndex||1===e.instrumentIndex||e.instrumentIndex===o?null:Xn(Xn({},e),{},{instrumentIndex:o})})},pr=function(e,t,n,r,o,a){return sr(e,t,n,r,function(e){return void 0===e.instrumentIndex||1===e.instrumentIndex||e.instrumentIndex!==o||o===a?null:Xn(Xn({},e),{},{instrumentIndex:a})})},mr={notes:{min:12,max:ir,read:function(e){if(void 0!==e.midiNote&&!Mt(e))return e.midiNote},write:function(e,t){if(Mt(e))return null;var n=j(Math.round(t),12,ir);return e.midiNote===n?null:Xn(Xn({},e),{},{midiNote:n})}},paramX:{min:0,max:15,read:function(e){if(void 0!==e.effectX)return e.effectX},write:function(e,t){var n=j(Math.round(t),0,15);return e.effectX===n?null:Xn(Xn({},e),{},{effectX:n})}},paramY:{min:0,max:15,read:function(e){if(void 0!==e.effectY)return e.effectY},write:function(e,t){var n=j(Math.round(t),0,15);return e.effectY===n?null:Xn(Xn({},e),{},{effectY:n})}}},hr=function(e,t,n,r,o){var a=mr[o],i=j(r-1,0,T-1);if(i<0)return{mutated:!1,anchorPairs:0};var l,u=j(Math.min(n.start,n.end),0,i),c=j(Math.max(n.start,n.end),0,i),s=N-1,f=!1,d=0,p=Zn(t);try{for(p.s();!(l=p.n()).done;){var m=l.value;if(Number.isFinite(m)){for(var h=j(Math.floor(m),0,s),v=W(h),y=-1,g=null,b=u;b<=c;b++){var w=a.read(e.getCell(v,b));if(void 0!==w){y=b,g=w;break}}if(-1!==y&&null!==g){for(var x=-1,S=null,k=c;k>=u;k--){var C=a.read(e.getCell(v,k));if(void 0!==C){x=k,S=C;break}}if(-1!==x&&null!==S&&!(x<=y)){d++,cr();for(var E=x-y,O=y+1;O<x;O++){var _=g+(O-y)/E*(S-g),P=j(Math.round(_),a.min,a.max),I=e.getCell(v,O),A=a.write(I,P);A&&(e.setCell(v,O,A),f=!0)}}}}}}catch(e){p.e(e)}finally{p.f()}return{mutated:f,anchorPairs:d}},vr=(0,r.forwardRef)(function(e,t){var n,o,a,i,l=e.song,u=e.audio,s=e.musicState,f=e.editorState,d=e.onEditorStateChange,p=e.onSongChange,m=Math.max(0,Math.min(l.songOrder.length-1,f.activeSongPosition||0)),h=null!==(n=l.songOrder[m])&&void 0!==n?n:0,v=Math.max(0,Math.min(h,l.patterns.length-1)),y=l.patterns[v],g=(0,r.useMemo)(function(){return Array.from({length:64},function(){return Array(16).fill(null)})},[]),b=!1!==f.editingEnabled,w=(0,r.useRef)(null),x=Qn((0,r.useState)(!1),2),S=x[0],k=x[1],C=(0,r.useRef)(!1),E=Qn((0,r.useState)(!1),2),O=E[0],_=E[1],I=Ge(),A=ze().pushToast,T=f.patternSelection?{rowStart:Math.min(f.patternSelection.startRow,f.patternSelection.endRow),rowEnd:Math.max(f.patternSelection.startRow,f.patternSelection.endRow),channelStart:Math.min(f.patternSelection.startChannel,f.patternSelection.endChannel),channelEnd:Math.max(f.patternSelection.startChannel,f.patternSelection.endChannel)}:null,M=(0,r.useCallback)(function(e){C.current=e,k(e)},[]),L=(0,r.useCallback)(function(e,t){d(function(n){n.setPatternSelection({startRow:e.rowIndex,endRow:t.rowIndex,startChannel:e.channelIndex,endChannel:t.channelIndex})})},[d]);(0,r.useEffect)(function(){if(S){var e=function(){return M(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}}},[S,M]);var D=function(e,t,n){if(0===e.button){var r=function(e,t,n){if(e){if(w.current)return w.current;if(f.patternSelection){var r={rowIndex:f.patternSelection.startRow,channelIndex:W(f.patternSelection.startChannel)};return w.current=r,r}}var o={rowIndex:t,channelIndex:n};return w.current=o,o}(e.shiftKey,t,n);M(!0),L(r,{rowIndex:t,channelIndex:n})}},R=function(e,t){if(C.current){var n=w.current;n&&L(n,{rowIndex:e,channelIndex:t})}},F=function(){return!T&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&A({message:"Select a block in the pattern first.",variant:"error"}),T},z=(0,r.useCallback)(function(e){var t={start:0,end:Math.max(l.rowsPerPattern-1,0)},n=l.patterns.length,r=Array.from({length:n},function(e,t){return t}),o=ur(0,N-1);switch(e){case"selection":return T?{patternIndices:[v],channels:ur(T.channelStart,T.channelEnd),rowRange:{start:T.rowStart,end:T.rowEnd}}:(A({message:"Select a block before using Selection scope.",variant:"error"}),null);case"channel-pattern":return{patternIndices:[v],channels:[f.patternEditChannel],rowRange:t};case"channel-song":return{patternIndices:r,channels:[f.patternEditChannel],rowRange:t};case"pattern":return{patternIndices:[v],channels:o,rowRange:t};case"song":return{patternIndices:r,channels:o,rowRange:t};default:return null}},[f.patternEditChannel,A,v,T,l.patterns.length,l.rowsPerPattern]),U=(0,r.useCallback)(function(e,t){if(e){var n=z(t);if(n){var r=n.patternIndices,o=n.channels,a=n.rowRange;0!==r.length&&0!==o.length?p(function(t){var n,i=!1,l=Zn(r);try{for(l.s();!(n=l.n()).done;){var u=n.value,c=t.patterns[u];c&&fr(c,o,a,t.rowsPerPattern,e)&&(i=!0)}}catch(e){l.e(e)}finally{l.f()}i||A({message:"No notes found to transpose in that scope.",variant:"info"})}):A({message:"Nothing to transpose in that scope.",variant:"error"})}}},[p,A,z]),B=(0,r.useCallback)(function(e,t){var n=lr(e);if(1!==n){var r=z(t);if(r){var o=r.patternIndices,a=r.channels,i=r.rowRange;0!==o.length&&0!==a.length?p(function(e){var t,r=!1,l=Zn(o);try{for(l.s();!(t=l.n()).done;){var u=t.value,c=e.patterns[u];c&&dr(c,a,i,e.rowsPerPattern,n)&&(r=!0)}}catch(e){l.e(e)}finally{l.f()}r||A({message:"No instruments were eligible for update.",variant:"info"})}):A({message:"Nothing to edit in that scope.",variant:"error"})}}else A({message:"Instrument 1 is reserved for note cuts.",variant:"error"})},[p,A,z]),K=(0,r.useCallback)(function(e,t,n){var r=lr(e),o=lr(t);if(1!==r&&1!==o)if(r!==o){var a=z(n);if(a){var i=a.patternIndices,l=a.channels,u=a.rowRange;0!==i.length&&0!==l.length?p(function(e){var t,n=!1,a=Zn(i);try{for(a.s();!(t=a.n()).done;){var c=t.value,s=e.patterns[c];s&&pr(s,l,u,e.rowsPerPattern,r,o)&&(n=!0)}}catch(e){a.e(e)}finally{a.f()}n||A({message:"No matching instruments were found to change.",variant:"info"})}):A({message:"Nothing to edit in that scope.",variant:"error"})}}else A({message:"Choose different instruments to change.",variant:"info"});else A({message:"Instrument 1 is reserved for note cuts.",variant:"error"})},[p,A,z]),$=(0,r.useCallback)(function(e,t){var n=z(t);if(n){var r=n.patternIndices,o=n.channels,a=n.rowRange;if(0!==r.length&&0!==o.length){var i=!1,l=0;p(function(t){var n,u=Zn(r);try{for(u.s();!(n=u.n()).done;){var c=n.value,s=t.patterns[c];if(s){var f=hr(s,o,a,t.rowsPerPattern,e);cr(),f.mutated&&(i=!0),l+=f.anchorPairs}}}catch(e){u.e(e)}finally{u.f()}}),i||A(0===l?{message:"Need at least two anchors with values to interpolate.",variant:"info"}:{message:"No eligible rows between anchors to update.",variant:"info"})}else A({message:"Nothing to interpolate in that scope.",variant:"error"})}},[p,A,z]),V=function(){var e=F();if(!e)return null;var t=Math.max(0,l.rowsPerPattern-1),n=N-1,r=Math.max(0,Math.min(e.rowStart,t)),o=Math.max(0,Math.min(e.rowEnd,t)),a=Math.max(0,Math.min(e.channelStart,n)),i=Math.max(0,Math.min(e.channelEnd,n)),u=o-r+1,c=i-a+1,s=Array.from({length:u},function(e,t){var n=r+t;return Array.from({length:c},function(e,t){var r=a+t;return Xn({},y.getCell(W(r),n))})});return{type:ar,version:1,rows:u,channels:c,cells:s}},G=function(){var e=qn(Wn().m(function e(t){var n;return Wn().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,I.copyObjectToClipboard(t);case 1:return e.a(2,!0);case 2:return e.p=2,n=e.v,console.error("Pattern copy failed",n),A({message:"Failed to copy pattern selection.",variant:"error"}),e.a(2,!1)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=F(!1);e&&p(function(t){for(var n=t.patterns[v],r=Math.max(0,t.rowsPerPattern-1),o=N-1,a=e.rowStart;a<=e.rowEnd&&a<=r;a++)for(var i=e.channelStart;i<=e.channelEnd&&i<=o;i++)n.setCell(W(i),a,{})})},q=function(){var e=qn(Wn().m(function e(){var t;return Wn().w(function(e){for(;;)switch(e.n){case 0:if(t=V()){e.n=1;break}return e.a(2);case 1:return e.n=2,G(t);case 2:if(e.v){e.n=3;break}return e.a(2);case 3:H();case 4:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=qn(Wn().m(function e(){var t,n;return Wn().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,I.readObjectFromClipboard();case 1:if((t=e.v)&&t.type===ar&&1===t.version&&Array.isArray(t.cells)){e.n=2;break}return A({message:"Clipboard does not contain a pattern block.",variant:"error"}),e.a(2,null);case 2:return e.a(2,t);case 3:return e.p=3,n=e.v,console.error("Pattern paste failed",n),A({message:"Failed to read clipboard for paste.",variant:"error"}),e.a(2,null)}},e,null,[[0,3]])}));return function(){return e.apply(this,arguments)}}(),Y=function(e){var t,n,r=Math.max(0,Math.min(null!==(t=f.patternEditRow)&&void 0!==t?t:0,l.rowsPerPattern-1)),o=null!==(n=f.patternEditChannel)&&void 0!==n?n:0,a=Math.max(0,l.rowsPerPattern-1),i=N-1;p(function(t){for(var n=t.patterns[v],l=0;l<e.rows;l++){var u,c=r+l;if(c>a)break;for(var s=null!==(u=e.cells[l])&&void 0!==u?u:[],f=0;f<e.channels;f++){var d=o+f;if(d>i)break;var p=s[f];p&&n.setCell(W(d),c,Xn({},p))}}});var u=Math.min(r+e.rows-1,a),c=Math.min(o+e.channels-1,i);d(function(e){e.setPatternSelection({startRow:r,endRow:u,startChannel:o,endChannel:c}),e.setPatternEditTarget({rowIndex:u,channelIndex:W(c)})}),w.current={rowIndex:r,channelIndex:W(o)},re(r,4*o)},X=function(){var e=qn(Wn().m(function e(){var t;return Wn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Q();case 1:if(t=e.v){e.n=2;break}return e.a(2);case 2:Y(t);case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),J=null!==(o=s.somaticSongPosition)&&void 0!==o?o:-1,Z=null!==(a=s.tic80RowIndex)&&void 0!==a?a:-1,ee=J>=0&&l.songOrder.length>0&&null!==(i=l.songOrder[Math.min(J,l.songOrder.length-1)])&&void 0!==i?i:null,te=null!==ee&&ee===v&&Z>=0?Math.max(0,Math.min(l.rowsPerPattern-1,Z)):null,ne=function(e){u.playRow(y,e)},re=function(e,t){var n,r=null===(n=g[e])||void 0===n?void 0:n[t];r&&r.focus()},oe=function(e,t){var n,r=null!==(n=l.patternEditStep)&&void 0!==n?n:0;if(!(r<=0)){var o=l.rowsPerPattern;d(function(e){return e.advancePatternEditRow(r,o)});var a=j(e+r,0,Math.max(0,o-1));a!==e&&re(a,t)}};(0,r.useImperativeHandle)(t,function(){return{focusPattern:function(){var e=f.patternEditRow||0,t=4*(f.patternEditChannel||0);re(e,t)}}},[f.patternEditChannel,f.patternEditRow,re]);var ae=function(e){var t,n=e.currentTarget,r=parseInt(n.dataset.rowIndex,10),o=parseInt(n.dataset.channelIndex,10),a=n.dataset.cellType,i=parseInt(n.dataset.columnIndex,10);if(!function(e){if(e.repeat)return!1;var t,n=e.ctrlKey||e.metaKey,r=e.key.toLowerCase();if(n&&!e.altKey){if("c"===r||"Insert"===e.key)return e.preventDefault(),(t=V())&&G(t),!0;if("v"===r)return e.preventDefault(),X(),!0;if("x"===r)return e.preventDefault(),q(),!0}if(!n&&!e.altKey&&e.shiftKey){if("Insert"===e.key)return e.preventDefault(),X(),!0;if("Delete"===e.key)return e.preventDefault(),q(),!0}return!1}(e)){var c=function(e,t,n,r){var o=l.rowsPerPattern,a=Math.max(l.highlightRowCount||1,1);if("ArrowUp"===n){if(r){var i=e-4;return i<0?m>0?(d(function(e){return e.setActiveSongPosition(m-1)}),[o+i,t]):[0,t]:[i,t]}var u=e-1;return u<0?m>0?(d(function(e){return e.setActiveSongPosition(m-1)}),[o-1,t]):[0,t]:[u,t]}if("ArrowDown"===n){if(r){var c=e+4;return c>=o?m<l.songOrder.length-1?(d(function(e){return e.setActiveSongPosition(m+1)}),[c-o,t]):[o-1,t]:[c,t]}var s=e+1;return s>=o?m<l.songOrder.length-1?(d(function(e){return e.setActiveSongPosition(m+1)}),[0,t]):[o-1,t]:[s,t]}if("ArrowLeft"===n)return r?[e,(Math.floor(t/4)+4-1)%4*4+t%4]:[e,(t+16-1)%16];if("ArrowRight"===n)return r?[e,(Math.floor(t/4)+1)%4*4+t%4]:[e,(t+1)%16];if("PageUp"===n){var f=Math.floor(e/a)-1,p=f*a;if(p<0){if(m>0){d(function(e){return e.setActiveSongPosition(m-1)});var h=(Math.ceil(o/a)+f)*a;return[Math.max(0,h),t]}return[0,t]}return[p,t]}if("PageDown"===n){var v=(Math.floor(e/a)+1)*a;return v>=o?m<l.songOrder.length-1?(d(function(e){return e.setActiveSongPosition(m+1)}),[v-o,t]):[o-1,t]:[v,t]}return"Home"===n?r||0===e?[0,0]:[0,t]:"End"===n?r||e===o-1?[o-1,15]:[o-1,t]:null}(null!==(t=f.patternEditRow)&&void 0!==t?t:r,i,e.key,e.ctrlKey);if(c){var s=Qn(c,2),h=s[0],y=s[1],g=W(Math.floor(y/4));return d(function(e){return e.setPatternEditTarget({rowIndex:h,channelIndex:g})}),w.current={rowIndex:h,channelIndex:g},re(h,y),void e.preventDefault()}if("Enter"===e.key&&!e.repeat)return e.preventDefault(),void ne(r);if(b){if(!(e.altKey||e.shiftKey||e.ctrlKey||"Delete"!==e.key||e.repeat))return e.preventDefault(),void p(function(e){e.patterns[v].setCell(o,r,{midiNote:void 0,instrumentIndex:void 0,effect:void 0,effectX:void 0,effectY:void 0})});if(!(e.altKey||e.shiftKey||e.ctrlKey||"Backspace"!==e.key||e.repeat))return e.preventDefault(),void p(function(e){var t=Math.max(0,Math.min(v,e.patterns.length-1)),n=e.patterns[t],i=n.getCell(o,r);"note"===a?n.setCell(o,r,Xn(Xn({},i),{},{midiNote:void 0})):"instrument"===a?n.setCell(o,r,Xn(Xn({},i),{},{instrumentIndex:void 0})):"command"===a?n.setCell(o,r,Xn(Xn({},i),{},{effect:void 0})):"param"===a&&n.setCell(o,r,Xn(Xn({},i),{},{effectX:void 0,effectY:void 0}))});if("note"!==a||e.repeat)if("instrument"===a&&nr.includes(e.key)&&!e.repeat)!function(e,t,n){var r=nr.indexOf(n);-1!==r&&(p(function(n){var o=Math.max(0,Math.min(v,n.patterns.length-1)),a=n.patterns[o],i=a.getCell(e,t);a.setCell(e,t,Xn(Xn({},i),{},{instrumentIndex:r}))}),u.isPlaying||ne(t))}(o,r,e.key);else if("command"===a&&rr.includes(e.key)&&!e.repeat){var x=function(e,t,n){var r=rr.indexOf(n);return-1!==r&&(p(function(n){var o=Math.max(0,Math.min(v,n.patterns.length-1)),a=n.patterns[o],i=a.getCell(e,t);a.setCell(e,t,Xn(Xn({},i),{},{effect:r}))}),!0)}(o,r,e.key);x&&(oe(r,i),e.preventDefault())}else if("param"===a&&or.includes(e.key)&&!e.repeat){var S=function(e,t,n){var r=or.indexOf(n);return-1!==r&&(p(function(n){var o,a=Math.max(0,Math.min(v,n.patterns.length-1)),i=n.patterns[a],l=i.getCell(e,t),u=255&((null!==(o=l.effectY)&&void 0!==o?o:0)<<4|r),c=u>>4&15,s=15&u;i.setCell(e,t,Xn(Xn({},l),{},{effectX:c,effectY:s}))}),!0)}(o,r,e.key);S&&(oe(r,i),e.preventDefault())}else"0"!==e.key||"note"!==a||e.repeat||p(function(e){var t=Math.max(0,Math.min(v,e.patterns.length-1)),n=e.patterns[t],a=n.getCell(o,r);n.setCell(o,r,Xn(Xn({},a),{},{midiNote:void 0}))});else!function(e,t,n){n.shiftKey&&"Backspace"===n.key&&p(function(n){var r=n.patterns[v],o=r.getCell(e,t);r.setCell(e,t,Xn(Xn({},o),{},{midiNote:69,instrumentIndex:1}))})}(o,r,e)}}},ie=function(){},le=function(e,t,n){!function(e){var t=e.rowIndex,n=e.channelIndex;d(function(e){return e.setPatternEditTarget({rowIndex:t,channelIndex:n})})}({rowIndex:e,channelIndex:t}),w.current={rowIndex:e,channelIndex:t}},ue=function(e){return!!T&&e>=T.channelStart&&e<=T.channelEnd};return(0,Me.jsxs)("div",{className:"pattern-grid-shell".concat(O?" pattern-grid-shell--advanced-open":""),children:[O&&(0,Me.jsx)($n,{onTranspose:U,onSetInstrument:B,onChangeInstrument:K,onInterpolate:$}),(0,Me.jsxs)("div",{className:"pattern-grid-container".concat(b?" pattern-grid-container--editMode":" pattern-grid-container--locked"),children:[(0,Me.jsx)(nn,{title:O?"Hide advanced edit panel":"Show advanced edit panel",children:(0,Me.jsx)("button",{type:"button",className:"pattern-advanced-handle".concat(O?" pattern-advanced-handle--open":""),onClick:function(){return _(function(e){return!e})},"aria-expanded":O,"aria-controls":"pattern-advanced-panel",children:O?"":""})}),(0,Me.jsxs)("table",{className:"pattern-grid",children:[(0,Me.jsx)("colgroup",{children:(0,Me.jsx)("col",{})}),(0,Me.jsx)("thead",{children:(0,Me.jsxs)("tr",{children:[(0,Me.jsx)("th",{}),[0,1,2,3].map(function(e){var t="channel-header".concat(ue(e)?" channel-header--selected":"");return(0,Me.jsx)("th",{colSpan:4,className:t,children:e+1},e)})]})}),(0,Me.jsx)("tbody",{children:Array.from({length:l.rowsPerPattern},function(e,t){var n=Math.max(l.highlightRowCount||1,1),o=Math.floor(t/n)%2,a="".concat(0===o?"row-section-a":"row-section-b").concat(te===t?" active-row":""),i=!!T&&t>=T.rowStart&&t<=T.rowEnd,u="row-number".concat(i?" row-number--selected":"");return(0,Me.jsxs)("tr",{className:a,children:[(0,Me.jsx)("td",{className:u,children:t}),y.channels.map(function(e,n){var o,a,l=W(n),u=e.rows[t],s=Mt(u),d=s?"^^^":(a=u.midiNote)?function(e){var t;return null===(t=c[e])||void 0===t?void 0:t.name}(a):"---",p=s?"":null==(o=u.instrumentIndex)?"--":o.toString(16).toUpperCase(),m=function(e){return null==e?"-":"".concat(rr[e].toUpperCase())||"?"}(u.effect),h=function(e,t){if(null==e&&null==t)return"--";var n=null==e?"-":e.toString(16).toUpperCase(),r=null==t?"-":t.toString(16).toUpperCase();return"".concat(n).concat(r)}(u.effectX,u.effectY),v=4*l,y=4*l+1,b=4*l+2,w=4*l+3,x=!u.midiNote&&void 0===u.effect&&null==u.instrumentIndex&&void 0===u.effectX&&void 0===u.effectY,S=f.patternEditChannel===l&&f.patternEditRow===t,k=ue(l),j=i&&k,C=function(e){if(!j||!T)return"";var n=" pattern-cell--selected";return t===T.rowStart&&(n+=" pattern-cell--selection-top"),t===T.rowEnd&&(n+=" pattern-cell--selection-bottom"),l===T.channelStart&&"note"===e&&(n+=" pattern-cell--selection-left"),l===T.channelEnd&&"param"===e&&(n+=" pattern-cell--selection-right"),n},E=!1,O="";u.effect===P.J&&(E=!0,O="The 'J' command is not supported in Somatic patterns."),void 0!==u.midiNote&&0===u.instrumentIndex&&(E=!0,O="Instrument 0 is reserved and should not be used."),void 0!==u.effect||void 0===u.effectX&&void 0===u.effectY||(E=!0,O="Effect parameter set without an effect command."),void 0!==u.instrumentIndex&&void 0===u.midiNote&&(E=!0,O="Instrument set without a note.");var _="".concat(x?" empty-cell":"").concat(S?" metaCellFocus":"").concat(s?" note-cut-cell":"").concat(E?" error-cell":""),N=C("note"),I=C("instrument"),A=C("command"),M=C("param"),L="note-cell".concat(_).concat(N),F="instrument-cell".concat(_).concat(I),z="command-cell".concat(_).concat(A),U="param-cell".concat(_).concat(M);return(0,Me.jsxs)(r.Fragment,{children:[(0,Me.jsx)("td",{tabIndex:0,ref:function(e){return g[t][v]=e},className:L,onKeyDown:ae,onKeyUp:ie,onMouseDown:function(e){return D(e,t,l)},onMouseEnter:function(){return R(t,l)},onFocus:function(){return le(t,l)},"data-row-index":t,"data-channel-index":l,"data-cell-type":"note","data-column-index":v,"data-cell-value":"[".concat(JSON.stringify(u.midiNote),"]"),children:(0,Me.jsx)(nn,{title:O,disabled:!E,children:(0,Me.jsx)("div",{children:d})})}),(0,Me.jsx)("td",{tabIndex:0,ref:function(e){return g[t][y]=e},className:F,onKeyDown:ae,onKeyUp:ie,onMouseDown:function(e){return D(e,t,l)},onMouseEnter:function(){return R(t,l)},onFocus:function(){return le(t,l)},"data-row-index":t,"data-channel-index":l,"data-cell-type":"instrument","data-column-index":y,"data-cell-value":"[".concat(JSON.stringify(u.instrumentIndex),"]"),children:p}),(0,Me.jsx)("td",{tabIndex:0,ref:function(e){return g[t][b]=e},className:z,onKeyDown:ae,onKeyUp:ie,onMouseDown:function(e){return D(e,t,l)},onMouseEnter:function(){return R(t,l)},onFocus:function(){return le(t,l)},"data-row-index":t,"data-channel-index":l,"data-cell-type":"command","data-column-index":b,"data-cell-value":"[".concat(JSON.stringify(u.effect),"]"),children:m}),(0,Me.jsx)("td",{tabIndex:0,ref:function(e){return g[t][w]=e},className:U,onKeyDown:ae,onKeyUp:ie,onMouseDown:function(e){return D(e,t,l)},onMouseEnter:function(){return R(t,l)},onFocus:function(){return le(t,l)},"data-row-index":t,"data-channel-index":l,"data-cell-type":"param","data-column-index":w,"data-cell-value":"[X=".concat(JSON.stringify(u.effectX),",Y=").concat(JSON.stringify(u.effectY),"]"),children:h})]},l)})]},t)})})]})]})]})}),yr=function(e){var t=e.midiStatus,n=e.midiDevices,r=e.onClose;return(0,Me.jsxs)("div",{className:"preferences-panel",role:"dialog","aria-label":"Preferences",children:[(0,Me.jsx)("h2",{children:"Preferences"}),(0,Me.jsxs)("section",{children:[(0,Me.jsx)("h3",{children:"MIDI"}),(0,Me.jsxs)("p",{children:["Status: ",t]}),(0,Me.jsxs)("ul",{children:[0===n.length&&(0,Me.jsx)("li",{children:"No MIDI devices detected."}),n.map(function(e){return(0,Me.jsxs)("li",{children:[(0,Me.jsx)("strong",{children:e.name})," ",e.manufacturer?"(".concat(e.manufacturer,")"):"","  ",e.state]},e.id)})]})]}),(0,Me.jsx)("div",{className:"preferences-panel__actions",children:(0,Me.jsx)("button",{onClick:r,children:"Close"})})]})},gr=function(e){var t=e.content,n=e.children,r=e.label,o=e.className;return(0,Me.jsx)(nn,{title:t,className:o,children:(0,Me.jsx)("span",{className:"tooltip-trigger",tabIndex:0,"aria-label":r,role:"note",children:n})})},br=function(e){var t=e.song,n=e.editorState,r=e.onSongChange,o=e.onEditorStateChange,a=(e.audio,Math.round(6*t.tempo/t.speed*10)/10),i=t.songOrder[n.activeSongPosition];return t.patterns[i],(0,Me.jsxs)("div",{className:"section",children:[(0,Me.jsxs)("div",{className:"field-row",children:[(0,Me.jsx)("label",{htmlFor:"song-tempo",children:"Tempo"}),(0,Me.jsx)(gr,{content:(0,Me.jsxs)(Me.Fragment,{children:["Effective BPM  tempo*6/speed. Higher tempo = faster; higher speed = slower rows.",(0,Me.jsx)("br",{}),"Current  ",a," BPM."]}),children:(0,Me.jsx)("span",{"aria-hidden":"true",children:"?"})}),(0,Me.jsx)("input",{id:"song-tempo",type:"number",min:1,max:255,value:t.tempo,onChange:function(e){var t=E(e.target.value);null!==t&&r(function(e){return e.setTempo(t)})}})]}),(0,Me.jsxs)("div",{className:"field-row",children:[(0,Me.jsx)("label",{htmlFor:"song-speed",children:"Speed"}),(0,Me.jsx)(gr,{label:"Speed help",content:(0,Me.jsxs)(Me.Fragment,{children:["TIC tick divisor; rows advance slower as speed increases. Effective BPM  tempo*6/speed.",(0,Me.jsx)("br",{}),"Current  ",a," BPM."]}),children:(0,Me.jsx)("span",{"aria-hidden":"true",children:"?"})}),(0,Me.jsx)("input",{id:"song-speed",type:"number",min:1,max:31,value:t.speed,onChange:function(e){var t=E(e.target.value);null!==t&&r(function(e){return e.setSpeed(t)})}})]}),(0,Me.jsxs)("div",{className:"field-row",children:[(0,Me.jsx)("label",{htmlFor:"song-rows-per-pattern",children:"Pattern Len"}),(0,Me.jsx)(gr,{content:(0,Me.jsx)(Me.Fragment,{children:"Rows per pattern. Affects all patterns in the song."}),children:(0,Me.jsx)("span",{"aria-hidden":"true",children:"?"})}),(0,Me.jsx)("input",{id:"song-rows-per-pattern",type:"number",min:1,max:T,value:t.rowsPerPattern,onChange:function(e){var t=E(e.target.value);null!==t&&r(function(e){return e.setRowsPerPattern(t)})}})]}),(0,Me.jsxs)("label",{children:["Highlight rows",(0,Me.jsx)("input",{type:"number",min:1,max:64,value:t.highlightRowCount,onChange:function(e){var t=E(e.target.value);null!==t&&r(function(e){return e.setHighlightRowCount(t)})}})]}),(0,Me.jsxs)("label",{children:["Edit step",(0,Me.jsx)("input",{type:"number",min:0,max:32,value:t.patternEditStep,onChange:function(e){var t=E(e.target.value);null!==t&&r(function(e){return e.setPatternEditStep(t)})}})]}),(0,Me.jsxs)("label",{children:["Octave",(0,Me.jsx)("input",{type:"number",min:1,max:M,value:n.octave,onChange:function(e){var t=E(e.target.value);null!==t&&o(function(e){return e.setOctave(t)})}})]}),(0,Me.jsxs)("label",{children:["Instrument",(0,Me.jsx)("select",{value:n.currentInstrument,onChange:function(e){return o(function(t){return t.setCurrentInstrument(parseInt(e.target.value,10))})},children:Array.from({length:L},function(e,n){return(0,Me.jsx)("option",{value:n,children:t.instruments[n].name},n)})})]})]})};function wr(e){return wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wr(e)}function xr(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return Sr(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(Sr(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Sr(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Sr(f,"constructor",c),Sr(c,"constructor",u),u.displayName="GeneratorFunction",Sr(c,o,"GeneratorFunction"),Sr(f),Sr(f,o,"Generator"),Sr(f,r,function(){return this}),Sr(f,"toString",function(){return"[object Generator]"}),(xr=function(){return{w:a,m:d}})()}function Sr(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Sr=function(e,t,n,r){function a(t,n){Sr(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Sr(e,t,n,r)}function kr(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function jr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jr(Object(n),!0).forEach(function(t){Er(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Er(e,t,n){return(t=function(e){var t=function(e){if("object"!=wr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==wr(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Or(e,t){if(e){if("string"==typeof e)return _r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_r(e,t):void 0}}function _r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Pr=Array.from({length:16},function(e,t){return"--tic-".concat(t)}),Nr=Pr.map(function(e){return"".concat(e,"-contrast")}),Ir=["--bg","--panel","--panel-strong","--text","--muted","--border","--border-strong","--accent","--accent-strong","--row-a","--row-b","--row-active","--tooltip-bg","--tooltip-text","--success-accent","--error-accent","--error-surface-bg","--error-surface-text","--error-surface-border","--edit-border","--cell-note","--cell-instrument","--cell-command","--cell-param","--keyboard-white-key","--keyboard-black-key","--keyboard-white-text","--keyboard-black-text"];function Ar(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.documentElement;return(getComputedStyle(t).getPropertyValue(e)||"").trim()}var Tr=function(e){var t=e.color;return(0,Me.jsx)("div",{className:"theme-panel__swatch",style:{background:t},draggable:!0,onDragStart:function(e){e.dataTransfer.setData("application/json",t),e.dataTransfer.setData("text/plain",t)},onDragOver:function(e){e.preventDefault()},title:t,"aria-label":t})},Mr=function(e){var t,n,o=e.onClose,a=ze().pushToast,i=(t=r.useState(function(){for(var e={},t=0,n=[].concat(Pr,function(e){if(Array.isArray(e))return _r(e)}(o=Nr)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||Or(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),Ir);t<n.length;t++){var r=n[t];e[r]=Ar(r)}var o;return e}),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(t,n)||Or(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=i[0],u=i[1],c=r.useCallback(function(e,t){document.documentElement.style.setProperty(e,t),u(function(n){return Cr(Cr({},n),{},Er({},e,t))})},[]),s=function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},f=r.useMemo(function(){for(var e=new Map,t=0;t<Pr.length;t++){var n=l[Pr[t]],r=l[Nr[t]];n&&r&&e.set(n,r)}return e},[l]),d=function(){var e,t=(e=xr().m(function e(){var t,n;return xr().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=[].concat(Ir).map(function(e){return"".concat(e,": ").concat(l[e],";")}),n=t.join("\n  ")+"\n",e.p=1,e.n=2,navigator.clipboard.writeText(n);case 2:a({message:"Theme variables copied to clipboard",variant:"success"}),console.log("Theme variables copied to clipboard"),e.n=4;break;case 3:e.p=3,e.v,a({message:"Copy failed",variant:"error"});case 4:return e.a(2)}},e,null,[[1,3]])}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){kr(a,r,o,i,l,"next",e)}function l(e){kr(a,r,o,i,l,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}();return(0,Me.jsxs)("div",{className:"theme-panel",role:"dialog","aria-label":"Theme editor",children:[(0,Me.jsx)("h2",{children:"Theme Editor"}),(0,Me.jsx)("p",{children:"Drag a palette swatch onto a variable to assign it. Export copies current vars."}),(0,Me.jsx)("div",{className:"theme-panel__palette","aria-label":"TIC-80 palette",children:Pr.map(function(e){return(0,Me.jsx)(Tr,{color:l[e]},e)})}),(0,Me.jsx)("div",{className:"theme-panel__vars","aria-label":"Theme variables",children:Ir.map(function(e){return(0,Me.jsxs)("button",{className:"theme-panel__var",onDragOver:s,onDrop:function(t){return function(e,t){e.preventDefault();var n=e.dataTransfer.getData("application/x-somatic-color")||e.dataTransfer.getData("text/plain");n&&c(t,n)}(t,e)},style:{background:l[e],color:(t=l[e],f.get(t)||"#000")},title:"".concat(e," ").concat(l[e]," (drop a swatch to change)"),children:[(0,Me.jsx)("span",{className:"theme-panel__var-name",children:e}),(0,Me.jsx)("span",{className:"theme-panel__var-value",children:l[e]})]},e);var t})}),(0,Me.jsxs)("div",{className:"theme-panel__actions",children:[(0,Me.jsx)("button",{onClick:function(){return a({message:"Example toast success",variant:"success"})},children:"Example Toast success"}),(0,Me.jsx)("button",{onClick:function(){return a({message:"Example toast error",variant:"error"})},children:"Example Toast error"}),(0,Me.jsx)("span",{className:"menu-separator"}),(0,Me.jsx)("button",{onClick:d,children:"Copy CSS"}),(0,Me.jsx)("button",{onClick:o,children:"Close"})]})]})};function Lr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Dr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Rr=(0,r.forwardRef)(function(e,t){var n,o=e.args,a=void 0===o?[]:o,i=(0,r.useRef)(null),l=(0,r.useRef)(null),u=(0,r.useRef)(!1),c=Lr((0,r.useState)(null),2),s=c[0],f=c[1],d=Lr((0,r.useState)(null),2),p=d[0],m=d[1],h="tic80-iframe-root";(0,r.useImperativeHandle)(t,function(){return{getWindow:function(){var e,t;return null!==(e=null===(t=i.current)||void 0===t?void 0:t.contentWindow)&&void 0!==e?e:null},getDocument:function(){var e,t;return null!==(e=null===(t=i.current)||void 0===t?void 0:t.contentDocument)&&void 0!==e?e:null}}},[]),(0,r.useEffect)(function(){var e,t=i.current;if(t){var n=function(){var e=t.contentDocument,n=t.contentWindow;if(e&&n){console.log("[tic80 iframe] loaded iframe",e,n),e.open(),e.write("<!doctype html><html><head></head><body></body></html>"),e.close(),e.documentElement.style.width="100%",e.documentElement.style.height="100%",e.body.style.margin="0",e.body.style.width="100%",e.body.style.height="100%",e.body.style.background="#1a1c2c",e.body.style.overflow="hidden";var r=e.createElement("div");r.id=h,r.style.width="100%",r.style.height="100%",r.style.position="relative",e.body.appendChild(r),f(e),m(n)}};return t.addEventListener("load",n),"complete"===(null===(e=t.contentDocument)||void 0===e?void 0:e.readyState)&&n(),function(){return t.removeEventListener("load",n)}}},[h]),(0,r.useEffect)(function(){if(s&&p&&l.current&&!u.current){console.log("[tic80 iframe] injecting Module",p.Module,l.current,a),p.Module={canvas:l.current,arguments:a};var e=s.createElement("script");e.type="text/javascript",e.src="/tic80.js",s.head.appendChild(e),u.current=!0}},[s,p]);var v=null!==(n=null==s?void 0:s.getElementById(h))&&void 0!==n?n:null;return(0,Me.jsxs)(Me.Fragment,{children:[(0,Me.jsx)("iframe",{ref:i,style:{width:"100%",height:"100%",border:0,display:"block"},sandbox:"allow-scripts allow-same-origin"}),v&&(0,Zt.createPortal)((0,Me.jsx)("canvas",{ref:l,id:"canvas",style:{width:"100%",height:"100%",display:"block",imageRendering:"pixelated"},onContextMenu:function(e){return e.preventDefault()},onMouseDown:function(){return null==p?void 0:p.focus()}}),v)]})});function Fr(e){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fr(e)}function zr(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return Ur(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(Ur(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Ur(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Ur(f,"constructor",c),Ur(c,"constructor",u),u.displayName="GeneratorFunction",Ur(c,o,"GeneratorFunction"),Ur(f),Ur(f,o,"Generator"),Ur(f,r,function(){return this}),Ur(f,"toString",function(){return"[object Generator]"}),(zr=function(){return{w:a,m:d}})()}function Ur(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Ur=function(e,t,n,r){function a(t,n){Ur(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Ur(e,t,n,r)}function Br(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function Kr(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Br(a,r,o,i,l,"next",e)}function l(e){Br(a,r,o,i,l,"throw",e)}i(void 0)})}}function $r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Wr(r.key),r)}}function Vr(e,t,n){return(t=Wr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wr(e){var t=function(e){if("object"!=Fr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Fr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Fr(t)?t:t+""}var Gr=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Vr(this,"locked",!1),Vr(this,"queue",[])},t=[{key:"acquire",value:(r=Kr(zr().m(function e(){var t=this;return zr().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e){!function(){if(!t.locked)return t.locked=!0,void e(t.makeRelease());t.queue.push(function(){t.locked=!0,e(t.makeRelease())})}()}))},e)})),function(){return r.apply(this,arguments)})},{key:"makeRelease",value:function(){var e=this,t=!1;return function(){if(!t){t=!0;var n=e.queue.shift();n?n():e.locked=!1}}}},{key:"runExclusive",value:(n=Kr(zr().m(function e(t){var n;return zr().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,this.acquire();case 1:return n=e.v,e.p=2,e.n=3,t();case 3:return e.a(2,e.v);case 4:return e.p=4,n(),e.f(4);case 5:return e.a(2)}},e,this,[[2,,4,5]])})),function(e){return n.apply(this,arguments)})}],t&&$r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function Hr(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return qr(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(qr(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,qr(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,qr(f,"constructor",c),qr(c,"constructor",u),u.displayName="GeneratorFunction",qr(c,o,"GeneratorFunction"),qr(f),qr(f,o,"Generator"),qr(f,r,function(){return this}),qr(f,"toString",function(){return"[object Generator]"}),(Hr=function(){return{w:a,m:d}})()}function qr(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}qr=function(e,t,n,r){function a(t,n){qr(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},qr(e,t,n,r)}function Qr(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function Yr(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Qr(a,r,o,i,l,"next",e)}function l(e){Qr(a,r,o,i,l,"throw",e)}i(void 0)})}}function Xr(e){return function(e){if(Array.isArray(e))return Zr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Jr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jr(e,t){if(e){if("string"==typeof e)return Zr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zr(e,t):void 0}}function Zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var eo=(0,r.forwardRef)(function(e,t){var n,o,a=e.onReady,i=(0,r.useRef)(null),l=(0,r.useRef)(null),u=(0,r.useRef)(null),c=(0,r.useRef)(null),s=(0,r.useRef)("init"),f=(0,r.useRef)(!1),d=(0,r.useRef)(0),p=(0,r.useRef)(0),m=(0,r.useRef)(0),h=(0,r.useRef)(0),v=(0,r.useRef)(new Gr),y=(n=(0,r.useState)(!1),o=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(n,o)||Jr(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),g=y[0],b=y[1],w=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=console).log.apply(e,["[Tic80Bridge]"].concat(n))};function x(){var e;if(g&&(S(),0===k(85708))){var t=k(85709),n=k(85703),r=null!==(e=m.current)&&void 0!==e?e:0;if(t!==p.current||n!==r){p.current=t;for(var o=[];r!==n;){var a=k(G+r+0),i=k(G+r+1);if(0!==a||0!==i){var l=2+i;if(i>31||l>240||r+l>240)r=0;else{for(var u=new Uint8Array(i),c=0;c<i;c++)u[c]=k(G+r+2+c);if(1===a){var s=String.fromCharCode.apply(String,Xr(u));o.push(s)}else w("unknown outbox cmd ".concat(a," len=").concat(i));(r+=l)>=240&&(r=0)}}else r=0}m.current=r,o.length&&o.forEach(function(e){return w("[cart] ".concat(e))})}}}function S(){if(!g||!l.current||!u.current||null==c.current)throw new Error("Tic80Bridge not ready yet.")}function k(e){var t;return S(),null!==(t=u.current[c.current+e])&&void 0!==t?t:0}function j(e){var t;S();var n=null!==(t=u.current[c.current+e])&&void 0!==t?t:0;return n>127?n-256:n}function C(e,t){if(S(),t<0||t>255)throw new Error("pokeU8 value out of range: ".concat(t));u.current[c.current+e]=t}function E(e,t){if(S(),t<-128||t>127)throw new Error("pokeS8 value out of range: ".concat(t));u.current[c.current+e]=t}function O(e,t){S(),u.current.set(t,c.current+e)}function _(e,t){S();var n=c.current+e;return u.current.slice(n,n+t)}function P(){return(P=Yr(Hr().m(function e(t,n){return Hr().w(function(e){for(;;)switch(e.n){case 0:return S(),e.n=1,T([4],"Begin song Upload: ".concat(n));case 1:return O(65508,t.waveformData),O(65764,t.sfxData),O(81508,t.trackData),O(32768,t.songOrderData),O(33025,t.patternData),e.n=2,T([5],"End song Upload");case 2:return e.a(2)}},e)}))).apply(this,arguments)}function N(){return(N=Yr(Hr().m(function e(t){var n,r,o,a,i;return Hr().w(function(e){for(;;)switch(e.n){case 0:return r=255&(null!==(n=t.channel)&&void 0!==n?n:0),o=255&t.sfxId,a=255&t.tic80Note,i=255&t.speed,e.n=1,T([6,o,a,r,i],"Play SFX");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function I(){return(I=Yr(Hr().m(function e(t){var n,r;return Hr().w(function(e){for(;;)switch(e.n){case 0:return r=null!==(n=t.channel)&&void 0!==n?n:0,e.n=1,T([7,0,0,255&r],"Stop SFX");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function A(e,t){S();C(85644,1);for(var n=0;n<8;n++){var r;C(85632+n,null!==(r=e[n])&&void 0!==r?r:0)}"number"==typeof t&&C(85646,255&t),d.current=d.current+1&255,C(85645,d.current),C(85644,0)}function T(e,t){return M.apply(this,arguments)}function M(){return(M=Yr(Hr().m(function e(t,n){var r,o;return Hr().w(function(e){for(;;)if(0===e.n)return S(),r=h.current=h.current+1&255,A(t,r),o=performance.now(),e.a(2,new Promise(function(e,t){var n=function(){try{if(0!==k(85708))return void requestAnimationFrame(n);if(k(85710)===r)return void e();if(performance.now()-o>2e3)return void e();requestAnimationFrame(n)}catch(e){t(e)}};n()}))},e)}))).apply(this,arguments)}function L(){return(L=Yr(Hr().m(function e(t){var n,r,o,a,i,l,u,c,s,f,d,p;return Hr().w(function(e){for(;;)switch(e.n){case 0:return u=null!==(n=null==t?void 0:t.songPosition)&&void 0!==n?n:0,c=null!==(r=null==t?void 0:t.row)&&void 0!==r?r:0,s=null===(o=null==t?void 0:t.loop)||void 0===o||o,f=null!==(a=null==t?void 0:t.sustain)&&void 0!==a&&a,d=null!==(i=null==t?void 0:t.tempo)&&void 0!==i?i:0,p=null!==(l=null==t?void 0:t.speed)&&void 0!==l?l:0,w("play() request",{songPosition:u,row:c,loop:s,sustain:f,tempo:d,speed:p}),e.n=1,T([1,255&u,255&c,s?1:0,f?1:0,255&d,255&p],"Play");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function D(){return(D=Yr(Hr().m(function e(){return Hr().w(function(e){for(;;)switch(e.n){case 0:return w("stop() request"),e.n=1,T([2],"Stop");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function R(){return(R=Yr(Hr().m(function e(){return Hr().w(function(e){for(;;)switch(e.n){case 0:return w("ping()"),e.n=1,T([3],"Ping");case 1:return e.a(2)}},e)}))).apply(this,arguments)}(0,r.useEffect)(function(){var e=0,t=(new TextEncoder).encode("SOMATIC_TIC80_V1"),n=function(){if(!f.current)try{var r,o=null===(r=i.current)||void 0===r?void 0:r.getWindow(),a=null==o?void 0:o.Module;if(!a)return"waiting-module"!==s.current&&(s.current="waiting-module",w("waiting for Module in iframe...")),void(e=requestAnimationFrame(n));"module-ready"!==s.current&&(s.current="module-ready");var d=function(e){var t=null==e?void 0:e.HEAPU8;if(!t)throw new Error("Module.HEAPU8 not available yet (or not exposed by this build).");return t}(a);"heap-ready"!==s.current&&(s.current="heap-ready");var p=function(e,t){if(0===t.length)return[];var n=[],r=e.length-t.length;e:for(var o=0;o<=r;o++){for(var a=0;a<t.length;a++)if(e[o+a]!==t[a])continue e;n.push(o)}return n}(d,t).map(function(e){return e-85540}).filter(function(e){return e>=0&&e+85696<d.length});if(0===p.length)return"waiting-marker"!==s.current&&(s.current="waiting-marker",w("waiting for marker bytes from bridge cart...")),void(e=requestAnimationFrame(n));var m=p.find(function(e){return 66===d[e+85696]});return null==m?("waiting-outbox"!==s.current&&(s.current="waiting-outbox"),void(e=requestAnimationFrame(n))):(l.current=a,u.current=d,c.current=m,void(f.current||(s.current="ready",f.current=!0,w("bridge ready"),b(!0))))}catch(t){"error"!==s.current&&(s.current="error"),e=requestAnimationFrame(n)}};return e=requestAnimationFrame(n),function(){f.current=!0,w("bridge poll cancelled"),cancelAnimationFrame(e)}},[]),(0,r.useEffect)(function(){if(g){T([3],"Ping");try{m.current=k(85703),p.current=k(85709)}catch(e){w("init outbox read ptr failed",e)}a&&a({isReady:function(){return g},getModule:function(){return l.current},getRamBase:function(){return c.current},peekU8:k,peekS8:j,pokeU8:C,pokeS8:E,pokeBlock:O,peekBlock:_,invokeExclusive:z,ping:B})}},[g]),(0,r.useEffect)(function(){if(g){var e=window.setInterval(x,100);return function(){return window.clearInterval(e)}}},[g]);var F={uploadSongData:function(e,t){return P.apply(this,arguments)},playSfx:function(e){return N.apply(this,arguments)},stopSfx:function(e){return I.apply(this,arguments)},play:function(e){return L.apply(this,arguments)},stop:function(){return D.apply(this,arguments)},ping:function(){return R.apply(this,arguments)}};function z(e){return U.apply(this,arguments)}function U(){return(U=Yr(Hr().m(function e(t){var n,r,o,a;return Hr().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=performance.now(),e.n=1,v.current.acquire();case 1:return r=e.v,e.p=2,e.n=3,t(F);case 3:return o=e.v,a=performance.now(),console.log("invokeExclusive took ".concat(a-n," ms")),e.a(2,o);case 4:return e.p=4,r(),e.f(4);case 5:return e.a(2)}},e,null,[[2,,4,5]])}))).apply(this,arguments)}function B(){return K.apply(this,arguments)}function K(){return(K=Yr(Hr().m(function e(){return Hr().w(function(e){for(;;)if(0===e.n)return e.a(2,z(function(e){return e.ping()}))},e)}))).apply(this,arguments)}return(0,r.useImperativeHandle)(t,function(){return{isReady:function(){return g},getModule:function(){return l.current},getRamBase:function(){return c.current},peekU8:k,peekS8:j,pokeU8:C,pokeS8:E,pokeBlock:O,peekBlock:_,invokeExclusive:z,ping:B}},[g]),(0,Me.jsxs)(Me.Fragment,{children:[(0,Me.jsx)(Rr,{ref:i,args:["/bridge.tic"]}),(0,Me.jsx)("button",{onClick:function(){B()},children:"ping"})]})});function to(e){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},to(e)}function no(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return ro(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(ro(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ro(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,ro(f,"constructor",c),ro(c,"constructor",u),u.displayName="GeneratorFunction",ro(c,o,"GeneratorFunction"),ro(f),ro(f,o,"Generator"),ro(f,r,function(){return this}),ro(f,"toString",function(){return"[object Generator]"}),(no=function(){return{w:a,m:d}})()}function ro(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ro=function(e,t,n,r){function a(t,n){ro(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},ro(e,t,n,r)}function oo(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function ao(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){oo(a,r,o,i,l,"next",e)}function l(e){oo(a,r,o,i,l,"throw",e)}i(void 0)})}}function io(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function lo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function uo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lo(Object(n),!0).forEach(function(t){co(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function co(e,t,n){return(t=function(e){var t=function(e){if("object"!=to(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=to(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==to(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function so(e,t){var n=uo({enabled:!0,debounceMs:1e3,maxWaitMs:void 0,cancelInFlightOnNewer:!1,onSuccess:void 0,onError:void 0},t),o=(0,r.useRef)(e);(0,r.useEffect)(function(){o.current=e},[e]);var a=(0,r.useRef)(!0);(0,r.useEffect)(function(){return function(){a.current=!1}},[]);var i,l,u=(i=(0,r.useState)({status:"idle",isDirty:!1,isScheduled:!1,isRunning:!1,lastRunAt:null,lastSuccessAt:null,error:null}),l=2,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(i,l)||function(e,t){if(e){if("string"==typeof e)return io(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?io(e,t):void 0}}(i,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=u[0],s=u[1],f=(0,r.useRef)(void 0),d=(0,r.useRef)(!1),p=(0,r.useRef)(null),m=(0,r.useRef)(null),h=(0,r.useRef)(null),v=(0,r.useRef)(null),y=(0,r.useRef)([]),g=(0,r.useCallback)(function(){null!=p.current&&(window.clearTimeout(p.current),p.current=null),null!=m.current&&(window.clearTimeout(m.current),m.current=null)},[]),b=(0,r.useCallback)(function(e){a.current&&s(function(t){return uo(uo({},t),e)})},[]),w=(0,r.useCallback)(function(){!d.current&&null==p.current&&null==m.current&&null==h.current&&y.current.length>0&&y.current.splice(0).forEach(function(e){return e()})},[]),x=(0,r.useCallback)(function(){if(n.enabled&&!h.current){if(!d.current)return b({status:"error"===c.status?"error":"idle",isScheduled:!1,isDirty:!1,isRunning:!1}),void w();g(),b({status:"running",isRunning:!0,isScheduled:!1});var e=f.current;d.current=!1,b({isDirty:!1,lastRunAt:Date.now(),error:null});var t=new AbortController;v.current=t;var r=ao(no().m(function r(){var i,l,u,c;return no().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,o.current(e,{signal:t.signal});case 1:if(l=r.v,a.current){r.n=2;break}return r.a(2);case 2:b({status:"idle",isRunning:!1,lastSuccessAt:Date.now(),error:null}),null===(i=n.onSuccess)||void 0===i||i.call(n,l,e),r.n=5;break;case 3:if(r.p=3,c=r.v,a.current){r.n=4;break}return r.a(2);case 4:t.signal.aborted?b({status:"idle",isRunning:!1}):(b({status:"error",isRunning:!1,error:c}),null===(u=n.onError)||void 0===u||u.call(n,c,e));case 5:if(r.p=5,a.current){r.n=6;break}return r.a(2);case 6:return h.current=null,v.current=null,d.current?S(0):w(),r.f(5);case 7:return r.a(2)}},r,null,[[0,3,5,7]])}))();h.current=r}},[n.enabled,n.onError,n.onSuccess,g,w,b,c.status]),S=(0,r.useCallback)(function(e){if(n.enabled){var t=null!=e?e:n.debounceMs;null!=p.current&&window.clearTimeout(p.current),p.current=window.setTimeout(function(){p.current=null,h.current?b({isScheduled:!1,status:"running"}):x()},Math.max(0,t)),null!=n.maxWaitMs&&null==m.current&&(m.current=window.setTimeout(function(){m.current=null,h.current?b({isScheduled:!1,status:"running"}):x()},Math.max(0,n.maxWaitMs))),b({status:h.current?"running":"scheduled",isScheduled:!0})}},[n.enabled,n.debounceMs,n.maxWaitMs,x,b]),k=(0,r.useCallback)(function(e){n.enabled&&(f.current=e,d.current=!0,b({isDirty:!0,error:null}),n.cancelInFlightOnNewer&&v.current&&v.current.abort(),S())},[n.enabled,n.cancelInFlightOnNewer,S,b]),j=(0,r.useCallback)(ao(no().m(function e(){return no().w(function(e){for(;;)switch(e.n){case 0:if(n.enabled){e.n=1;break}return e.a(2);case 1:return d.current&&S(0),!h.current&&d.current&&x(),e.n=2,new Promise(function(e){d.current||null!=p.current||null!=m.current||null!=h.current?y.current.push(e):e()});case 2:return e.a(2)}},e)})),[n.enabled,x,S]),C=(0,r.useCallback)(function(e){g(),b({isScheduled:!1}),null!=e&&e.abortInFlight&&v.current&&v.current.abort(),w()},[g,w,b]);return(0,r.useEffect)(function(){return function(){var e;g(),null===(e=v.current)||void 0===e||e.abort()}},[g]),(0,r.useMemo)(function(){return{enqueue:k,flush:j,cancel:C,state:c}},[k,j,C,c])}function fo(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return po(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(po(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,po(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,po(f,"constructor",c),po(c,"constructor",u),u.displayName="GeneratorFunction",po(c,o,"GeneratorFunction"),po(f),po(f,o,"Generator"),po(f,r,function(){return this}),po(f,"toString",function(){return"[object Generator]"}),(fo=function(){return{w:a,m:d}})()}function po(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}po=function(e,t,n,r){function a(t,n){po(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},po(e,t,n,r)}function mo(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function ho(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){mo(a,r,o,i,l,"next",e)}function l(e){mo(a,r,o,i,l,"throw",e)}i(void 0)})}}function vo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var yo=function(e){var t,n,o=e.song,a=(t=(0,r.useState)(null),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(t,n)||function(e,t){if(e){if("string"==typeof e)return vo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vo(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],l=a[1],u=Ge(),c=so(function(){var e=ho(fo().m(function e(t){var n;return fo().w(function(e){for(;;)if(0===e.n)return n=de(t,!0,"release"),e.a(2,n)},e)}));return function(t){return e.apply(this,arguments)}}(),{debounceMs:1200,maxWaitMs:5e3,onSuccess:function(e){l(e)},onError:function(){l(null)}});(0,r.useEffect)(function(){c.enqueue(o)},[o]);var s=(0,r.useMemo)(function(){if(!i)return[];var e=[];return e.push({name:"Code (playroutine)",size:i.codeChunk.length-i.generatedCode.length,color:"var(--tic-1)"}),e.push({name:"Code (songdata)",size:i.generatedCode.length,color:"var(--tic-2)"}),e.push({name:"Waveforms",size:i.waveformChunk.length,color:"var(--tic-3)"}),e.push({name:"SFX",size:i.sfxChunk.length,color:"var(--tic-4)"}),e.push({name:"Patterns",size:i.patternChunk.length,color:"var(--tic-5)"}),e.push({name:"Tracks",size:i.trackChunk.length,color:"var(--tic-6)"}),e},[i]),f=Math.max(1,(null==i?void 0:i.cartridge.length)||0),d=function(){var e=ho(fo().m(function e(){return fo().w(function(e){for(;;)switch(e.n){case 0:return console.log(null==i?void 0:i.generatedCode),e.n=1,u.copyTextToClipboard((null==i?void 0:i.generatedCode)||"");case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),p=i?(0,Me.jsxs)("div",{style:{minWidth:320},children:[(0,Me.jsxs)("div",{style:{marginBottom:8,fontWeight:600},children:["Cart size: ",_(i.cartridge.length)]}),(0,Me.jsx)("div",{style:{height:12,display:"flex",width:"100%",background:"#0ff",borderRadius:4,overflow:"hidden",marginBottom:8},children:s.length>0?s.map(function(e,t){return(0,Me.jsx)("div",{title:"".concat(e.name,": ").concat(e.size," bytes"),style:{flex:e.size||1,background:e.color}},t)}):(0,Me.jsx)("div",{style:{flex:1,background:"#444"}})}),(0,Me.jsxs)("div",{children:[s.map(function(e,t){return(0,Me.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,Me.jsx)("div",{style:{width:12,height:12,background:e.color,borderRadius:2}}),(0,Me.jsx)("div",{style:{flex:1},children:e.name}),(0,Me.jsxs)("div",{style:{color:"#aaa",minWidth:80,textAlign:"right"},children:[_(e.size),"  ",(e.size/f*100).toFixed(1),"%"]})]},t)}),"Click to Copy generated code",(0,Me.jsxs)("div",{children:["Patterns: ",i.optimizeResult.usedPatternCount]}),(0,Me.jsxs)("div",{children:["SFX: ",i.optimizeResult.usedSfxCount]}),(0,Me.jsxs)("div",{children:["Waveforms: ",i.optimizeResult.usedWaveformCount]})]})]}):(0,Me.jsx)(Me.Fragment,{children:"No data"});return(0,Me.jsx)("div",{children:(0,Me.jsx)(nn,{title:p,placement:"bottom",children:(0,Me.jsxs)("div",{className:"cartSize__label",style:{cursor:"default"},onClick:function(){return d()},children:["cart: ",_(f)]})})})};function go(e){return go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},go(e)}function bo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xo(r.key),r)}}function wo(e,t,n){return(t=xo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xo(e){var t=function(e){if("object"!=go(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=go(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==go(t)?t:t+""}var So=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),wo(this,"past",[]),wo(this,"future",[]),wo(this,"recordingGuard",!1),this.capacity=Math.max(1,t)},(t=[{key:"record",value:function(e){var t=this;if(!this.recordingGuard){this.past.push(e()),this.past.length>this.capacity&&this.past.shift(),this.future=[],this.recordingGuard=!0;var n=function(){t.recordingGuard=!1};"function"==typeof queueMicrotask?queueMicrotask(n):Promise.resolve().then(n)}}},{key:"undo",value:function(e){var t=this.past.pop();return t?(this.future.push(e()),t):null}},{key:"redo",value:function(e){var t=this.future.pop();return t?(this.past.push(e()),t):null}},{key:"canUndo",value:function(){return this.past.length>0}},{key:"canRedo",value:function(){return this.future.length>0}},{key:"clear",value:function(){this.past=[],this.future=[],this.recordingGuard=!1}}])&&bo(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ko(e){return ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ko(e)}var jo=["children"],Co=["children"],Eo=["caret","className","children","onClick","onKeyDown"];function Oo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oo(Object(n),!0).forEach(function(t){Po(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Po(e,t,n){return(t=function(e){var t=function(e){if("object"!=ko(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ko(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ko(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function No(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Io(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ao(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ao(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ao(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var To="desktop-menu-root",Mo=(0,r.createContext)(null),Lo=function(e){var t=(0,r.useContext)(Mo);if(!t)throw new Error("".concat(e," must be used within <DesktopMenu.Root> or <DesktopMenu.Sub>."));return t},Do=function(e){var t=e.children,n=e.placement,o=e.parentCloseTree,a=e.level,i=void 0===a?0:a,l=e.open,u=e.defaultOpen,c=e.onOpenChange,s=e.rootId,f=(0,r.useId)(),d=null!=s?s:f,p=Io((0,r.useState)(null!=u&&u),2),m=p[0],h=p[1],v="boolean"==typeof l,y=v?l:m,g=(0,r.useCallback)(function(e){v||h(e),null==c||c(e)},[v,c]),b=(0,r.useRef)(null),w=(0,r.useRef)(null),x=(0,r.useCallback)(function(){return g(!0)},[g]),S=(0,r.useCallback)(function(){return g(!1)},[g]),k=(0,r.useCallback)(function(){return g(!y)},[y,g]),j=(0,r.useCallback)(function(){S(),null==o||o()},[S,o]),C=(0,r.useMemo)(function(){return{isOpen:y,open:x,close:S,toggle:k,closeTree:j,triggerRef:b,contentRef:w,placement:n,level:i,rootId:d}},[y,S,j,i,x,n,d,k]);return(0,Me.jsx)(Mo.Provider,{value:C,children:t})},Ro=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){t.forEach(function(t){t&&("function"==typeof t?t(e):t.current=e)})}},Fo=function(e,t){if(!t)return{top:0,left:0,minWidth:void 0};var n=t.getBoundingClientRect();return"right-start"===e?{top:n.top,left:n.right,minWidth:void 0}:{top:n.bottom,left:n.left,minWidth:n.width}},zo=r.forwardRef(function(e,t){var n=e.caret,r=void 0===n||n,o=e.className,a=void 0===o?"":o,i=e.children,l=e.onClick,u=e.onKeyDown,c=No(e,Eo),s=Lo("DesktopMenu.Trigger"),f=Ro(t,function(e){s.triggerRef.current=e}),d=["desktop-menu-trigger"];return s.isOpen&&d.push("desktop-menu-trigger--open"),a&&d.push(a),(0,Me.jsxs)("button",_o(_o({},c),{},{ref:f,className:d.join(" "),"aria-haspopup":"menu","aria-expanded":s.isOpen,onClick:function(e){null==l||l(e),e.defaultPrevented||s.toggle()},onKeyDown:function(e){null==u||u(e),e.defaultPrevented||"ArrowDown"!==e.key&&"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),s.open())},children:[(0,Me.jsx)("span",{className:"desktop-menu-trigger__label",children:i}),r&&(0,Me.jsx)("span",{className:"desktop-menu-trigger__caret",children:""})]}))});zo.displayName="DesktopMenuTrigger";var Uo=r.forwardRef(function(e,t){var n=e.children,o=e.className,a=void 0===o?"":o,i=e.minWidth,l=e.style,u=e.autoFocus,c=void 0===u||u,s=Lo("DesktopMenu.Content"),f=Io((0,r.useState)(function(){return Fo(s.placement,s.triggerRef.current)}),2),d=f[0],p=f[1],m=Ro(t,function(e){s.contentRef.current=e});if((0,r.useLayoutEffect)(function(){if(s.isOpen){var e=function(){return p(Fo(s.placement,s.triggerRef.current))};return e(),window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),function(){window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0)}}},[s.isOpen,s.placement,s.triggerRef]),(0,r.useEffect)(function(){if(s.isOpen){var e=function(e){var t,n=e.target,r=null===(t=s.triggerRef.current)||void 0===t?void 0:t.contains(n),o=n.closest('[data-menu-root="'.concat(s.rootId,'"]'));r||o||s.closeTree()},t=function(e){var t;"Escape"===e.key&&(e.preventDefault(),s.closeTree(),null===(t=s.triggerRef.current)||void 0===t||t.focus())};return document.addEventListener("pointerdown",e),document.addEventListener("contextmenu",e),window.addEventListener("keydown",t),function(){document.removeEventListener("pointerdown",e),document.removeEventListener("contextmenu",e),window.removeEventListener("keydown",t)}}},[s]),(0,r.useEffect)(function(){s.isOpen&&c&&function(e){if(e){var t,n=e.querySelector('[data-menu-item="true"]');n&&(t=n)&&"menuitem"===t.getAttribute("role")&&"true"!==t.getAttribute("aria-disabled")&&n.focus()}}(s.contentRef.current)},[c,s.isOpen]),!s.isOpen)return null;var h,v="undefined"!=typeof document?((h=document.getElementById(To))||((h=document.createElement("div")).id=To,document.body.appendChild(h)),h):null;if(!v)return null;var y=_o({top:d.top,left:d.left,minWidth:null!=i?i:d.minWidth},l),g=["desktop-menu-popover","desktop-menu-popover--level-".concat(s.level)];return a&&g.push(a),(0,Zt.createPortal)((0,Me.jsx)("div",{role:"menu",className:g.join(" "),style:y,ref:m,"data-menu-root":s.rootId,children:n}),v)});Uo.displayName="DesktopMenuContent";var Bo=r.forwardRef(function(e,t){var n=e.children,r=e.disabled,o=e.onSelect,a=e.shortcut,i=e.icon,l=e.checked,u=e.closeOnSelect,c=void 0===u||u,s=e.inset,f=Lo("DesktopMenu.Item"),d=Ro(t),p=function(e){r?e.preventDefault():(null==o||o(e),c&&f.closeTree())},m=["desktop-menu-item"];r&&m.push("desktop-menu-item--disabled"),s&&m.push("desktop-menu-item--inset");var h=l?"":i;return(0,Me.jsxs)("div",{role:"menuitem",tabIndex:-1,"aria-disabled":r||void 0,className:m.join(" "),onClick:function(e){e.stopPropagation(),p(e)},onKeyDown:function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),p(e))},ref:d,"data-menu-item":"true",children:[(0,Me.jsx)("span",{className:"desktop-menu-item__leading",children:h}),(0,Me.jsx)("span",{className:"desktop-menu-item__label",children:n}),a&&(0,Me.jsx)("span",{className:"desktop-menu-item__shortcut",children:a})]})});Bo.displayName="DesktopMenuItem";var Ko=r.forwardRef(function(e,t){var n=e.children,r=e.disabled,o=Lo("DesktopMenu.SubTrigger"),a=Ro(t,function(e){o.triggerRef.current=e}),i=["desktop-menu-item","desktop-menu-item--submenu"];return r&&i.push("desktop-menu-item--disabled"),(0,Me.jsxs)("div",{role:"menuitem","aria-haspopup":"menu","aria-expanded":o.isOpen,tabIndex:-1,className:i.join(" "),onClick:function(e){e.preventDefault(),r||o.toggle()},onPointerEnter:function(){r||o.open()},ref:a,"data-menu-item":"true",children:[(0,Me.jsx)("span",{className:"desktop-menu-item__label",children:n}),(0,Me.jsx)("span",{className:"desktop-menu-item__shortcut",children:""})]})});Ko.displayName="DesktopMenuSubTrigger";var $o={Root:function(e){var t=e.children,n=No(e,jo);return(0,Me.jsx)(Do,_o(_o({placement:"bottom-start"},n),{},{children:t}))},Trigger:zo,Content:Uo,Item:Bo,Divider:function(e){var t=e.inset;return(0,Me.jsx)("div",{role:"separator",className:"desktop-menu-divider".concat(t?" desktop-menu-divider--inset":"")})},Label:function(e){var t=e.children;return(0,Me.jsx)("div",{className:"desktop-menu-label",children:t})},Sub:function(e){var t=e.children,n=No(e,Co),r=Lo("DesktopMenu.Sub");return(0,Me.jsx)(Do,_o(_o({placement:"right-start",parentCloseTree:r.closeTree,level:r.level+1,rootId:r.rootId},n),{},{children:t}))},SubTrigger:Ko,SubContent:Uo};function Vo(e){return Vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vo(e)}function Wo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Go(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wo(Object(n),!0).forEach(function(t){Ho(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ho(e,t,n){return(t=function(e){var t=function(e){if("object"!=Vo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Vo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Vo(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qo(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof l?r:l,c=Object.create(u.prototype);return Qo(c,"_invoke",function(n,r,o){var a,l,u,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,l=0,u=e,d.n=n,i}};function p(n,r){for(l=n,u=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,a=s[t],p=d.p,m=a[2];n>3?(o=m===r)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(l=0,d.v=r,d.n=a[1]):p<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,d.n=m,l=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,u=m;(t=l<2?e:u)||!f;){a||(l?l<3?(l>1&&(d.n=-1),p(l,u)):d.n=u:d.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),c}var i={};function l(){}function u(){}function c(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(Qo(t={},r,function(){return this}),t),f=c.prototype=l.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Qo(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Qo(f,"constructor",c),Qo(c,"constructor",u),u.displayName="GeneratorFunction",Qo(c,o,"GeneratorFunction"),Qo(f),Qo(f,o,"Generator"),Qo(f,r,function(){return this}),Qo(f,"toString",function(){return"[object Generator]"}),(qo=function(){return{w:a,m:d}})()}function Qo(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Qo=function(e,t,n,r){function a(t,n){Qo(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Qo(e,t,n,r)}function Yo(e,t,n,r,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function Xo(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Yo(a,r,o,i,l,"next",e)}function l(e){Yo(a,r,o,i,l,"throw",e)}i(void 0)})}}function Jo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Zo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zo(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ea=function(e){var t=e.musicState;return(0,Me.jsx)("div",{className:"musicState-panel",children:(0,Me.jsx)("div",{className:"flags",children:t.isPlaying?(0,Me.jsxs)(Me.Fragment,{children:[(0,Me.jsx)("div",{className:"key",children:"Order:"}),(0,Me.jsx)("div",{className:"value",children:t.somaticSongPosition}),(0,Me.jsx)("div",{className:"key",children:"Row:"}),(0,Me.jsx)("div",{className:"value",children:t.tic80RowIndex})]}):(0,Me.jsx)(Me.Fragment,{children:"Stopped"})})})},ta=function(e){var n=e.theme,o=e.onToggleTheme,i=r.useRef(null),l=r.useRef(new nt),u=r.useRef(null),c=r.useRef(null),s=r.useRef(null),f=(0,r.useMemo)(function(){return new Te({bridgeGetter:function(){return i.current}})},[]),d=ze().pushToast,p=Xt().confirm,m=Jo((0,r.useState)(function(){try{var e=localStorage.getItem("somatic-song");if(e)return Ht.fromJSON(e)}catch(e){console.error("Failed to load song from localStorage",e)}return new Ht}),2),h=m[0],v=m[1],y=Jo((0,r.useState)(function(){return new yt}),2),g=y[0],b=y[1],w=Jo((0,r.useState)(!1),2),x=w[0],S=w[1],k=Jo((0,r.useState)(!1),2),j=k[0],C=k[1],E=Jo((0,r.useState)(!1),2),O=E[0],_=E[1],P=Jo((0,r.useState)(!1),2),N=P[0],I=P[1],A=Jo((0,r.useState)(!0),2),T=A[0],M=A[1],L=Jo((0,r.useState)(!1),2),D=L[0],R=L[1],F=Jo((0,r.useState)("pending"),2),z=F[0],U=F[1],B=Jo((0,r.useState)([]),2),K=B[0],$=B[1],V=Jo((0,r.useState)(!0),2),G=V[0],H=V[1],q=Jo((0,r.useState)(!0),2),Q=q[0],X=q[1],J=Jo((0,r.useState)(function(){return f.getMusicState()}),2),Z=J[0],ee=J[1],te=Ge();s.current||(s.current=new So(200));var ne=(0,r.useMemo)(function(){return K.filter(function(e){return"connected"===e.state}).length},[K]),re="ready"===z&&G?ne>0?"ok":"warn":"off",oe="ready"===z?G?ne>0?"MIDI (".concat(ne,")"):"MIDI ready (no devices)":"MIDI off":"pending"===z?"MIDI initializing":"unsupported"===z?"MIDI unsupported":"denied"===z?"MIDI access denied":"MIDI error",ae=G&&ne>0?"".concat(oe,": ").concat(ne," input").concat(1===ne?"":"s"," connected. Click to disable."):"".concat(oe,G?". Click to disable.":". Click to enable."),ie=Q?"ok":"off",le=Q?"Keyb note inp":"Keyb off",ue=Q?"Keyboard note input enabled. Click to disable.":"Keyboard note input disabled. Click to enable.",ce=function(){return ve(function(e){return e.setEditingEnabled(!e.editingEnabled)})};(0,r.useEffect)(function(){var e,t=function(){ee(f.getMusicState()),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),function(){return cancelAnimationFrame(e)}},[f]);var se=(0,r.useCallback)(function(){return{song:be.current.toData(),editor:we.current.toData()}},[]),fe=so(function(){var e=Xo(qo().m(function e(t,n){return qo().w(function(e){for(;;)switch(e.n){case 0:n.signal,f.setSong(t,"Auto-save"),localStorage.setItem("somatic-song",t.toJSON());case 1:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),{debounceMs:1e3,maxWaitMs:2500}),pe=(0,r.useCallback)(function(e){fe.flush(),v(Ht.fromData(e.song)),b(yt.fromData(e.editor))},[fe]),me=(0,r.useCallback)(function(){var e;null===(e=s.current)||void 0===e||e.record(se)},[se]),he=(0,r.useCallback)(function(e){me(),v(function(t){var n=t.clone();return e(n),n})},[me]),ve=(0,r.useCallback)(function(e){b(function(t){var n=t.clone();return e(n),n})},[]),ye=(0,r.useCallback)(function(){var e=s.current;if(e){var t=e.undo(se);t?pe(t):d({message:"Nothing to undo.",variant:"info"})}},[pe,se,d]),ge=(0,r.useCallback)(function(){var e=s.current;if(e){var t=e.redo(se);t?pe(t):d({message:"Nothing to redo.",variant:"info"})}},[pe,se,d]);(0,r.useEffect)(function(){var e=function(e){var t,n=null===(t=e.target)||void 0===t||null===(t=t.tagName)||void 0===t?void 0:t.toLowerCase(),r="input"===n||"textarea"===n||"select"===n||"button"===n,o=(e.key,e.key,"Digit1"===e.code),a=e.metaKey||e.ctrlKey,i=e.key.toLowerCase(),l=[];e.ctrlKey&&l.push("Ctrl"),e.altKey&&l.push("Alt"),e.shiftKey&&l.push("Shift"),e.metaKey&&l.push("Meta"),l.push(e.code);var u,s=l.join("+");return console.log("Key combo pressed: code:".concat(s," key:").concat(e.key," repeat:").concat(e.repeat)),r||!a||e.altKey||"z"!==i?r||!a||e.altKey||e.shiftKey||"y"!==i?e.altKey&&!a&&o?(e.preventDefault(),void(null===(u=c.current)||void 0===u||u.focusPattern())):e.altKey&&!a&&"Digit2"===e.code?(e.preventDefault(),void C(function(e){return!e})):e.altKey&&!a&&"Digit3"===e.code?(e.preventDefault(),void S(function(e){return!e})):e.altKey&&!a&&"Digit4"===e.code?(e.preventDefault(),void M(function(e){return!e})):(e.altKey&&!a&&"Digit0"===e.code&&(e.preventDefault(),fe.flush(),f.getMusicState().somaticSongPosition>=0?f.stop():f.playSong(0)),e.altKey&&!a&&"Digit9"===e.code&&(e.preventDefault(),fe.flush(),f.playSong(g.activeSongPosition,g.patternEditRow)),e.altKey&&!a&&"Digit8"===e.code&&(e.preventDefault(),fe.flush(),f.playSong(g.activeSongPosition,0)),"Escape"===e.code?(e.preventDefault(),ce(),void f.panic()):r||e.repeat||a||e.altKey?void 0:"["===e.key?(e.preventDefault(),void ve(function(e){return e.setOctave(e.octave-1)})):"]"===e.key?(e.preventDefault(),void ve(function(e){return e.setOctave(e.octave+1)})):"{"===e.key?(e.preventDefault(),void ve(function(e){return e.setCurrentInstrument(e.currentInstrument-1)})):"}"===e.key?(e.preventDefault(),void ve(function(e){return e.setCurrentInstrument(e.currentInstrument+1)})):void 0):(e.preventDefault(),void ge()):(e.preventDefault(),void(e.shiftKey?ge():ye()))};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}},[ge,ye]),(0,r.useEffect)(function(){fe.enqueue(h),fe.flush()},[f]),(0,r.useEffect)(function(){fe.enqueue(h)},[h]);var be=r.useRef(h),we=r.useRef(g);(0,r.useEffect)(function(){be.current=h},[h]),(0,r.useEffect)(function(){we.current=g},[g]);var xe=(0,r.useCallback)(function(e){var t,n=be.current,r=we.current,o=W(r.patternEditChannel),a="command"===(t=function(){if("undefined"==typeof document)return null;var e=document.activeElement;if(!(e&&e instanceof HTMLElement))return null;var t=e.getAttribute("data-cell-type");return"note"===t||"instrument"===t||"command"===t||"param"===t?t:null}())||"param"===t;if(fe.flush(),f.sfxNoteOn(r.currentInstrument,e),!1!==r.editingEnabled&&!a){var i,l=Math.max(0,Math.min(n.songOrder.length-1,r.activeSongPosition||0)),u=null!==(i=n.songOrder[l])&&void 0!==i?i:0,c=n.rowsPerPattern,s=n.patternEditStep;he(function(t){var n=Math.max(0,Math.min(u,t.patterns.length-1)),a=t.patterns[n],i=a.getCell(o,r.patternEditRow);a.setCell(o,r.patternEditRow,Go(Go({},i),{},{midiNote:e,instrumentIndex:r.currentInstrument}))}),b(function(e){var t=e.clone();return t.advancePatternEditRow(s,c),t})}},[f,fe,he]),Se=(0,r.useCallback)(function(e){fe.flush(),f.sfxNoteOff(e)},[f,fe]);(0,r.useEffect)(function(){u.current||(u.current=new ut({getOctave:function(){return we.current.octave}}),u.current.init());var e=[];return l.current&&(e.push(l.current.onNoteOn(function(e){return xe(e.note)})),e.push(l.current.onNoteOff(function(e){return Se(e.note)}))),u.current&&(e.push(u.current.onNoteOn(function(e){return xe(e.note)})),e.push(u.current.onNoteOff(function(e){return Se(e.note)}))),function(){e.forEach(function(e){return e()})}},[Se,xe]),(0,r.useEffect)(function(){var e;null===(e=l.current)||void 0===e||e.setEnabled(G)},[G]),(0,r.useEffect)(function(){var e;null===(e=u.current)||void 0===e||e.setEnabled(Q)},[Q]),(0,r.useEffect)(function(){var e=l.current;if(e){var t=null;return e.init().then(function(){U(e.getStatus()),$(e.getDevices()),t=e.onDevicesChanged(function(t){$(t),U(e.getStatus())})}),function(){var e;null===(e=t)||void 0===e||e()}}},[f]);var ke=function(){var e=Xo(qo().m(function e(){var t;return qo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,p({content:(0,Me.jsxs)("div",{children:[(0,Me.jsx)("p",{children:"Create a new song? Your current song will be replaced."}),(0,Me.jsx)("p",{children:"Make sure you've saved your work first!"})]}),defaultAction:"no",yesLabel:"Create New",noLabel:"Cancel"});case 1:if(e.v){e.n=2;break}return e.a(2);case 2:v(new Ht),ve(function(e){e.setActiveSongPosition(0)}),null===(t=s.current)||void 0===t||t.clear(),d({message:"New song created.",variant:"success"});case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),je=function(){var e=Xo(qo().m(function e(){var n,r,o,a,i,l;return qo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t()();case 1:if(r=e.v,o=r?Array.from(r):[],a=o[0]){e.n=2;break}return e.a(2);case 2:return e.n=3,a.text();case 3:i=e.v,l=Ht.fromJSON(i),v(l),ve(function(e){e.setActiveSongPosition(0)}),null===(n=s.current)||void 0===n||n.clear();case 4:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ce=function(e){var t=function(e,t,n){return de(e,!0,n).cartridge}(h,0,e),n=new Blob([t],{type:"application/octet-stream"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download="song.tic",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)},Ee=function(){var e=Xo(qo().m(function e(){var t;return qo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,p({content:(0,Me.jsx)("p",{children:"Optimize the song to remove unused patterns, waveforms, and SFX?"})});case 1:if(e.v){e.n=2;break}return e.a(2);case 2:t=Y(h),console.log(t),me(),v(t.optimizedSong.clone());case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Oe=function(){var e=Xo(qo().m(function e(){return qo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,te.copyTextToClipboard(h.toJSON());case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),_e=function(){var e=Xo(qo().m(function e(){var t,n,r;return qo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,te.readTextFromClipboard();case 1:t=e.v,n=Ht.fromJSON(t),me(),v(n),ve(function(e){e.setActiveSongPosition(0)}),e.n=3;break;case 2:e.p=2,r=e.v,console.error("Paste failed",r),d({message:"Failed to paste song from clipboard. Ensure it is valid song JSON.",variant:"error"});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),Pe=r.useCallback(function(e){fe.enqueue(h),fe.flush()},[f,h]);return(0,Me.jsxs)("div",{className:"app",children:[(0,Me.jsxs)("div",{className:"stickyHeader appRow",children:[(0,Me.jsxs)("div",{className:"menu",children:[(0,Me.jsxs)("nav",{className:"desktop-menu-bar",children:[(0,Me.jsxs)($o.Root,{children:[(0,Me.jsx)($o.Trigger,{caret:!1,children:"File"}),(0,Me.jsxs)($o.Content,{children:[(0,Me.jsx)($o.Item,{onSelect:function(){ke()},children:"New Song"}),(0,Me.jsx)($o.Item,{onSelect:function(){je()},children:"Open Song"}),(0,Me.jsx)($o.Item,{onSelect:function(){(0,a.saveSync)(h.toJSON(),"song.somatic")},children:"Save Song"}),(0,Me.jsx)($o.Divider,{}),(0,Me.jsxs)($o.Sub,{children:[(0,Me.jsx)($o.SubTrigger,{children:"Export Cart"}),(0,Me.jsxs)($o.SubContent,{children:[(0,Me.jsx)($o.Item,{onSelect:function(){return Ce("debug")},children:"Debug Build"}),(0,Me.jsx)($o.Item,{onSelect:function(){return Ce("release")},children:"Release Build"})]})]}),(0,Me.jsx)($o.Divider,{}),(0,Me.jsx)($o.Item,{onSelect:function(){Ee()},children:"Optimize Song"})]})]}),(0,Me.jsxs)($o.Root,{children:[(0,Me.jsx)($o.Trigger,{caret:!1,children:"Edit"}),(0,Me.jsxs)($o.Content,{children:[(0,Me.jsx)($o.Item,{onSelect:ye,shortcut:"Ctrl+Z",children:"Undo"}),(0,Me.jsx)($o.Item,{onSelect:ge,shortcut:"Ctrl+Shift+Z / Ctrl+Y",children:"Redo"}),(0,Me.jsx)($o.Divider,{}),(0,Me.jsx)($o.Item,{onSelect:function(){Oe()},children:"Copy Song JSON"}),(0,Me.jsx)($o.Item,{onSelect:function(){_e()},children:"Paste Song JSON"})]})]}),(0,Me.jsxs)($o.Root,{children:[(0,Me.jsx)($o.Trigger,{caret:!1,children:"View"}),(0,Me.jsxs)($o.Content,{children:[(0,Me.jsx)($o.Item,{checked:j,closeOnSelect:!1,onSelect:function(){return C(function(e){return!e})},shortcut:"Alt+2",children:"Waveform Editor"}),(0,Me.jsx)($o.Item,{checked:x,closeOnSelect:!1,onSelect:function(){return S(function(e){return!e})},shortcut:"Alt+3",children:"Instrument Panel"}),(0,Me.jsx)($o.Item,{checked:N,closeOnSelect:!1,onSelect:function(){return I(function(e){return!e})},children:"Preferences Panel"}),(0,Me.jsx)($o.Item,{checked:D,closeOnSelect:!1,onSelect:function(){return R(function(e){return!e})},children:"Theme Editor"}),(0,Me.jsx)($o.Item,{checked:T,closeOnSelect:!1,onSelect:function(){return M(function(e){return!e})},shortcut:"Alt+4",children:"TIC-80 Bridge"}),(0,Me.jsx)($o.Divider,{}),(0,Me.jsx)($o.Item,{checked:g.editingEnabled,closeOnSelect:!1,onSelect:ce,shortcut:"Esc",children:"Editing Mode Enabled"}),(0,Me.jsx)($o.Item,{checked:"dark"===n,closeOnSelect:!1,onSelect:o,children:"Dark Theme"})]})]}),(0,Me.jsxs)($o.Root,{children:[(0,Me.jsx)($o.Trigger,{caret:!1,children:"Help"}),(0,Me.jsxs)($o.Content,{children:[(0,Me.jsx)($o.Item,{onSelect:function(){return _(!0)},children:"Keyboard Shortcuts"}),(0,Me.jsx)($o.Divider,{}),(0,Me.jsx)($o.Item,{onSelect:function(){return window.open("https://github.com/thenfour/chromatic","_blank","noopener")},children:"Visit Project on GitHub"})]})]})]}),(0,Me.jsxs)("div",{className:"menu-transport",children:[(0,Me.jsxs)("button",{onClick:function(){f.panic()},title:"Stop all audio",children:[(0,Me.jsx)("span",{className:"icon","aria-hidden":"true"}),"Panic"]}),(0,Me.jsxs)("button",{className:void 0,onClick:function(){f.stop()},children:[(0,Me.jsx)("span",{className:"icon",children:""}),(0,Me.jsx)("span",{className:"caption",children:"Stop"})]}),(0,Me.jsxs)("button",{className:void 0,onClick:function(){fe.flush(),f.playSong(0)},children:[(0,Me.jsx)("span",{className:"icon","aria-hidden":"true",children:""}),"Song"]}),(0,Me.jsxs)("button",{className:void 0,onClick:function(){fe.flush(),f.playSong(g.activeSongPosition,0)},children:[(0,Me.jsx)("span",{className:"icon","aria-hidden":"true",children:""}),"Pat"]}),(0,Me.jsxs)("button",{className:void 0,onClick:function(){fe.flush(),f.playSong(g.activeSongPosition,g.patternEditRow)},children:[(0,Me.jsx)("span",{className:"icon","aria-hidden":"true",children:""}),"From Position"]})]}),(0,Me.jsxs)("div",{className:"right-controls",children:[(0,Me.jsxs)("button",{className:"edit-toggle ".concat(g.editingEnabled?"edit-toggle--on":"edit-toggle--off"),onClick:ce,"aria-pressed":g.editingEnabled,"aria-label":g.editingEnabled?"Disable editing in pattern editor":"Enable editing in pattern editor",children:[(0,Me.jsx)("span",{className:"edit-toggle__dot","aria-hidden":"true"}),(0,Me.jsx)("span",{className:"edit-toggle__label",children:"Edit"})]}),(0,Me.jsxs)("button",{className:"midi-indicator midi-indicator--".concat(re),title:ae,"aria-label":ae,onClick:function(){var e,t=!G;H(t),null===(e=l.current)||void 0===e||e.setEnabled(t)},children:[(0,Me.jsx)("span",{className:"midi-indicator__dot","aria-hidden":"true"}),(0,Me.jsx)("span",{className:"midi-indicator__label",children:oe})]}),(0,Me.jsxs)("button",{className:"midi-indicator midi-indicator--".concat(ie),title:ue,"aria-label":ue,onClick:function(){var e,t=!Q;X(t),null===(e=u.current)||void 0===e||e.setEnabled(t)},children:[(0,Me.jsx)("span",{className:"midi-indicator__dot","aria-hidden":"true"}),(0,Me.jsx)("span",{className:"midi-indicator__label",children:le})]}),(0,Me.jsxs)("span",{className:"autoSaveIndicator__label",children:["sync:",fe.state.status]}),(0,Me.jsx)(yo,{song:h}),(0,Me.jsx)(ea,{musicState:Z})]})]}),(0,Me.jsx)("div",{className:"instrument-panel-positioner"}),(0,Me.jsx)(br,{song:h,audio:f,editorState:g,onSongChange:he,onEditorStateChange:ve})]}),(0,Me.jsxs)("div",{className:"main-editor-area  appRow",children:[(0,Me.jsx)(dn,{song:h,editorState:g,musicState:Z,onEditorStateChange:ve,onSongChange:he}),(0,Me.jsx)(vr,{ref:c,song:h,audio:f,musicState:Z,editorState:g,onEditorStateChange:ve,onSongChange:he}),j&&(0,Me.jsx)(On,{song:h,editorState:g,onSongChange:he}),x&&(0,Me.jsx)(Ln,{song:h,audio:f,currentInstrument:g.currentInstrument,onSongChange:he,onClose:function(){return S(!1)}}),N&&(0,Me.jsx)(yr,{midiStatus:z,midiDevices:K,onClose:function(){return I(!1)}}),D&&(0,Me.jsx)(Mr,{onClose:function(){return R(!1)}}),O&&(0,Me.jsx)(mn,{onClose:function(){return _(!1)}}),(0,Me.jsx)("div",{className:T?"tic80-frame":"tic80-frame hidden",children:(0,Me.jsx)(eo,{ref:i,onReady:Pe})})]}),(0,Me.jsx)("div",{className:"footer appRow",children:(0,Me.jsx)(Fn,{onNoteOn:function(e){fe.flush(),f.sfxNoteOn(g.currentInstrument,e)},onNoteOff:function(e){fe.flush(),f.sfxNoteOff(e)}})})]})},na=function(e){var t=e.onContinue;return(0,Me.jsxs)("div",{className:"splash-screen",onClick:t,onKeyDown:t,children:[(0,Me.jsx)("h1",{children:"Somatic"}),(0,Me.jsx)("div",{className:"subtitle subtitle1",children:"A tracker for TIC-80"}),(0,Me.jsx)("div",{className:"subtitle subtitle2",children:"By tenfour"}),(0,Me.jsx)("button",{className:"clickToContinueButton",style:{pointerEvents:"none"},children:"Click to Continue"})]})},ra=function(){var e,t,n,o,a,i,l,u=Jo((0,r.useState)(!1),2),c=u[0],s=u[1],f=Jo((e="somatic-theme",t="light",i=(0,r.useState)(function(){if("undefined"==typeof window)return t;try{var n=window.localStorage.getItem(e);return null!==n?JSON.parse(n):t}catch(e){return console.warn("useLocalStorage: read failed",e),t}}),l=2,n=function(e){if(Array.isArray(e))return e}(i)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(i,l)||function(e,t){if(e){if("string"==typeof e)return He(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?He(e,t):void 0}}(i,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=n[0],a=n[1],(0,r.useEffect)(function(){if("undefined"!=typeof window)try{window.localStorage.setItem(e,JSON.stringify(o))}catch(e){console.warn("useLocalStorage: write failed",e)}},[e,o]),[o,a]),2),d=f[0],p=f[1];return(0,r.useEffect)(function(){var e=document.documentElement;e&&("dark"===d?e.classList.add("theme-dark"):e.classList.remove("theme-dark"))},[d]),(0,Me.jsx)(Fe,{children:(0,Me.jsx)(Jt,{children:(0,Me.jsx)(We,{children:c?(0,Me.jsx)(ta,{theme:d,onToggleTheme:function(){return p("dark"===d?"light":"dark")}}):(0,Me.jsx)(na,{onContinue:function(){return s(!0)}})})})})},oa=document.getElementById("root");if(!oa)throw new Error("Root element not found");(0,o.H)(oa).render((0,Me.jsx)(ra,{}))})()})();